<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.361">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Data Science Blog - Yuvraj Dhepe - Model Training on US-Accidents Processed Dataset</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../../">
<link href="../../../images/lotus.jpg" rel="icon" type="image/jpeg">
<script src="../../../site_libs/quarto-html/quarto.js"></script>
<script src="../../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="../../../site_libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="stylesheet" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="../../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="../../../site_libs/bootstrap/bootstrap-dark.min.css" rel="stylesheet" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script>
<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<link rel="stylesheet" href="../../../styles.css">
<meta property="og:title" content="Data Science Blog - Yuvraj Dhepe - Model Training on US-Accidents Processed Dataset">
<meta property="og:image" content="https://github.com/Yuvraj-Dhepe/DataBlog_V1/docs/projects/abc/project-4-us-accidents-model-runs_files/figure-html/cell-15-output-1.png">
<meta property="og:site-name" content="Data Science Blog - Yuvraj Dhepe">
<meta property="og:image:height" content="575">
<meta property="og:image:width" content="739">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../../index.html" rel="" target="">
 <span class="menu-text">Hello There</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../../docs/projects/index.html" rel="" target="">
 <span class="menu-text">Projects</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../../docs/blog/index.html" rel="" target="">
 <span class="menu-text">Blog</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../../docs/notes/index.html" rel="" target="">
 <span class="menu-text">Notes</span></a>
  </li>  
</ul>
            <div class="quarto-navbar-tools ms-auto tools-wide">
    <a href="https://github.com/Yuvraj-Dhepe" title="" class="quarto-navigation-tool px-1" aria-label=""><i class="bi bi-github"></i></a>
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
  <a href="" class="quarto-reader-toggle quarto-navigation-tool px-1" onclick="window.quartoToggleReader(); return false;" title="Toggle reader mode">
  <div class="quarto-reader-toggle-btn">
  <i class="bi"></i>
  </div>
</a>
</div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#importing-the-necessary-libraries" id="toc-importing-the-necessary-libraries" class="nav-link active" data-scroll-target="#importing-the-necessary-libraries">Importing the necessary Libraries</a></li>
  <li><a href="#loading-splitting-sampling-the-dataset" id="toc-loading-splitting-sampling-the-dataset" class="nav-link" data-scroll-target="#loading-splitting-sampling-the-dataset">Loading, Splitting &amp; Sampling the Dataset</a>
  <ul class="collapse">
  <li><a href="#formulas" id="toc-formulas" class="nav-link" data-scroll-target="#formulas">Formulas</a></li>
  </ul></li>
  <li><a href="#model-training" id="toc-model-training" class="nav-link" data-scroll-target="#model-training">Model Training</a>
  <ul class="collapse">
  <li><a href="#logistic-regression-model" id="toc-logistic-regression-model" class="nav-link" data-scroll-target="#logistic-regression-model">Logistic Regression Model</a></li>
  <li><a href="#decision-tree-model" id="toc-decision-tree-model" class="nav-link" data-scroll-target="#decision-tree-model">Decision Tree Model</a></li>
  <li><a href="#random-forest-classifier" id="toc-random-forest-classifier" class="nav-link" data-scroll-target="#random-forest-classifier">Random Forest Classifier</a></li>
  <li><a href="#naive-bayes" id="toc-naive-bayes" class="nav-link" data-scroll-target="#naive-bayes">Naive Bayes</a></li>
  <li><a href="#multinomial-naive-bayes" id="toc-multinomial-naive-bayes" class="nav-link" data-scroll-target="#multinomial-naive-bayes">Multinomial Naive Bayes</a></li>
  <li><a href="#bernoulli-naive-bayes" id="toc-bernoulli-naive-bayes" class="nav-link" data-scroll-target="#bernoulli-naive-bayes">Bernoulli Naive Bayes</a></li>
  <li><a href="#xgboost-classifier" id="toc-xgboost-classifier" class="nav-link" data-scroll-target="#xgboost-classifier">XGBoost Classifier</a></li>
  <li><a href="#multi-layer-perceptron" id="toc-multi-layer-perceptron" class="nav-link" data-scroll-target="#multi-layer-perceptron">Multi Layer Perceptron</a></li>
  <li><a href="#support-vector-machine" id="toc-support-vector-machine" class="nav-link" data-scroll-target="#support-vector-machine">Support Vector Machine</a></li>
  </ul></li>
  <li><a href="#result-and-comparisions-after-training-on-partial-data" id="toc-result-and-comparisions-after-training-on-partial-data" class="nav-link" data-scroll-target="#result-and-comparisions-after-training-on-partial-data">Result and Comparisions after Training on Partial Data</a>
  <ul class="collapse">
  <li><a href="#model-training-observations" id="toc-model-training-observations" class="nav-link" data-scroll-target="#model-training-observations">Model Training Observations</a></li>
  </ul></li>
  <li><a href="#best-model-training-on-whole-datasets" id="toc-best-model-training-on-whole-datasets" class="nav-link" data-scroll-target="#best-model-training-on-whole-datasets">Best Model Training On Whole Datasets</a>
  <ul class="collapse">
  <li><a href="#random-forest-classifier-1" id="toc-random-forest-classifier-1" class="nav-link" data-scroll-target="#random-forest-classifier-1">Random Forest Classifier</a></li>
  <li><a href="#xgboost-classifier-1" id="toc-xgboost-classifier-1" class="nav-link" data-scroll-target="#xgboost-classifier-1">XGBoost Classifier</a></li>
  <li><a href="#comparing-results-between-xgb-n-random-forest-regressor-after-training-on-whole-dataset" id="toc-comparing-results-between-xgb-n-random-forest-regressor-after-training-on-whole-dataset" class="nav-link" data-scroll-target="#comparing-results-between-xgb-n-random-forest-regressor-after-training-on-whole-dataset">Comparing Results between XGB n Random Forest Regressor after training on whole dataset</a></li>
  </ul></li>
  <li><a href="#conclusion-of-model-training" id="toc-conclusion-of-model-training" class="nav-link" data-scroll-target="#conclusion-of-model-training">Conclusion of Model Training</a></li>
  </ul>
<div class="toc-actions"><div><i class="bi bi-github"></i></div><div class="action-links"><p><a href="https://github.dev/quarto-dev/quarto-demo/blob/main/docs/projects/abc/project-4-us-accidents-model-runs.ipynb" class="toc-action">Edit this page</a></p><p><a href="https://github.com/quarto-dev/quarto-demo/issues/new" class="toc-action">Report an issue</a></p></div></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Model Training on US-Accidents Processed Dataset</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<ul>
<li><p>Data processing can be accessed from this <a href="https://www.kaggle.com/code/yuvrajdhepe/project-4-us-accidents/notebook">Kaggle Notebook</a></p></li>
<li><p>In this notebook Classification models are trained and compared</p></li>
<li><p>The training is done on <strong>partial data</strong> cause few models take too much time to train and find best params using grid search</p></li>
<li><p>After training, we retrain the best models on the whole data and compare between them</p></li>
<li><p>In the end we conclude with our findings</p></li>
<li><p>We will be using these models:</p>
<ul>
<li>Logistic Regression</li>
<li>Decision Tree Classifier</li>
<li>Random Forest Classifier</li>
<li>Naive Bayes</li>
<li>Gaussian Naive Bayes</li>
<li>Multinomial Naive Bayes</li>
<li>Bernoulli Naive Bayes</li>
<li>XGBoost Classifier</li>
<li>Multi Layer Perceptron Classifier</li>
<li>SVM Classifier</li>
</ul></li>
<li><p>We will also try to search for best hyper-params to produce the best results for models.</p></li>
<li><p>Finally we will compare all the models using different metrics of <strong>Precision, Recall, Accuracy, ROC, PR curves</strong></p></li>
<li><p><strong>Comments are put wherever necessary and if the code is repetitive it’s not commented since the logic is same as earlier commented code</strong></p></li>
</ul>
<section id="importing-the-necessary-libraries" class="level2">
<h2 class="anchored" data-anchor-id="importing-the-necessary-libraries">Importing the necessary Libraries</h2>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-06-03T11:04:19.201651Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-06-03T11:04:19.200565Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-06-03T11:04:19.211070Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-06-03T11:04:19.210084Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2023-06-03T11:04:19.201609Z&quot;}" data-execution_count="280">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pyarrow <span class="im">as</span> pa</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> polars <span class="im">as</span> pl</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> vaex <span class="im">as</span> vx</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="co">#import pyarrow.parquet as pq</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="co">#import dask.dataframe as dd</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> seaborn <span class="im">as</span> sns</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>sns.set_style(<span class="st">'darkgrid'</span>)</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> plotly.graph_objects <span class="im">as</span> go</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> nltk.corpus <span class="im">import</span> stopwords</span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn <span class="im">import</span> svm</span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.metrics <span class="im">import</span> classification_report, confusion_matrix, accuracy_score, f1_score, roc_curve, precision_recall_curve, average_precision_score</span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.model_selection <span class="im">import</span> train_test_split, GridSearchCV</span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.naive_bayes <span class="im">import</span> CategoricalNB, BernoulliNB, MultinomialNB, GaussianNB</span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.neural_network <span class="im">import</span> MLPClassifier</span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.ensemble <span class="im">import</span> RandomForestClassifier</span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> xgboost <span class="im">import</span> XGBClassifier</span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.tree <span class="im">import</span> DecisionTreeClassifier, plot_tree</span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.linear_model <span class="im">import</span> LogisticRegression</span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.preprocessing <span class="im">import</span> MinMaxScaler, label_binarize</span>
<span id="cb1-26"><a href="#cb1-26" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.impute <span class="im">import</span> SimpleImputer</span>
<span id="cb1-27"><a href="#cb1-27" aria-hidden="true" tabindex="-1"></a><span class="co">#from ydata_profiling import ProfileReport</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="loading-splitting-sampling-the-dataset" class="level2">
<h2 class="anchored" data-anchor-id="loading-splitting-sampling-the-dataset">Loading, Splitting &amp; Sampling the Dataset</h2>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-06-03T11:04:21.704172Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-06-03T11:04:21.703461Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-06-03T11:04:21.760689Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-06-03T11:04:21.759710Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2023-06-03T11:04:21.704138Z&quot;}" data-execution_count="281">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>df_model <span class="op">=</span> pd.read_pickle(<span class="st">"/kaggle/input/us-accidents-processed/final_df.pickle"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-06-03T11:04:22.208890Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-06-03T11:04:22.208022Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-06-03T11:04:22.242067Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-06-03T11:04:22.240992Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2023-06-03T11:04:22.208845Z&quot;}" data-execution_count="282">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>df_model.info()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;class 'pandas.core.frame.DataFrame'&gt;
Index: 252372 entries, A-516257 to A-4833008
Data columns (total 56 columns):
 #   Column                              Non-Null Count   Dtype  
---  ------                              --------------   -----  
 0   Severity                            252372 non-null  uint8  
 1   Start_Lat                           252372 non-null  float32
 2   Start_Lng                           252372 non-null  float32
 3   Distance(mi)                        252372 non-null  float32
 4   Temperature(F)                      252372 non-null  float32
 5   Humidity(%)                         252372 non-null  float32
 6   Pressure(in)                        252372 non-null  float32
 7   Wind_Speed(mph)                     252372 non-null  float32
 8   Amenity                             252372 non-null  uint8  
 9   Crossing                            252372 non-null  uint8  
 10  Junction                            252372 non-null  uint8  
 11  No_Exit                             252372 non-null  uint8  
 12  Railway                             252372 non-null  uint8  
 13  Station                             252372 non-null  uint8  
 14  Stop                                252372 non-null  uint8  
 15  Traffic_Signal                      252372 non-null  uint8  
 16  Year                                252372 non-null  float32
 17  Hour                                252372 non-null  float32
 18  Weekday_Mon                         252372 non-null  uint8  
 19  Weekday_Sat                         252372 non-null  uint8  
 20  Weekday_Sun                         252372 non-null  uint8  
 21  Weekday_Thu                         252372 non-null  uint8  
 22  Weekday_Tue                         252372 non-null  uint8  
 23  Weekday_Wed                         252372 non-null  uint8  
 24  Wind_Direction_North                252372 non-null  uint8  
 25  Wind_Direction_South                252372 non-null  uint8  
 26  Wind_Direction_Variable             252372 non-null  uint8  
 27  Wind_Direction_West                 252372 non-null  uint8  
 28  Weather_Condition_Cloudy            252372 non-null  uint8  
 29  Weather_Condition_Fog               252372 non-null  uint8  
 30  Weather_Condition_Funnel Cloud      252372 non-null  uint8  
 31  Weather_Condition_Hail              252372 non-null  uint8  
 32  Weather_Condition_Haze              252372 non-null  uint8  
 33  Weather_Condition_Light Haze        252372 non-null  uint8  
 34  Weather_Condition_Rain              252372 non-null  uint8  
 35  Weather_Condition_Sand              252372 non-null  uint8  
 36  Weather_Condition_Scattered Clouds  252372 non-null  uint8  
 37  Weather_Condition_Smoke             252372 non-null  uint8  
 38  Weather_Condition_Snow              252372 non-null  uint8  
 39  Weather_Condition_Thunderstorm      252372 non-null  uint8  
 40  Weather_Condition_Tornado           252372 non-null  uint8  
 41  Weather_Condition_Windy             252372 non-null  uint8  
 42  Month_Aug                           252372 non-null  uint8  
 43  Month_Dec                           252372 non-null  uint8  
 44  Month_Feb                           252372 non-null  uint8  
 45  Month_Jan                           252372 non-null  uint8  
 46  Month_Jul                           252372 non-null  uint8  
 47  Month_Jun                           252372 non-null  uint8  
 48  Month_Mar                           252372 non-null  uint8  
 49  Month_May                           252372 non-null  uint8  
 50  Month_Nov                           252372 non-null  uint8  
 51  Month_Oct                           252372 non-null  uint8  
 52  Month_Sep                           252372 non-null  uint8  
 53  Source_Source2                      252372 non-null  uint8  
 54  Source_Source3                      252372 non-null  uint8  
 55  city_mean_encoded                   252372 non-null  float32
dtypes: float32(10), uint8(46)
memory usage: 22.6+ MB</code></pre>
</div>
</div>
<section id="formulas" class="level3">
<h3 class="anchored" data-anchor-id="formulas">Formulas</h3>
<p><span class="math display">\[
Precision = \frac{TP}{TP+FP}
\]</span></p>
<p><span class="math display">\[
TPR/Recall = \frac{TP}{TP+FN}
\]</span></p>
<p><span class="math display">\[
Accuracy: \frac{TP+TN}{TP+TN+FP+FN}
\]</span></p>
<p><span class="math display">\[
FPR = \frac{FP}{TN+FP}
\]</span> ” <span class="math display">\[
F1 = \frac{2*Precision*Recall}{Precision+Recall}= \frac{2*TP}{2*TP+FP+FN}
\]</span></p>
<section id="metrics" class="level4">
<h4 class="anchored" data-anchor-id="metrics">Metrics</h4>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-06-03T11:04:23.462087Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-06-03T11:04:23.461394Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-06-03T11:04:23.467393Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-06-03T11:04:23.466477Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2023-06-03T11:04:23.462054Z&quot;}" data-execution_count="283">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co">### Storing every models following metrics in dictionary</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>accuracy <span class="op">=</span> <span class="bu">dict</span>()</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>precision <span class="op">=</span> <span class="bu">dict</span>()</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>recall <span class="op">=</span> <span class="bu">dict</span>()</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>f1 <span class="op">=</span> <span class="bu">dict</span>()</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>fpr <span class="op">=</span> <span class="bu">dict</span>() </span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>tpr <span class="op">=</span> <span class="bu">dict</span>()</span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>best_params <span class="op">=</span> <span class="bu">dict</span>() <span class="co">#Storing the best parameters for models that use gridsearchCV</span></span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>models <span class="op">=</span> <span class="bu">dict</span>() <span class="co"># Storing the trained model in dictionary</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="splitting-the-data-into-test-train-and-validation-sets" class="level4">
<h4 class="anchored" data-anchor-id="splitting-the-data-into-test-train-and-validation-sets">Splitting the data into test, train and validation sets</h4>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-06-03T11:04:25.566816Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-06-03T11:04:25.566206Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-06-03T11:04:25.680245Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-06-03T11:04:25.679236Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2023-06-03T11:04:25.566782Z&quot;}" data-execution_count="284">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Train/Validation - Test split</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>X,X_test <span class="op">=</span> train_test_split(df_model,test_size <span class="op">=</span> <span class="fl">.2</span>, random_state <span class="op">=</span> <span class="dv">42</span>)</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(X.shape, X_test.shape)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>(201897, 56) (50475, 56)</code></pre>
</div>
</div>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-06-03T11:04:26.336719Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-06-03T11:04:26.336342Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-06-03T11:04:26.341952Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-06-03T11:04:26.340926Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2023-06-03T11:04:26.336689Z&quot;}" data-execution_count="285">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>y <span class="op">=</span> X[<span class="st">"Severity"</span>] <span class="co"># Separating the target variable from the dataset</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-06-03T11:04:27.228303Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-06-03T11:04:27.227940Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-06-03T11:04:27.251964Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-06-03T11:04:27.251049Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2023-06-03T11:04:27.228273Z&quot;}" data-execution_count="286">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>X_model <span class="op">=</span> X.drop([<span class="st">"Severity"</span>],axis <span class="op">=</span> <span class="dv">1</span>) <span class="co"># Createing a df of only features</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-06-03T11:04:27.529716Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-06-03T11:04:27.528896Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-06-03T11:04:27.753527Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-06-03T11:04:27.752517Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2023-06-03T11:04:27.529675Z&quot;}" data-execution_count="287">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Train/Validation Split</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>X_train, X_val, y_train, y_val <span class="op">=</span> train_test_split(X_model,y,random_state <span class="op">=</span> <span class="dv">42</span>,test_size <span class="op">=</span> <span class="fl">0.20</span>)</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(X_train.shape, X_val.shape, y_train.shape, y_val.shape)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>(161517, 55) (40380, 55) (161517,) (40380,)</code></pre>
</div>
</div>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-06-03T11:04:27.784088Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-06-03T11:04:27.783530Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-06-03T11:04:27.825570Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-06-03T11:04:27.824668Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2023-06-03T11:04:27.784059Z&quot;}" data-execution_count="288">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co">## We will run the grid search cv only on 24_000 samples, to use less compute but find the best params</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="co">## Doing this is necessary cause few model being complex like SVM take too much time to find best params </span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>X_sample <span class="op">=</span> X.sample(<span class="dv">24_000</span>, random_state <span class="op">=</span> <span class="dv">42</span>)</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>y_sample_train <span class="op">=</span> X_sample[<span class="st">"Severity"</span>]</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>X_sample_train <span class="op">=</span> X_sample.drop([<span class="st">"Severity"</span>],axis <span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>X_train_sample, X_val_sample, y_train_sample, y_val_sample <span class="op">=</span> train_test_split(X_sample_train, y_sample_train, test_size <span class="op">=</span> <span class="fl">.2</span>, random_state <span class="op">=</span> <span class="dv">42</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-06-03T11:04:28.048403Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-06-03T11:04:28.047358Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-06-03T11:04:28.055242Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-06-03T11:04:28.054239Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2023-06-03T11:04:28.048361Z&quot;}" data-execution_count="289">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>X_train_sample.shape, X_val_sample.shape</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="289">
<pre><code>((19200, 55), (4800, 55))</code></pre>
</div>
</div>
</section>
</section>
</section>
<section id="model-training" class="level2">
<h2 class="anchored" data-anchor-id="model-training">Model Training</h2>
<section id="logistic-regression-model" class="level3">
<h3 class="anchored" data-anchor-id="logistic-regression-model">Logistic Regression Model</h3>
<section id="grid-search-cv5-folds-run-to-find-best-params" class="level4">
<h4 class="anchored" data-anchor-id="grid-search-cv5-folds-run-to-find-best-params">Grid Search CV(5-folds) RUN to find best Params</h4>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-06-03T11:04:29.333504Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-06-03T11:04:29.333086Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-06-03T11:04:53.167704Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-06-03T11:04:53.164398Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2023-06-03T11:04:29.333471Z&quot;}" data-execution_count="290">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Defining the model and it's parameters</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>lr <span class="op">=</span> LogisticRegression(random_state <span class="op">=</span> <span class="dv">42</span>, n_jobs <span class="op">=-</span><span class="dv">1</span>,max_iter <span class="op">=</span> <span class="dv">100</span>)</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>params <span class="op">=</span> {<span class="st">"solver"</span>: [<span class="st">"sag"</span>,<span class="st">"saga"</span>]}</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Performing Grid Search to find best params</span></span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>grid <span class="op">=</span> GridSearchCV(lr, params, n_jobs <span class="op">=</span><span class="dv">1</span>,verbose <span class="op">=</span> <span class="dv">0</span>,)</span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>grid.fit(X_train_sample, y_train_sample)</span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Best parameter scores:"</span>)</span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(grid.best_params_)</span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Storing the best Params to be used in training on whole dataset if it's a best model compared to others</span></span>
<span id="cb15-13"><a href="#cb15-13" aria-hidden="true" tabindex="-1"></a>best_params[<span class="st">"lr"</span>] <span class="op">=</span> grid.best_params_</span>
<span id="cb15-14"><a href="#cb15-14" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Train score: </span><span class="sc">{</span>grid<span class="sc">.</span>score(X_train_sample, y_train_sample)<span class="sc">}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Best parameter scores:
{'solver': 'saga'}
Train score: 0.6977083333333334</code></pre>
</div>
</div>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-06-03T11:04:53.170981Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-06-03T11:04:53.170482Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-06-03T11:04:53.208899Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-06-03T11:04:53.207808Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2023-06-03T11:04:53.170934Z&quot;}" data-execution_count="291">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Observing the data frame on fitted models </span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> (pd.DataFrame(grid.cv_results_,index <span class="op">=</span> [<span class="st">'sag'</span>,<span class="st">'saga'</span>])).drop([<span class="st">"param_solver"</span>],axis <span class="op">=</span> <span class="dv">1</span>)</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> df.rename_axis(<span class="st">'Solver'</span>, axis<span class="op">=</span><span class="st">'index'</span>)</span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>df</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="291">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">mean_fit_time</th>
<th data-quarto-table-cell-role="th">std_fit_time</th>
<th data-quarto-table-cell-role="th">mean_score_time</th>
<th data-quarto-table-cell-role="th">std_score_time</th>
<th data-quarto-table-cell-role="th">params</th>
<th data-quarto-table-cell-role="th">split0_test_score</th>
<th data-quarto-table-cell-role="th">split1_test_score</th>
<th data-quarto-table-cell-role="th">split2_test_score</th>
<th data-quarto-table-cell-role="th">split3_test_score</th>
<th data-quarto-table-cell-role="th">split4_test_score</th>
<th data-quarto-table-cell-role="th">mean_test_score</th>
<th data-quarto-table-cell-role="th">std_test_score</th>
<th data-quarto-table-cell-role="th">rank_test_score</th>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">Solver</th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">sag</td>
<td>1.262635</td>
<td>0.397594</td>
<td>0.006319</td>
<td>0.003799</td>
<td>{'solver': 'sag'}</td>
<td>0.692448</td>
<td>0.698438</td>
<td>0.678125</td>
<td>0.701823</td>
<td>0.698177</td>
<td>0.693802</td>
<td>0.008397</td>
<td>2</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">saga</td>
<td>2.885478</td>
<td>0.244466</td>
<td>0.004469</td>
<td>0.000096</td>
<td>{'solver': 'saga'}</td>
<td>0.692708</td>
<td>0.698698</td>
<td>0.678385</td>
<td>0.701823</td>
<td>0.698177</td>
<td>0.693958</td>
<td>0.008321</td>
<td>1</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
<section id="running-the-best-params-logistic-regression-model" class="level4">
<h4 class="anchored" data-anchor-id="running-the-best-params-logistic-regression-model">Running the best params logistic regression model</h4>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-06-03T11:04:53.211180Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-06-03T11:04:53.210583Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-06-03T11:04:56.546587Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-06-03T11:04:56.545562Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2023-06-03T11:04:53.211143Z&quot;}" data-execution_count="292">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Best Param scores for Logistic Regression:"</span>)</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>lr <span class="op">=</span> LogisticRegression(<span class="op">**</span>grid.best_params_, random_state <span class="op">=</span> <span class="dv">42</span>,)</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>lr.fit(X_train_sample, y_train_sample)</span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Storing the model trained with best params later used for visualizations</span></span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>models[<span class="st">"Logistic Regression"</span>] <span class="op">=</span> lr</span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Train score:"</span>, lr.score(X_train_sample, y_train_sample))</span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Validation score:"</span>, lr.score(X_val_sample, y_val_sample))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Best Param scores for Logistic Regression:
Train score: 0.6977083333333334
Validation score: 0.6827083333333334</code></pre>
</div>
</div>
</section>
<section id="logistic-regression-conf.-matrix-on-validation-set" class="level4">
<h4 class="anchored" data-anchor-id="logistic-regression-conf.-matrix-on-validation-set">Logistic Regression Conf. Matrix on Validation set</h4>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-06-03T11:04:56.550607Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-06-03T11:04:56.549481Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-06-03T11:04:57.017258Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-06-03T11:04:57.016359Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2023-06-03T11:04:56.550573Z&quot;}" data-execution_count="293">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>y_pred <span class="op">=</span> lr.predict(X_val_sample)</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>confmat <span class="op">=</span> confusion_matrix(y_true<span class="op">=</span>y_val_sample, y_pred<span class="op">=</span>y_pred)</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>index <span class="op">=</span> [<span class="st">"Actual Severity 1"</span>, <span class="st">"Actual Severity 2"</span>, <span class="st">"Actual Severity 3"</span>, <span class="st">"Actual Severity 4"</span>]</span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>columns <span class="op">=</span> [<span class="st">"Predicted Severity 1"</span>, <span class="st">"Predicted Severity 2"</span>, <span class="st">"Predicted Severity 3"</span>, <span class="st">"Predicted Severity 4"</span>]</span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a>conf_matrix <span class="op">=</span> pd.DataFrame(data<span class="op">=</span>confmat, columns<span class="op">=</span>columns, index<span class="op">=</span>index)</span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">8</span>, <span class="dv">5</span>))</span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a>sns.heatmap(conf_matrix, annot<span class="op">=</span><span class="va">True</span>, fmt<span class="op">=</span><span class="st">"d"</span>, cmap<span class="op">=</span><span class="st">"YlGnBu"</span>)</span>
<span id="cb20-11"><a href="#cb20-11" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"Confusion Matrix - Logistic Regression"</span>)</span>
<span id="cb20-12"><a href="#cb20-12" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="project-4-us-accidents-model-runs_files/figure-html/cell-15-output-1.png" class="img-fluid"></p>
</div>
</div>
</section>
<section id="metrics-scores-and-metric-visualizations-for-logistic-regression-with-best-params" class="level4">
<h4 class="anchored" data-anchor-id="metrics-scores-and-metric-visualizations-for-logistic-regression-with-best-params">Metrics Scores and Metric Visualizations for Logistic Regression with best params</h4>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-06-03T11:04:57.019544Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-06-03T11:04:57.018941Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-06-03T11:04:57.128646Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-06-03T11:04:57.127640Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2023-06-03T11:04:57.019510Z&quot;}" data-execution_count="294">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Observing the classification report for Logistic Regression</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>y_pred <span class="op">=</span> lr.predict(X_val_sample)</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Store the respective scores</span></span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>accuracy[<span class="st">"Logistic Regression"</span>] <span class="op">=</span> accuracy_score(y_val_sample,y_pred)</span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a>f1[<span class="st">"Logistic Regression"</span>] <span class="op">=</span> f1_score(y_val_sample,y_pred,average <span class="op">=</span> <span class="st">'macro'</span>)</span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Classification report on train and Val data</span></span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(classification_report(y_train_sample,lr.predict(X_train_sample)))</span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(classification_report(y_val_sample,y_pred))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>              precision    recall  f1-score   support

           1       0.75      0.86      0.80      4822
           2       0.61      0.39      0.47      4734
           3       0.72      0.79      0.75      4865
           4       0.67      0.75      0.71      4779

    accuracy                           0.70     19200
   macro avg       0.69      0.70      0.68     19200
weighted avg       0.69      0.70      0.68     19200

              precision    recall  f1-score   support

           1       0.72      0.85      0.78      1193
           2       0.60      0.39      0.47      1232
           3       0.72      0.75      0.73      1206
           4       0.66      0.75      0.70      1169

    accuracy                           0.68      4800
   macro avg       0.67      0.69      0.67      4800
weighted avg       0.67      0.68      0.67      4800
</code></pre>
</div>
</div>
</section>
<section id="logistic-regression-precision-vs-recall-curve-on-validation-set" class="level4">
<h4 class="anchored" data-anchor-id="logistic-regression-precision-vs-recall-curve-on-validation-set">Logistic Regression Precision vs Recall Curve on Validation set</h4>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-06-03T11:04:57.130791Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-06-03T11:04:57.130133Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-06-03T11:04:57.595290Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-06-03T11:04:57.594386Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2023-06-03T11:04:57.130746Z&quot;}" data-execution_count="295">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Creates a 2d array from 1d array of y_val_sample, where each instance represents presence of one severity via 1 and rest are 0's.</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a><span class="co"># This is necessary since predictions are in 2d format </span></span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Creating a pr curve tests these arrays i.e. true_y_values and predictions on different </span></span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a><span class="co"># thresholds, so binarizing is helpful to make y_val and preds of same size to be compared</span></span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a>Y <span class="op">=</span> label_binarize(y_val_sample, classes<span class="op">=</span>[<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>])</span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a>y_score <span class="op">=</span> lr.predict_proba(X_val_sample)</span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a><span class="co">#Storing the metrics for later viz's</span></span>
<span id="cb23-11"><a href="#cb23-11" aria-hidden="true" tabindex="-1"></a>precision[<span class="st">"Logistic Regression"</span>], recall[<span class="st">"Logistic Regression"</span>], thresholds <span class="op">=</span> precision_recall_curve(Y.ravel(), y_score.ravel())</span>
<span id="cb23-12"><a href="#cb23-12" aria-hidden="true" tabindex="-1"></a>fpr[<span class="st">"Logistic Regression"</span>], tpr[<span class="st">"Logistic Regression"</span>], _ <span class="op">=</span> roc_curve(Y.ravel(), y_score.ravel())</span>
<span id="cb23-13"><a href="#cb23-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-14"><a href="#cb23-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Plotting the PR Curve</span></span>
<span id="cb23-15"><a href="#cb23-15" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">18</span>, <span class="dv">10</span>))</span>
<span id="cb23-16"><a href="#cb23-16" aria-hidden="true" tabindex="-1"></a>plt.step(recall[<span class="st">"Logistic Regression"</span>], precision[<span class="st">"Logistic Regression"</span>], where<span class="op">=</span><span class="st">"post"</span>)</span>
<span id="cb23-17"><a href="#cb23-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-18"><a href="#cb23-18" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">"Recall"</span>)</span>
<span id="cb23-19"><a href="#cb23-19" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">"Precision"</span>)</span>
<span id="cb23-20"><a href="#cb23-20" aria-hidden="true" tabindex="-1"></a>plt.xlim([<span class="dv">0</span>, <span class="dv">1</span>])</span>
<span id="cb23-21"><a href="#cb23-21" aria-hidden="true" tabindex="-1"></a>plt.ylim([<span class="dv">0</span>, <span class="fl">1.01</span>])</span>
<span id="cb23-22"><a href="#cb23-22" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"PR Curve - Logisitc Regression"</span>)</span>
<span id="cb23-23"><a href="#cb23-23" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb23-24"><a href="#cb23-24" aria-hidden="true" tabindex="-1"></a><span class="co"># The curve is better the one which is near to right hand corner [1,1]</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="project-4-us-accidents-model-runs_files/figure-html/cell-17-output-1.png" class="img-fluid"></p>
</div>
</div>
</section>
<section id="logistic-regression-roc-curve-on-validation-set" class="level4">
<h4 class="anchored" data-anchor-id="logistic-regression-roc-curve-on-validation-set">Logistic Regression ROC Curve on Validation set</h4>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-06-03T11:04:57.597926Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-06-03T11:04:57.597176Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-06-03T11:04:58.003200Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-06-03T11:04:58.002293Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2023-06-03T11:04:57.597889Z&quot;}" data-execution_count="296">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">18</span>, <span class="dv">10</span>))</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>plt.step(fpr[<span class="st">"Logistic Regression"</span>], tpr[<span class="st">"Logistic Regression"</span>], where<span class="op">=</span><span class="st">"post"</span>)</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"ROC curve - Logistic Regression"</span>)</span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">"False Positive Rate"</span>)</span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">"True Positive Rate"</span>)</span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a>plt.xlim([<span class="dv">0</span>, <span class="dv">1</span>])</span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a>plt.ylim([<span class="dv">0</span>, <span class="fl">1.01</span>])</span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a><span class="co"># The curve is better the one which is near to left hand corner [0,1]</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="project-4-us-accidents-model-runs_files/figure-html/cell-18-output-1.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-06-03T11:04:58.005831Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-06-03T11:04:58.004784Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-06-03T11:04:58.010279Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-06-03T11:04:58.009222Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2023-06-03T11:04:58.005796Z&quot;}" data-execution_count="297">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="co"># thresholds.shape, y_score.ravel().shape # We have this difference because thresholds are chosen as many different probability instances we havex</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a><span class="co"># print(Y.shape,Y.ravel().shape,y_score.shape,y_score.ravel().shape)</span></span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a><span class="co"># y = np.array([[1,2,3,4],[4,3,2,1],[1,2,3,4]])</span></span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a><span class="co"># unique,counts = np.unique(y,return_counts=True)</span></span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a><span class="co"># print(unique)</span></span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a><span class="co"># unique,counts = np.unique(y_score,return_counts = True)</span></span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a><span class="co"># print(len(unique)) # So we only have these many instances, which have unique prediction probabilities</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="decision-tree-model" class="level3">
<h3 class="anchored" data-anchor-id="decision-tree-model">Decision Tree Model</h3>
<section id="decision-tree-grid-search-cv5-folds-run-to-find-best-params" class="level4">
<h4 class="anchored" data-anchor-id="decision-tree-grid-search-cv5-folds-run-to-find-best-params">Decision Tree Grid Search CV(5-folds) Run to find best params</h4>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-06-03T11:04:58.012174Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-06-03T11:04:58.011668Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-06-03T11:05:04.333363Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-06-03T11:05:04.331501Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2023-06-03T11:04:58.012141Z&quot;}" data-execution_count="298">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>dtc <span class="op">=</span> DecisionTreeClassifier(random_state<span class="op">=</span><span class="dv">42</span>)</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>parameters <span class="op">=</span> [{<span class="st">"criterion"</span>: [<span class="st">"gini"</span>, <span class="st">"entropy"</span>], <span class="st">"max_depth"</span>: [<span class="dv">5</span>, <span class="dv">10</span>, <span class="dv">15</span>, <span class="dv">30</span>]}]</span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a>grid <span class="op">=</span> GridSearchCV(dtc, parameters, verbose <span class="op">=</span> <span class="dv">0</span>, n_jobs<span class="op">=-</span><span class="dv">1</span>)</span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a>grid.fit(X_train_sample, y_train_sample)</span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Best param scores for Decision Tree Classifier:"</span>)</span>
<span id="cb26-8"><a href="#cb26-8" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(grid.best_params_)</span>
<span id="cb26-9"><a href="#cb26-9" aria-hidden="true" tabindex="-1"></a>best_params[<span class="st">"dtc"</span>] <span class="op">=</span> grid.best_params_</span>
<span id="cb26-10"><a href="#cb26-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-11"><a href="#cb26-11" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Train score:"</span>, grid.score(X_train_sample, y_train_sample))</span>
<span id="cb26-12"><a href="#cb26-12" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Validation score:"</span>, grid.score(X_val_sample, y_val_sample))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Best param scores for Decision Tree Classifier:
{'criterion': 'entropy', 'max_depth': 10}
Train score: 0.823125
Validation score: 0.7672916666666667</code></pre>
</div>
</div>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-06-03T11:05:04.339476Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-06-03T11:05:04.339057Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-06-03T11:05:04.367330Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-06-03T11:05:04.366194Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2023-06-03T11:05:04.339415Z&quot;}" data-execution_count="299">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>pd.DataFrame(grid.cv_results_).sort_values(by <span class="op">=</span> <span class="st">'rank_test_score'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="299">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">mean_fit_time</th>
<th data-quarto-table-cell-role="th">std_fit_time</th>
<th data-quarto-table-cell-role="th">mean_score_time</th>
<th data-quarto-table-cell-role="th">std_score_time</th>
<th data-quarto-table-cell-role="th">param_criterion</th>
<th data-quarto-table-cell-role="th">param_max_depth</th>
<th data-quarto-table-cell-role="th">params</th>
<th data-quarto-table-cell-role="th">split0_test_score</th>
<th data-quarto-table-cell-role="th">split1_test_score</th>
<th data-quarto-table-cell-role="th">split2_test_score</th>
<th data-quarto-table-cell-role="th">split3_test_score</th>
<th data-quarto-table-cell-role="th">split4_test_score</th>
<th data-quarto-table-cell-role="th">mean_test_score</th>
<th data-quarto-table-cell-role="th">std_test_score</th>
<th data-quarto-table-cell-role="th">rank_test_score</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">5</td>
<td>0.255957</td>
<td>0.014855</td>
<td>0.005243</td>
<td>0.000257</td>
<td>entropy</td>
<td>10</td>
<td>{'criterion': 'entropy', 'max_depth': 10}</td>
<td>0.752865</td>
<td>0.757812</td>
<td>0.752604</td>
<td>0.768750</td>
<td>0.759375</td>
<td>0.758281</td>
<td>0.005875</td>
<td>1</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>0.194180</td>
<td>0.013044</td>
<td>0.005411</td>
<td>0.000337</td>
<td>gini</td>
<td>10</td>
<td>{'criterion': 'gini', 'max_depth': 10}</td>
<td>0.749479</td>
<td>0.763802</td>
<td>0.748958</td>
<td>0.763281</td>
<td>0.763281</td>
<td>0.757760</td>
<td>0.006979</td>
<td>2</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>0.140707</td>
<td>0.008412</td>
<td>0.004997</td>
<td>0.000269</td>
<td>entropy</td>
<td>5</td>
<td>{'criterion': 'entropy', 'max_depth': 5}</td>
<td>0.739062</td>
<td>0.742969</td>
<td>0.744792</td>
<td>0.741406</td>
<td>0.742969</td>
<td>0.742240</td>
<td>0.001916</td>
<td>3</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">0</td>
<td>0.104274</td>
<td>0.002262</td>
<td>0.005177</td>
<td>0.000280</td>
<td>gini</td>
<td>5</td>
<td>{'criterion': 'gini', 'max_depth': 5}</td>
<td>0.738802</td>
<td>0.744792</td>
<td>0.728125</td>
<td>0.746094</td>
<td>0.747917</td>
<td>0.741146</td>
<td>0.007192</td>
<td>4</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>0.266166</td>
<td>0.012563</td>
<td>0.005544</td>
<td>0.000080</td>
<td>gini</td>
<td>15</td>
<td>{'criterion': 'gini', 'max_depth': 15}</td>
<td>0.736979</td>
<td>0.741927</td>
<td>0.727604</td>
<td>0.734115</td>
<td>0.736979</td>
<td>0.735521</td>
<td>0.004689</td>
<td>5</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">6</td>
<td>0.328951</td>
<td>0.009996</td>
<td>0.005584</td>
<td>0.000248</td>
<td>entropy</td>
<td>15</td>
<td>{'criterion': 'entropy', 'max_depth': 15}</td>
<td>0.727604</td>
<td>0.743490</td>
<td>0.724740</td>
<td>0.735417</td>
<td>0.733854</td>
<td>0.733021</td>
<td>0.006541</td>
<td>6</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">7</td>
<td>0.348827</td>
<td>0.017845</td>
<td>0.005383</td>
<td>0.000513</td>
<td>entropy</td>
<td>30</td>
<td>{'criterion': 'entropy', 'max_depth': 30}</td>
<td>0.710938</td>
<td>0.717448</td>
<td>0.710938</td>
<td>0.713281</td>
<td>0.710938</td>
<td>0.712708</td>
<td>0.002538</td>
<td>7</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>0.334237</td>
<td>0.034283</td>
<td>0.007774</td>
<td>0.003789</td>
<td>gini</td>
<td>30</td>
<td>{'criterion': 'gini', 'max_depth': 30}</td>
<td>0.712760</td>
<td>0.711979</td>
<td>0.706771</td>
<td>0.709375</td>
<td>0.711719</td>
<td>0.710521</td>
<td>0.002189</td>
<td>8</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
<section id="running-the-best-params-decision-tree-model" class="level4">
<h4 class="anchored" data-anchor-id="running-the-best-params-decision-tree-model">Running the best params Decision Tree model</h4>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-06-03T11:05:04.370757Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-06-03T11:05:04.369128Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-06-03T11:05:04.586830Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-06-03T11:05:04.585814Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2023-06-03T11:05:04.370721Z&quot;}" data-execution_count="300">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Best Param scores for Decision Tree Classifier:"</span>)</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>dtc <span class="op">=</span> DecisionTreeClassifier(<span class="op">**</span>grid.best_params_, random_state <span class="op">=</span> <span class="dv">42</span>)</span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>dtc.fit(X_train_sample, y_train_sample)</span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Storing the model trained with best params later used for visualizations</span></span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a>models[<span class="st">"Decision Tree"</span>] <span class="op">=</span> dtc</span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-9"><a href="#cb29-9" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Train score:"</span>, dtc.score(X_train_sample, y_train_sample))</span>
<span id="cb29-10"><a href="#cb29-10" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Validation score:"</span>, dtc.score(X_val_sample, y_val_sample))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Best Param scores for Decision Tree Classifier:
Train score: 0.823125
Validation score: 0.7672916666666667</code></pre>
</div>
</div>
</section>
<section id="decision-tree-conf.-matrix-on-validation-set" class="level4">
<h4 class="anchored" data-anchor-id="decision-tree-conf.-matrix-on-validation-set">Decision Tree Conf. Matrix on Validation set</h4>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-06-03T11:05:04.588765Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-06-03T11:05:04.588394Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-06-03T11:05:04.996256Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-06-03T11:05:04.995372Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2023-06-03T11:05:04.588733Z&quot;}" data-execution_count="301">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>y_pred <span class="op">=</span> dtc.predict(X_val_sample)</span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>confmat <span class="op">=</span> confusion_matrix(y_true<span class="op">=</span>y_val_sample, y_pred<span class="op">=</span>y_pred)</span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a>index <span class="op">=</span> [<span class="st">"Actual Severity 1"</span>, <span class="st">"Actual Severity 2"</span>, <span class="st">"Actual Severity 3"</span>, <span class="st">"Actual Severity 4"</span>]</span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a>columns <span class="op">=</span> [<span class="st">"Predicted Severity 1"</span>, <span class="st">"Predicted Severity 2"</span>, <span class="st">"Predicted Severity 3"</span>, <span class="st">"Predicted Severity 4"</span>]</span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true" tabindex="-1"></a>conf_matrix <span class="op">=</span> pd.DataFrame(data<span class="op">=</span>confmat, columns<span class="op">=</span>columns, index<span class="op">=</span>index)</span>
<span id="cb31-8"><a href="#cb31-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-9"><a href="#cb31-9" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">8</span>, <span class="dv">5</span>))</span>
<span id="cb31-10"><a href="#cb31-10" aria-hidden="true" tabindex="-1"></a>sns.heatmap(conf_matrix, annot<span class="op">=</span><span class="va">True</span>, fmt<span class="op">=</span><span class="st">"d"</span>, cmap<span class="op">=</span><span class="st">"YlGnBu"</span>)</span>
<span id="cb31-11"><a href="#cb31-11" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"Confusion Matrix - Decision Tree"</span>)</span>
<span id="cb31-12"><a href="#cb31-12" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="project-4-us-accidents-model-runs_files/figure-html/cell-23-output-1.png" class="img-fluid"></p>
</div>
</div>
</section>
<section id="metrics-scores-and-metric-visualizations-for-decision-tree-with-best-params" class="level4">
<h4 class="anchored" data-anchor-id="metrics-scores-and-metric-visualizations-for-decision-tree-with-best-params">Metrics Scores and Metric Visualizations for Decision Tree with best params</h4>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-06-03T11:05:04.999560Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-06-03T11:05:04.999227Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-06-03T11:05:05.061462Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-06-03T11:05:05.060476Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2023-06-03T11:05:04.999534Z&quot;}" data-execution_count="302">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>y_pred <span class="op">=</span> dtc.predict(X_val_sample)</span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a>accuracy[<span class="st">"Decision Tree"</span>] <span class="op">=</span> accuracy_score(y_val_sample, y_pred)</span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a>f1[<span class="st">"Decision Tree"</span>] <span class="op">=</span> f1_score(y_val_sample, y_pred, average<span class="op">=</span><span class="st">"macro"</span>)</span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(classification_report(y_train_sample, dtc.predict(X_train_sample)))</span>
<span id="cb32-7"><a href="#cb32-7" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(classification_report(y_val_sample, y_pred))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>              precision    recall  f1-score   support

           1       0.91      0.96      0.94      4822
           2       0.80      0.65      0.72      4734
           3       0.80      0.83      0.81      4865
           4       0.77      0.85      0.81      4779

    accuracy                           0.82     19200
   macro avg       0.82      0.82      0.82     19200
weighted avg       0.82      0.82      0.82     19200

              precision    recall  f1-score   support

           1       0.89      0.94      0.91      1193
           2       0.72      0.59      0.65      1232
           3       0.75      0.75      0.75      1206
           4       0.70      0.79      0.75      1169

    accuracy                           0.77      4800
   macro avg       0.77      0.77      0.76      4800
weighted avg       0.77      0.77      0.76      4800
</code></pre>
</div>
</div>
</section>
<section id="decision-tree-precision-vs-recall-curve-on-validation-set" class="level4">
<h4 class="anchored" data-anchor-id="decision-tree-precision-vs-recall-curve-on-validation-set">Decision Tree Precision vs Recall Curve on Validation set</h4>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-06-03T11:05:05.063595Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-06-03T11:05:05.062944Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-06-03T11:05:05.468005Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-06-03T11:05:05.465829Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2023-06-03T11:05:05.063558Z&quot;}" data-execution_count="303">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>Y <span class="op">=</span> label_binarize(y_val_sample, classes<span class="op">=</span>[<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>])</span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>y_score <span class="op">=</span> dtc.predict_proba(X_val_sample)</span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a>precision[<span class="st">"Decision Tree"</span>], recall[<span class="st">"Decision Tree"</span>], _ <span class="op">=</span> precision_recall_curve(Y.ravel(), y_score.ravel())</span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a>fpr[<span class="st">"Decision Tree"</span>], tpr[<span class="st">"Decision Tree"</span>], _ <span class="op">=</span> roc_curve(Y.ravel(), y_score.ravel())</span>
<span id="cb34-7"><a href="#cb34-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-8"><a href="#cb34-8" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">18</span>, <span class="dv">10</span>))</span>
<span id="cb34-9"><a href="#cb34-9" aria-hidden="true" tabindex="-1"></a>plt.step(recall[<span class="st">"Decision Tree"</span>], precision[<span class="st">"Decision Tree"</span>], where<span class="op">=</span><span class="st">"post"</span>)</span>
<span id="cb34-10"><a href="#cb34-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-11"><a href="#cb34-11" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">"Recall"</span>)</span>
<span id="cb34-12"><a href="#cb34-12" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">"Precision"</span>)</span>
<span id="cb34-13"><a href="#cb34-13" aria-hidden="true" tabindex="-1"></a>plt.xlim([<span class="dv">0</span>, <span class="dv">1</span>])</span>
<span id="cb34-14"><a href="#cb34-14" aria-hidden="true" tabindex="-1"></a>plt.ylim([<span class="dv">0</span>, <span class="fl">1.01</span>])</span>
<span id="cb34-15"><a href="#cb34-15" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"PR Curve - Decision Tree"</span>)</span>
<span id="cb34-16"><a href="#cb34-16" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="project-4-us-accidents-model-runs_files/figure-html/cell-25-output-1.png" class="img-fluid"></p>
</div>
</div>
</section>
<section id="decision-tree-roc-curve-on-validation-set" class="level4">
<h4 class="anchored" data-anchor-id="decision-tree-roc-curve-on-validation-set">Decision Tree ROC Curve on Validation set</h4>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-06-03T11:05:05.469733Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-06-03T11:05:05.469364Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-06-03T11:05:05.866291Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-06-03T11:05:05.865374Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2023-06-03T11:05:05.469706Z&quot;}" data-execution_count="304">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">18</span>, <span class="dv">10</span>))</span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>plt.step(fpr[<span class="st">"Decision Tree"</span>], tpr[<span class="st">"Decision Tree"</span>], where<span class="op">=</span><span class="st">"post"</span>)</span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"ROC curve - Decision Tree"</span>)</span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">"False Positive Rate"</span>)</span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">"True Positive Rate"</span>)</span>
<span id="cb35-7"><a href="#cb35-7" aria-hidden="true" tabindex="-1"></a>plt.xlim([<span class="dv">0</span>, <span class="dv">1</span>])</span>
<span id="cb35-8"><a href="#cb35-8" aria-hidden="true" tabindex="-1"></a>plt.ylim([<span class="dv">0</span>, <span class="fl">1.01</span>])</span>
<span id="cb35-9"><a href="#cb35-9" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="project-4-us-accidents-model-runs_files/figure-html/cell-26-output-1.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-06-03T11:05:05.868710Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-06-03T11:05:05.867735Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-06-03T11:05:06.469234Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-06-03T11:05:06.468356Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2023-06-03T11:05:05.868675Z&quot;}" data-execution_count="305">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>importances <span class="op">=</span> pd.DataFrame(np.zeros((X_train_sample.shape[<span class="dv">1</span>], <span class="dv">1</span>)), columns<span class="op">=</span>[<span class="st">"importance"</span>], index<span class="op">=</span>X_train_sample.columns)</span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>importances.iloc[:,<span class="dv">0</span>] <span class="op">=</span> dtc.feature_importances_</span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a>importances <span class="op">=</span> importances.sort_values(by<span class="op">=</span><span class="st">"importance"</span>, ascending<span class="op">=</span><span class="va">False</span>)[:<span class="dv">30</span>]</span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-7"><a href="#cb36-7" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">15</span>, <span class="dv">10</span>))</span>
<span id="cb36-8"><a href="#cb36-8" aria-hidden="true" tabindex="-1"></a>sns.barplot(x<span class="op">=</span><span class="st">"importance"</span>, y<span class="op">=</span>importances.index, data<span class="op">=</span>importances)</span>
<span id="cb36-9"><a href="#cb36-9" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="project-4-us-accidents-model-runs_files/figure-html/cell-27-output-1.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-06-03T11:05:06.471728Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-06-03T11:05:06.470717Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-06-03T11:05:08.976700Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-06-03T11:05:08.975691Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2023-06-03T11:05:06.471690Z&quot;}" data-execution_count="306">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(<span class="dv">30</span>, <span class="dv">15</span>))</span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>plot_tree(dtc, max_depth<span class="op">=</span><span class="dv">4</span>, fontsize<span class="op">=</span><span class="dv">10</span>, feature_names<span class="op">=</span>X_train_sample.columns.to_list(), class_names <span class="op">=</span> <span class="va">True</span>, filled<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="project-4-us-accidents-model-runs_files/figure-html/cell-28-output-1.png" class="img-fluid"></p>
</div>
</div>
</section>
</section>
<section id="random-forest-classifier" class="level3">
<h3 class="anchored" data-anchor-id="random-forest-classifier">Random Forest Classifier</h3>
<section id="random-forest-classifier-grid-search-cv-5---folds-run-to-find-best-params" class="level4">
<h4 class="anchored" data-anchor-id="random-forest-classifier-grid-search-cv-5---folds-run-to-find-best-params">Random Forest Classifier Grid Search CV (5 - folds) Run to find best params</h4>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-06-03T11:05:08.978651Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-06-03T11:05:08.978223Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-06-03T11:09:30.992669Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-06-03T11:09:30.991362Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2023-06-03T11:05:08.978617Z&quot;}" data-execution_count="307">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>rfc <span class="op">=</span> RandomForestClassifier(n_jobs<span class="op">=-</span><span class="dv">1</span>, random_state<span class="op">=</span><span class="dv">42</span>)</span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>parameters <span class="op">=</span> [{<span class="st">"n_estimators"</span>: [<span class="dv">50</span>, <span class="dv">100</span>, <span class="dv">200</span>, <span class="dv">500</span>], <span class="st">"max_depth"</span>: [<span class="dv">5</span>, <span class="dv">10</span>, <span class="dv">15</span>, <span class="dv">30</span>]}]</span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a>grid <span class="op">=</span> GridSearchCV(rfc, parameters, verbose <span class="op">=</span> <span class="dv">0</span>, n_jobs<span class="op">=-</span><span class="dv">1</span>)</span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a>grid.fit(X_train_sample, y_train_sample)</span>
<span id="cb38-6"><a href="#cb38-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-7"><a href="#cb38-7" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Best parameters scores:"</span>)</span>
<span id="cb38-8"><a href="#cb38-8" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(grid.best_params_)</span>
<span id="cb38-9"><a href="#cb38-9" aria-hidden="true" tabindex="-1"></a>best_params[<span class="st">"rfc"</span>] <span class="op">=</span> grid.best_params_</span>
<span id="cb38-10"><a href="#cb38-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-11"><a href="#cb38-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-12"><a href="#cb38-12" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Train score:"</span>, grid.score(X_train_sample, y_train_sample))</span>
<span id="cb38-13"><a href="#cb38-13" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Validation score:"</span>, grid.score(X_val_sample, y_val_sample))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>/opt/conda/lib/python3.10/site-packages/joblib/externals/loky/process_executor.py:700: UserWarning: A worker stopped while some jobs were given to the executor. This can be caused by a too short worker timeout or by a memory leak.
  warnings.warn(</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Best parameters scores:
{'max_depth': 30, 'n_estimators': 500}
Train score: 0.9999479166666667
Validation score: 0.788125</code></pre>
</div>
</div>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-06-03T11:09:30.995358Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-06-03T11:09:30.994490Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-06-03T11:09:31.032653Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-06-03T11:09:31.031506Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2023-06-03T11:09:30.995318Z&quot;}" data-execution_count="308">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a>pd.DataFrame(grid.cv_results_).sort_values(by<span class="op">=</span><span class="st">"rank_test_score"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="308">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">mean_fit_time</th>
<th data-quarto-table-cell-role="th">std_fit_time</th>
<th data-quarto-table-cell-role="th">mean_score_time</th>
<th data-quarto-table-cell-role="th">std_score_time</th>
<th data-quarto-table-cell-role="th">param_max_depth</th>
<th data-quarto-table-cell-role="th">param_n_estimators</th>
<th data-quarto-table-cell-role="th">params</th>
<th data-quarto-table-cell-role="th">split0_test_score</th>
<th data-quarto-table-cell-role="th">split1_test_score</th>
<th data-quarto-table-cell-role="th">split2_test_score</th>
<th data-quarto-table-cell-role="th">split3_test_score</th>
<th data-quarto-table-cell-role="th">split4_test_score</th>
<th data-quarto-table-cell-role="th">mean_test_score</th>
<th data-quarto-table-cell-role="th">std_test_score</th>
<th data-quarto-table-cell-role="th">rank_test_score</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">15</td>
<td>18.515080</td>
<td>2.652032</td>
<td>0.737646</td>
<td>0.164817</td>
<td>30</td>
<td>500</td>
<td>{'max_depth': 30, 'n_estimators': 500}</td>
<td>0.790365</td>
<td>0.788021</td>
<td>0.785417</td>
<td>0.792448</td>
<td>0.790365</td>
<td>0.789323</td>
<td>0.002404</td>
<td>1</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">13</td>
<td>3.962996</td>
<td>0.360099</td>
<td>0.180050</td>
<td>0.025820</td>
<td>30</td>
<td>100</td>
<td>{'max_depth': 30, 'n_estimators': 100}</td>
<td>0.786979</td>
<td>0.786458</td>
<td>0.782292</td>
<td>0.790104</td>
<td>0.789062</td>
<td>0.786979</td>
<td>0.002696</td>
<td>2</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">14</td>
<td>7.875134</td>
<td>0.286106</td>
<td>0.332275</td>
<td>0.026725</td>
<td>30</td>
<td>200</td>
<td>{'max_depth': 30, 'n_estimators': 200}</td>
<td>0.785937</td>
<td>0.786979</td>
<td>0.783854</td>
<td>0.788021</td>
<td>0.788542</td>
<td>0.786667</td>
<td>0.001667</td>
<td>3</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">11</td>
<td>16.402865</td>
<td>0.826905</td>
<td>0.633739</td>
<td>0.024163</td>
<td>15</td>
<td>500</td>
<td>{'max_depth': 15, 'n_estimators': 500}</td>
<td>0.783594</td>
<td>0.784635</td>
<td>0.779948</td>
<td>0.784896</td>
<td>0.783594</td>
<td>0.783333</td>
<td>0.001774</td>
<td>4</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">12</td>
<td>1.989083</td>
<td>0.078801</td>
<td>0.100145</td>
<td>0.012897</td>
<td>30</td>
<td>50</td>
<td>{'max_depth': 30, 'n_estimators': 50}</td>
<td>0.779427</td>
<td>0.782552</td>
<td>0.777083</td>
<td>0.788802</td>
<td>0.785677</td>
<td>0.782708</td>
<td>0.004204</td>
<td>5</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">10</td>
<td>7.016634</td>
<td>0.366032</td>
<td>0.271259</td>
<td>0.017576</td>
<td>15</td>
<td>200</td>
<td>{'max_depth': 15, 'n_estimators': 200}</td>
<td>0.782292</td>
<td>0.783333</td>
<td>0.777865</td>
<td>0.784115</td>
<td>0.783073</td>
<td>0.782135</td>
<td>0.002213</td>
<td>6</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">9</td>
<td>3.129164</td>
<td>0.103627</td>
<td>0.140270</td>
<td>0.007632</td>
<td>15</td>
<td>100</td>
<td>{'max_depth': 15, 'n_estimators': 100}</td>
<td>0.783333</td>
<td>0.780990</td>
<td>0.777344</td>
<td>0.784115</td>
<td>0.780729</td>
<td>0.781302</td>
<td>0.002372</td>
<td>7</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">8</td>
<td>1.563844</td>
<td>0.036690</td>
<td>0.075092</td>
<td>0.009221</td>
<td>15</td>
<td>50</td>
<td>{'max_depth': 15, 'n_estimators': 50}</td>
<td>0.780729</td>
<td>0.783594</td>
<td>0.775521</td>
<td>0.782813</td>
<td>0.778385</td>
<td>0.780208</td>
<td>0.002960</td>
<td>8</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">5</td>
<td>2.597278</td>
<td>0.374912</td>
<td>0.108515</td>
<td>0.014335</td>
<td>10</td>
<td>100</td>
<td>{'max_depth': 10, 'n_estimators': 100}</td>
<td>0.763802</td>
<td>0.766667</td>
<td>0.759115</td>
<td>0.770573</td>
<td>0.762500</td>
<td>0.764531</td>
<td>0.003875</td>
<td>9</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">4</td>
<td>1.120571</td>
<td>0.027130</td>
<td>0.056506</td>
<td>0.004969</td>
<td>10</td>
<td>50</td>
<td>{'max_depth': 10, 'n_estimators': 50}</td>
<td>0.762500</td>
<td>0.765885</td>
<td>0.755990</td>
<td>0.777604</td>
<td>0.760417</td>
<td>0.764479</td>
<td>0.007304</td>
<td>10</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">7</td>
<td>11.801545</td>
<td>0.430042</td>
<td>0.521564</td>
<td>0.112087</td>
<td>10</td>
<td>500</td>
<td>{'max_depth': 10, 'n_estimators': 500}</td>
<td>0.763281</td>
<td>0.769271</td>
<td>0.758594</td>
<td>0.764062</td>
<td>0.764583</td>
<td>0.763958</td>
<td>0.003402</td>
<td>11</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">6</td>
<td>4.509795</td>
<td>0.102956</td>
<td>0.187681</td>
<td>0.009292</td>
<td>10</td>
<td>200</td>
<td>{'max_depth': 10, 'n_estimators': 200}</td>
<td>0.762500</td>
<td>0.767708</td>
<td>0.758854</td>
<td>0.764583</td>
<td>0.764583</td>
<td>0.763646</td>
<td>0.002917</td>
<td>12</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>0.677395</td>
<td>0.020604</td>
<td>0.046187</td>
<td>0.006181</td>
<td>5</td>
<td>50</td>
<td>{'max_depth': 5, 'n_estimators': 50}</td>
<td>0.734115</td>
<td>0.738542</td>
<td>0.724740</td>
<td>0.734635</td>
<td>0.737240</td>
<td>0.733854</td>
<td>0.004841</td>
<td>13</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>1.642113</td>
<td>0.265302</td>
<td>0.084260</td>
<td>0.015849</td>
<td>5</td>
<td>100</td>
<td>{'max_depth': 5, 'n_estimators': 100}</td>
<td>0.737240</td>
<td>0.738281</td>
<td>0.723177</td>
<td>0.733333</td>
<td>0.736458</td>
<td>0.733698</td>
<td>0.005513</td>
<td>14</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>2.776722</td>
<td>0.182507</td>
<td>0.145607</td>
<td>0.010656</td>
<td>5</td>
<td>200</td>
<td>{'max_depth': 5, 'n_estimators': 200}</td>
<td>0.734115</td>
<td>0.738542</td>
<td>0.727604</td>
<td>0.730469</td>
<td>0.734375</td>
<td>0.733021</td>
<td>0.003725</td>
<td>15</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>6.944975</td>
<td>0.057636</td>
<td>0.334258</td>
<td>0.010734</td>
<td>5</td>
<td>500</td>
<td>{'max_depth': 5, 'n_estimators': 500}</td>
<td>0.729167</td>
<td>0.734896</td>
<td>0.727083</td>
<td>0.729948</td>
<td>0.733854</td>
<td>0.730990</td>
<td>0.002937</td>
<td>16</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
<section id="running-the-best-params-random-forest-classifier-model" class="level4">
<h4 class="anchored" data-anchor-id="running-the-best-params-random-forest-classifier-model">Running the best params Random Forest Classifier Model</h4>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-06-03T11:09:31.034621Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-06-03T11:09:31.034247Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-06-03T11:09:51.028194Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-06-03T11:09:51.026860Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2023-06-03T11:09:31.034587Z&quot;}" data-execution_count="309">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Best Param scores for Random Forest Classifier:"</span>)</span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a>rfc <span class="op">=</span> RandomForestClassifier(<span class="op">**</span>grid.best_params_, random_state <span class="op">=</span> <span class="dv">42</span>)</span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a>rfc.fit(X_train_sample, y_train_sample)</span>
<span id="cb42-5"><a href="#cb42-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Storing the model trained with best params later used for visualizations</span></span>
<span id="cb42-6"><a href="#cb42-6" aria-hidden="true" tabindex="-1"></a>models[<span class="st">"Random Forest"</span>] <span class="op">=</span> rfc</span>
<span id="cb42-7"><a href="#cb42-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-8"><a href="#cb42-8" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Train Score: "</span>, rfc.score(X_train_sample, y_train_sample))</span>
<span id="cb42-9"><a href="#cb42-9" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Validation Score: "</span>, rfc.score(X_val_sample, y_val_sample))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Best Param scores for Random Forest Classifier:
Train Score:  0.9999479166666667
Validation Score:  0.788125</code></pre>
</div>
</div>
</section>
<section id="random-forest-classifier-conf.-matrix-on-validation-set" class="level4">
<h4 class="anchored" data-anchor-id="random-forest-classifier-conf.-matrix-on-validation-set">Random Forest Classifier Conf. Matrix on Validation Set</h4>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-06-03T11:09:51.030540Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-06-03T11:09:51.029980Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-06-03T11:09:52.230258Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-06-03T11:09:52.229354Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2023-06-03T11:09:51.030496Z&quot;}" data-execution_count="310">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a>y_pred <span class="op">=</span> rfc.predict(X_val_sample)</span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a>confmat <span class="op">=</span> confusion_matrix(y_true<span class="op">=</span>y_val_sample, y_pred<span class="op">=</span>y_pred)</span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a>index <span class="op">=</span> [<span class="st">"Actual Severity 1"</span>, <span class="st">"Actual Severity 2"</span>, <span class="st">"Actual Severity 3"</span>, <span class="st">"Actual Severity 4"</span>]</span>
<span id="cb44-5"><a href="#cb44-5" aria-hidden="true" tabindex="-1"></a>columns <span class="op">=</span> [<span class="st">"Predicted Severity 1"</span>, <span class="st">"Predicted Severity 2"</span>, <span class="st">"Predicted Severity 3"</span>, <span class="st">"Predicted Severity 4"</span>]</span>
<span id="cb44-6"><a href="#cb44-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-7"><a href="#cb44-7" aria-hidden="true" tabindex="-1"></a>conf_matrix <span class="op">=</span> pd.DataFrame(data<span class="op">=</span>confmat, columns<span class="op">=</span>columns, index<span class="op">=</span>index)</span>
<span id="cb44-8"><a href="#cb44-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-9"><a href="#cb44-9" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">8</span>, <span class="dv">5</span>))</span>
<span id="cb44-10"><a href="#cb44-10" aria-hidden="true" tabindex="-1"></a>sns.heatmap(conf_matrix, annot<span class="op">=</span><span class="va">True</span>, fmt<span class="op">=</span><span class="st">"d"</span>, cmap<span class="op">=</span><span class="st">"YlGnBu"</span>)</span>
<span id="cb44-11"><a href="#cb44-11" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"Confusion Matrix - Random Forest"</span>)</span>
<span id="cb44-12"><a href="#cb44-12" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="project-4-us-accidents-model-runs_files/figure-html/cell-32-output-1.png" class="img-fluid"></p>
</div>
</div>
</section>
<section id="metrics-scores-and-metric-visualizations-for-random-forest-classifier-with-best-params" class="level4">
<h4 class="anchored" data-anchor-id="metrics-scores-and-metric-visualizations-for-random-forest-classifier-with-best-params">Metrics Scores and Metric Visualizations for Random Forest Classifier with best params</h4>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-06-03T11:09:52.232545Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-06-03T11:09:52.232164Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-06-03T11:09:55.141786Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-06-03T11:09:55.140708Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2023-06-03T11:09:52.232510Z&quot;}" data-execution_count="311">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a>y_pred <span class="op">=</span> rfc.predict(X_val_sample)</span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a>accuracy[<span class="st">"Random Forest"</span>] <span class="op">=</span> accuracy_score(y_val_sample, y_pred)</span>
<span id="cb45-4"><a href="#cb45-4" aria-hidden="true" tabindex="-1"></a>f1[<span class="st">"Random Forest"</span>] <span class="op">=</span> f1_score(y_val_sample, y_pred, average<span class="op">=</span><span class="st">"macro"</span>)</span>
<span id="cb45-5"><a href="#cb45-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-6"><a href="#cb45-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(classification_report(y_train_sample, rfc.predict(X_train_sample)))</span>
<span id="cb45-7"><a href="#cb45-7" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(classification_report(y_val_sample, y_pred))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>              precision    recall  f1-score   support

           1       1.00      1.00      1.00      4822
           2       1.00      1.00      1.00      4734
           3       1.00      1.00      1.00      4865
           4       1.00      1.00      1.00      4779

    accuracy                           1.00     19200
   macro avg       1.00      1.00      1.00     19200
weighted avg       1.00      1.00      1.00     19200

              precision    recall  f1-score   support

           1       0.91      0.95      0.93      1193
           2       0.76      0.61      0.68      1232
           3       0.77      0.76      0.76      1206
           4       0.72      0.83      0.77      1169

    accuracy                           0.79      4800
   macro avg       0.79      0.79      0.79      4800
weighted avg       0.79      0.79      0.78      4800
</code></pre>
</div>
</div>
</section>
<section id="random-forest-classifier-precision-vs-recall-curve-on-validation-set" class="level4">
<h4 class="anchored" data-anchor-id="random-forest-classifier-precision-vs-recall-curve-on-validation-set">Random Forest Classifier Precision vs Recall Curve on Validation Set</h4>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-06-03T11:09:55.143876Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-06-03T11:09:55.143355Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-06-03T11:09:56.290342Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-06-03T11:09:56.289338Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2023-06-03T11:09:55.143842Z&quot;}" data-execution_count="312">
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a>Y <span class="op">=</span> label_binarize(y_val_sample, classes<span class="op">=</span>[<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>])</span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a>y_score <span class="op">=</span> rfc.predict_proba(X_val_sample)</span>
<span id="cb47-4"><a href="#cb47-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-5"><a href="#cb47-5" aria-hidden="true" tabindex="-1"></a>precision[<span class="st">"Random Forest"</span>], recall[<span class="st">"Random Forest"</span>], _ <span class="op">=</span> precision_recall_curve(Y.ravel(), y_score.ravel())</span>
<span id="cb47-6"><a href="#cb47-6" aria-hidden="true" tabindex="-1"></a>fpr[<span class="st">"Random Forest"</span>], tpr[<span class="st">"Random Forest"</span>], _ <span class="op">=</span> roc_curve(Y.ravel(), y_score.ravel())</span>
<span id="cb47-7"><a href="#cb47-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-8"><a href="#cb47-8" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">18</span>, <span class="dv">10</span>))</span>
<span id="cb47-9"><a href="#cb47-9" aria-hidden="true" tabindex="-1"></a>plt.step(recall[<span class="st">"Random Forest"</span>], precision[<span class="st">"Random Forest"</span>], where<span class="op">=</span><span class="st">"post"</span>)</span>
<span id="cb47-10"><a href="#cb47-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-11"><a href="#cb47-11" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">"Recall"</span>)</span>
<span id="cb47-12"><a href="#cb47-12" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">"Precision"</span>)</span>
<span id="cb47-13"><a href="#cb47-13" aria-hidden="true" tabindex="-1"></a>plt.xlim([<span class="dv">0</span>, <span class="dv">1</span>])</span>
<span id="cb47-14"><a href="#cb47-14" aria-hidden="true" tabindex="-1"></a>plt.ylim([<span class="dv">0</span>, <span class="fl">1.01</span>])</span>
<span id="cb47-15"><a href="#cb47-15" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"PR Curve - Random Forest"</span>)</span>
<span id="cb47-16"><a href="#cb47-16" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="project-4-us-accidents-model-runs_files/figure-html/cell-34-output-1.png" class="img-fluid"></p>
</div>
</div>
</section>
<section id="random-forest-classifier-roc-curve-on-validation-set" class="level4">
<h4 class="anchored" data-anchor-id="random-forest-classifier-roc-curve-on-validation-set">Random Forest Classifier ROC Curve on Validation Set</h4>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-06-03T11:09:56.292241Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-06-03T11:09:56.291867Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-06-03T11:09:56.716190Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-06-03T11:09:56.713829Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2023-06-03T11:09:56.292210Z&quot;}" data-execution_count="313">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">18</span>, <span class="dv">10</span>))</span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a>plt.step(fpr[<span class="st">"Random Forest"</span>], tpr[<span class="st">"Random Forest"</span>], where<span class="op">=</span><span class="st">"post"</span>)</span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-4"><a href="#cb48-4" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"ROC curve - Random Forest"</span>)</span>
<span id="cb48-5"><a href="#cb48-5" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">"False Positive Rate"</span>)</span>
<span id="cb48-6"><a href="#cb48-6" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">"True Positive Rate"</span>)</span>
<span id="cb48-7"><a href="#cb48-7" aria-hidden="true" tabindex="-1"></a>plt.xlim([<span class="dv">0</span>, <span class="dv">1</span>])</span>
<span id="cb48-8"><a href="#cb48-8" aria-hidden="true" tabindex="-1"></a>plt.ylim([<span class="dv">0</span>, <span class="fl">1.01</span>])</span>
<span id="cb48-9"><a href="#cb48-9" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="project-4-us-accidents-model-runs_files/figure-html/cell-35-output-1.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-06-03T11:09:56.718206Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-06-03T11:09:56.717627Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-06-03T11:09:57.434660Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-06-03T11:09:57.433717Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2023-06-03T11:09:56.718171Z&quot;}" data-execution_count="314">
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a>importances <span class="op">=</span> pd.DataFrame(np.zeros((X_train_sample.shape[<span class="dv">1</span>], <span class="dv">1</span>)), columns<span class="op">=</span>[<span class="st">"importance"</span>], index<span class="op">=</span>X_train_sample.columns)</span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a>importances.iloc[:,<span class="dv">0</span>] <span class="op">=</span> rfc.feature_importances_</span>
<span id="cb49-4"><a href="#cb49-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-5"><a href="#cb49-5" aria-hidden="true" tabindex="-1"></a>importances <span class="op">=</span> importances.sort_values(by<span class="op">=</span><span class="st">"importance"</span>, ascending<span class="op">=</span><span class="va">False</span>)[:<span class="dv">30</span>]</span>
<span id="cb49-6"><a href="#cb49-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-7"><a href="#cb49-7" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">15</span>, <span class="dv">10</span>))</span>
<span id="cb49-8"><a href="#cb49-8" aria-hidden="true" tabindex="-1"></a>sns.barplot(x<span class="op">=</span><span class="st">"importance"</span>, y<span class="op">=</span>importances.index, data<span class="op">=</span>importances)</span>
<span id="cb49-9"><a href="#cb49-9" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="project-4-us-accidents-model-runs_files/figure-html/cell-36-output-1.png" class="img-fluid"></p>
</div>
</div>
</section>
</section>
<section id="naive-bayes" class="level3">
<h3 class="anchored" data-anchor-id="naive-bayes">Naive Bayes</h3>
<section id="running-algo-without-grid-search-cv" class="level4">
<h4 class="anchored" data-anchor-id="running-algo-without-grid-search-cv">Running algo without Grid-Search CV</h4>
<ul>
<li>There are not major hyper params to be tweaked for this algo.</li>
</ul>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-06-03T11:09:57.436507Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-06-03T11:09:57.436047Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-06-03T11:09:57.488266Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-06-03T11:09:57.487292Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2023-06-03T11:09:57.436471Z&quot;}" data-execution_count="315">
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a>gnb <span class="op">=</span> GaussianNB()</span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a>gnb.fit(X_train_sample, y_train_sample)</span>
<span id="cb50-4"><a href="#cb50-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-5"><a href="#cb50-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Storing the model trained with best params later used for visualizations</span></span>
<span id="cb50-6"><a href="#cb50-6" aria-hidden="true" tabindex="-1"></a>models[<span class="st">"Gaussian Naive Bayes"</span>] <span class="op">=</span> gnb</span>
<span id="cb50-7"><a href="#cb50-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-8"><a href="#cb50-8" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Train score:"</span>, gnb.score(X_train_sample, y_train_sample))</span>
<span id="cb50-9"><a href="#cb50-9" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Validation score:"</span>, gnb.score(X_val_sample, y_val_sample))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Train score: 0.4340104166666667
Validation score: 0.42645833333333333</code></pre>
</div>
</div>
</section>
<section id="gaussian-naive-bayes-conf.-matrix-on-validation-set" class="level4">
<h4 class="anchored" data-anchor-id="gaussian-naive-bayes-conf.-matrix-on-validation-set">Gaussian Naive Bayes Conf. Matrix on Validation set</h4>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-06-03T11:09:57.490390Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-06-03T11:09:57.489820Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-06-03T11:09:57.987296Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-06-03T11:09:57.986336Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2023-06-03T11:09:57.490349Z&quot;}" data-execution_count="316">
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a>y_pred <span class="op">=</span> gnb.predict(X_val_sample)</span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a>confmat <span class="op">=</span> confusion_matrix(y_true<span class="op">=</span>y_val_sample, y_pred<span class="op">=</span>y_pred)</span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-4"><a href="#cb52-4" aria-hidden="true" tabindex="-1"></a>index <span class="op">=</span> [<span class="st">"Actual Severity 1"</span>, <span class="st">"Actual Severity 2"</span>, <span class="st">"Actual Severity 3"</span>, <span class="st">"Actual Severity 4"</span>]</span>
<span id="cb52-5"><a href="#cb52-5" aria-hidden="true" tabindex="-1"></a>columns <span class="op">=</span> [<span class="st">"Predicted Severity 1"</span>, <span class="st">"Predicted Severity 2"</span>, <span class="st">"Predicted Severity 3"</span>, <span class="st">"Predicted Severity 4"</span>]</span>
<span id="cb52-6"><a href="#cb52-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-7"><a href="#cb52-7" aria-hidden="true" tabindex="-1"></a>conf_matrix <span class="op">=</span> pd.DataFrame(data<span class="op">=</span>confmat, columns<span class="op">=</span>columns, index<span class="op">=</span>index)</span>
<span id="cb52-8"><a href="#cb52-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-9"><a href="#cb52-9" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">8</span>, <span class="dv">5</span>))</span>
<span id="cb52-10"><a href="#cb52-10" aria-hidden="true" tabindex="-1"></a>sns.heatmap(conf_matrix, annot<span class="op">=</span><span class="va">True</span>, fmt<span class="op">=</span><span class="st">"d"</span>, cmap<span class="op">=</span><span class="st">"YlGnBu"</span>)</span>
<span id="cb52-11"><a href="#cb52-11" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"Confusion Matrix - Gaussian Naive Bayes"</span>)</span>
<span id="cb52-12"><a href="#cb52-12" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="project-4-us-accidents-model-runs_files/figure-html/cell-38-output-1.png" class="img-fluid"></p>
</div>
</div>
</section>
<section id="metrics-scores-and-metric-visualizations-for-gaussian-naive-bayes-with-best-params" class="level4">
<h4 class="anchored" data-anchor-id="metrics-scores-and-metric-visualizations-for-gaussian-naive-bayes-with-best-params">Metrics Scores and Metric Visualizations for Gaussian Naive Bayes with best params</h4>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-06-03T11:09:57.996523Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-06-03T11:09:57.996206Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-06-03T11:09:58.075688Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-06-03T11:09:58.074631Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2023-06-03T11:09:57.996496Z&quot;}" data-execution_count="317">
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a>y_pred <span class="op">=</span> gnb.predict(X_val_sample)</span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true" tabindex="-1"></a>accuracy[<span class="st">"Gaussian Naive Bayes"</span>] <span class="op">=</span> accuracy_score(y_val_sample, y_pred)</span>
<span id="cb53-4"><a href="#cb53-4" aria-hidden="true" tabindex="-1"></a>f1[<span class="st">"Gaussian Naive Bayes"</span>] <span class="op">=</span> f1_score(y_val_sample, y_pred, average<span class="op">=</span><span class="st">"macro"</span>)</span>
<span id="cb53-5"><a href="#cb53-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-6"><a href="#cb53-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(classification_report(y_train_sample, gnb.predict(X_train_sample)))</span>
<span id="cb53-7"><a href="#cb53-7" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(classification_report(y_val_sample, y_pred))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>              precision    recall  f1-score   support

           1       0.45      0.94      0.61      4822
           2       0.61      0.06      0.11      4734
           3       0.63      0.06      0.10      4865
           4       0.40      0.67      0.50      4779

    accuracy                           0.43     19200
   macro avg       0.52      0.43      0.33     19200
weighted avg       0.52      0.43      0.33     19200

              precision    recall  f1-score   support

           1       0.44      0.94      0.60      1193
           2       0.59      0.06      0.11      1232
           3       0.66      0.06      0.11      1206
           4       0.39      0.66      0.49      1169

    accuracy                           0.43      4800
   macro avg       0.52      0.43      0.33      4800
weighted avg       0.52      0.43      0.32      4800
</code></pre>
</div>
</div>
</section>
<section id="gaussian-naive-bayes-precision-vs-recall-curve-on-validation-set" class="level4">
<h4 class="anchored" data-anchor-id="gaussian-naive-bayes-precision-vs-recall-curve-on-validation-set">Gaussian Naive Bayes Precision vs Recall Curve on Validation set</h4>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-06-03T11:09:58.078165Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-06-03T11:09:58.077499Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-06-03T11:09:58.500240Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-06-03T11:09:58.499339Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2023-06-03T11:09:58.078124Z&quot;}" data-execution_count="318">
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a>Y <span class="op">=</span> label_binarize(y_val_sample, classes<span class="op">=</span>[<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>])</span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-3"><a href="#cb55-3" aria-hidden="true" tabindex="-1"></a>y_score <span class="op">=</span> gnb.predict_proba(X_val_sample)</span>
<span id="cb55-4"><a href="#cb55-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-5"><a href="#cb55-5" aria-hidden="true" tabindex="-1"></a>precision[<span class="st">"Gaussian Naive Bayes"</span>], recall[<span class="st">"Gaussian Naive Bayes"</span>], _ <span class="op">=</span> precision_recall_curve(Y.ravel(), y_score.ravel())</span>
<span id="cb55-6"><a href="#cb55-6" aria-hidden="true" tabindex="-1"></a>fpr[<span class="st">"Gaussian Naive Bayes"</span>], tpr[<span class="st">"Gaussian Naive Bayes"</span>], _ <span class="op">=</span> roc_curve(Y.ravel(), y_score.ravel())</span>
<span id="cb55-7"><a href="#cb55-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-8"><a href="#cb55-8" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">18</span>, <span class="dv">10</span>))</span>
<span id="cb55-9"><a href="#cb55-9" aria-hidden="true" tabindex="-1"></a>plt.step(recall[<span class="st">"Gaussian Naive Bayes"</span>], precision[<span class="st">"Gaussian Naive Bayes"</span>], where<span class="op">=</span><span class="st">"post"</span>)</span>
<span id="cb55-10"><a href="#cb55-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-11"><a href="#cb55-11" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">"Recall"</span>)</span>
<span id="cb55-12"><a href="#cb55-12" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">"Precision"</span>)</span>
<span id="cb55-13"><a href="#cb55-13" aria-hidden="true" tabindex="-1"></a>plt.xlim([<span class="dv">0</span>, <span class="dv">1</span>])</span>
<span id="cb55-14"><a href="#cb55-14" aria-hidden="true" tabindex="-1"></a>plt.ylim([<span class="dv">0</span>, <span class="fl">1.01</span>])</span>
<span id="cb55-15"><a href="#cb55-15" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"PR Curve - Gaussian Naive Bayes"</span>)</span>
<span id="cb55-16"><a href="#cb55-16" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="project-4-us-accidents-model-runs_files/figure-html/cell-40-output-1.png" class="img-fluid"></p>
</div>
</div>
</section>
<section id="gaussian-naive-bayes-roc-curve-on-validation-set" class="level4">
<h4 class="anchored" data-anchor-id="gaussian-naive-bayes-roc-curve-on-validation-set">Gaussian Naive Bayes ROC Curve on Validation set</h4>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-06-03T11:09:58.502728Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-06-03T11:09:58.501713Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-06-03T11:09:58.925278Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-06-03T11:09:58.924335Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2023-06-03T11:09:58.502690Z&quot;}" data-execution_count="319">
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">18</span>, <span class="dv">10</span>))</span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a>plt.step(fpr[<span class="st">"Gaussian Naive Bayes"</span>], tpr[<span class="st">"Gaussian Naive Bayes"</span>], where<span class="op">=</span><span class="st">"post"</span>)</span>
<span id="cb56-3"><a href="#cb56-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-4"><a href="#cb56-4" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"ROC curve - Gaussian Naive Bayes"</span>)</span>
<span id="cb56-5"><a href="#cb56-5" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">"False Positive Rate"</span>)</span>
<span id="cb56-6"><a href="#cb56-6" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">"True Positive Rate"</span>)</span>
<span id="cb56-7"><a href="#cb56-7" aria-hidden="true" tabindex="-1"></a>plt.xlim([<span class="dv">0</span>, <span class="dv">1</span>])</span>
<span id="cb56-8"><a href="#cb56-8" aria-hidden="true" tabindex="-1"></a>plt.ylim([<span class="dv">0</span>, <span class="fl">1.01</span>])</span>
<span id="cb56-9"><a href="#cb56-9" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="project-4-us-accidents-model-runs_files/figure-html/cell-41-output-1.png" class="img-fluid"></p>
</div>
</div>
</section>
</section>
<section id="multinomial-naive-bayes" class="level3">
<h3 class="anchored" data-anchor-id="multinomial-naive-bayes">Multinomial Naive Bayes</h3>
<section id="running-algo-without-grid-search-cv-1" class="level4">
<h4 class="anchored" data-anchor-id="running-algo-without-grid-search-cv-1">Running algo without Grid-Search CV</h4>
<ul>
<li>There are not major hyper params to be tweaked for this algo.</li>
</ul>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-06-03T11:09:58.927379Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-06-03T11:09:58.926582Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-06-03T11:09:58.972349Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-06-03T11:09:58.971323Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2023-06-03T11:09:58.927340Z&quot;}" data-execution_count="320">
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a>mnb <span class="op">=</span> MultinomialNB()</span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a>mnb.fit(X_train_sample, y_train_sample)</span>
<span id="cb57-3"><a href="#cb57-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-4"><a href="#cb57-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Storing the model trained with best params later used for visualizations</span></span>
<span id="cb57-5"><a href="#cb57-5" aria-hidden="true" tabindex="-1"></a>models[<span class="st">"Multinomial Naive Bayes"</span>] <span class="op">=</span> mnb</span>
<span id="cb57-6"><a href="#cb57-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-7"><a href="#cb57-7" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Train score:"</span>, mnb.score(X_train_sample, y_train_sample))</span>
<span id="cb57-8"><a href="#cb57-8" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Validation score:"</span>, mnb.score(X_val_sample, y_val_sample))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Train score: 0.6055208333333333
Validation score: 0.6039583333333334</code></pre>
</div>
</div>
</section>
<section id="multinomial-naive-bayes-conf.-matrix-on-validation-set" class="level4">
<h4 class="anchored" data-anchor-id="multinomial-naive-bayes-conf.-matrix-on-validation-set">Multinomial Naive Bayes Conf. Matrix on Validation set</h4>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-06-03T11:09:58.974221Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-06-03T11:09:58.973684Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-06-03T11:09:59.432285Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-06-03T11:09:59.431371Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2023-06-03T11:09:58.974189Z&quot;}" data-execution_count="321">
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a>y_pred <span class="op">=</span> mnb.predict(X_val_sample)</span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a>confmat <span class="op">=</span> confusion_matrix(y_true<span class="op">=</span>y_val_sample, y_pred<span class="op">=</span>y_pred)</span>
<span id="cb59-3"><a href="#cb59-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-4"><a href="#cb59-4" aria-hidden="true" tabindex="-1"></a>index <span class="op">=</span> [<span class="st">"Actual Severity 1"</span>, <span class="st">"Actual Severity 2"</span>, <span class="st">"Actual Severity 3"</span>, <span class="st">"Actual Severity 4"</span>]</span>
<span id="cb59-5"><a href="#cb59-5" aria-hidden="true" tabindex="-1"></a>columns <span class="op">=</span> [<span class="st">"Predicted Severity 1"</span>, <span class="st">"Predicted Severity 2"</span>, <span class="st">"Predicted Severity 3"</span>, <span class="st">"Predicted Severity 4"</span>]</span>
<span id="cb59-6"><a href="#cb59-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-7"><a href="#cb59-7" aria-hidden="true" tabindex="-1"></a>conf_matrix <span class="op">=</span> pd.DataFrame(data<span class="op">=</span>confmat, columns<span class="op">=</span>columns, index<span class="op">=</span>index)</span>
<span id="cb59-8"><a href="#cb59-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-9"><a href="#cb59-9" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">8</span>, <span class="dv">5</span>))</span>
<span id="cb59-10"><a href="#cb59-10" aria-hidden="true" tabindex="-1"></a>sns.heatmap(conf_matrix, annot<span class="op">=</span><span class="va">True</span>, fmt<span class="op">=</span><span class="st">"d"</span>, cmap<span class="op">=</span><span class="st">"YlGnBu"</span>)</span>
<span id="cb59-11"><a href="#cb59-11" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"Confusion Matrix - Multinomial Naive Bayes"</span>)</span>
<span id="cb59-12"><a href="#cb59-12" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="project-4-us-accidents-model-runs_files/figure-html/cell-43-output-1.png" class="img-fluid"></p>
</div>
</div>
</section>
<section id="metrics-scores-and-metric-visualizations-for-multinomial-naive-bayes-with-best-params" class="level4">
<h4 class="anchored" data-anchor-id="metrics-scores-and-metric-visualizations-for-multinomial-naive-bayes-with-best-params">Metrics Scores and Metric Visualizations for Multinomial Naive Bayes with best params</h4>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-06-03T11:09:59.434081Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-06-03T11:09:59.433619Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-06-03T11:09:59.545882Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-06-03T11:09:59.542480Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2023-06-03T11:09:59.434044Z&quot;}" data-execution_count="322">
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a>y_pred <span class="op">=</span> mnb.predict(X_val_sample)</span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-3"><a href="#cb60-3" aria-hidden="true" tabindex="-1"></a>accuracy[<span class="st">"Multinomial Naive Bayes"</span>] <span class="op">=</span> accuracy_score(y_val_sample, y_pred)</span>
<span id="cb60-4"><a href="#cb60-4" aria-hidden="true" tabindex="-1"></a>f1[<span class="st">"Multinomial Naive Bayes"</span>] <span class="op">=</span> f1_score(y_val_sample, y_pred, average<span class="op">=</span><span class="st">"macro"</span>)</span>
<span id="cb60-5"><a href="#cb60-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-6"><a href="#cb60-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(classification_report(y_train_sample, mnb.predict(X_train_sample)))</span>
<span id="cb60-7"><a href="#cb60-7" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(classification_report(y_val_sample, y_pred))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>              precision    recall  f1-score   support

           1       0.62      0.80      0.70      4822
           2       0.55      0.18      0.28      4734
           3       0.69      0.68      0.68      4865
           4       0.55      0.75      0.63      4779

    accuracy                           0.61     19200
   macro avg       0.60      0.60      0.57     19200
weighted avg       0.60      0.61      0.57     19200

              precision    recall  f1-score   support

           1       0.64      0.78      0.70      1193
           2       0.55      0.19      0.28      1232
           3       0.69      0.69      0.69      1206
           4       0.53      0.77      0.63      1169

    accuracy                           0.60      4800
   macro avg       0.60      0.61      0.57      4800
weighted avg       0.60      0.60      0.57      4800
</code></pre>
</div>
</div>
</section>
<section id="multinomial-naive-bayes-precision-vs-recall-curve-on-validation-set" class="level4">
<h4 class="anchored" data-anchor-id="multinomial-naive-bayes-precision-vs-recall-curve-on-validation-set">Multinomial Naive Bayes Precision vs Recall Curve on Validation set</h4>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-06-03T11:09:59.548123Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-06-03T11:09:59.547561Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-06-03T11:10:00.005216Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-06-03T11:10:00.004324Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2023-06-03T11:09:59.548076Z&quot;}" data-execution_count="323">
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a>Y <span class="op">=</span> label_binarize(y_val_sample, classes<span class="op">=</span>[<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>])</span>
<span id="cb62-2"><a href="#cb62-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-3"><a href="#cb62-3" aria-hidden="true" tabindex="-1"></a>y_score <span class="op">=</span> mnb.predict_proba(X_val_sample)</span>
<span id="cb62-4"><a href="#cb62-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-5"><a href="#cb62-5" aria-hidden="true" tabindex="-1"></a>precision[<span class="st">"Multinomial Naive Bayes"</span>], recall[<span class="st">"Multinomial Naive Bayes"</span>], _ <span class="op">=</span> precision_recall_curve(Y.ravel(), y_score.ravel())</span>
<span id="cb62-6"><a href="#cb62-6" aria-hidden="true" tabindex="-1"></a>fpr[<span class="st">"Multinomial Naive Bayes"</span>], tpr[<span class="st">"Multinomial Naive Bayes"</span>], _ <span class="op">=</span> roc_curve(Y.ravel(), y_score.ravel())</span>
<span id="cb62-7"><a href="#cb62-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-8"><a href="#cb62-8" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">18</span>, <span class="dv">10</span>))</span>
<span id="cb62-9"><a href="#cb62-9" aria-hidden="true" tabindex="-1"></a>plt.step(recall[<span class="st">"Multinomial Naive Bayes"</span>], precision[<span class="st">"Multinomial Naive Bayes"</span>], where<span class="op">=</span><span class="st">"post"</span>)</span>
<span id="cb62-10"><a href="#cb62-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-11"><a href="#cb62-11" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">"Recall"</span>)</span>
<span id="cb62-12"><a href="#cb62-12" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">"Precision"</span>)</span>
<span id="cb62-13"><a href="#cb62-13" aria-hidden="true" tabindex="-1"></a>plt.xlim([<span class="dv">0</span>, <span class="dv">1</span>])</span>
<span id="cb62-14"><a href="#cb62-14" aria-hidden="true" tabindex="-1"></a>plt.ylim([<span class="dv">0</span>, <span class="fl">1.01</span>])</span>
<span id="cb62-15"><a href="#cb62-15" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"PR Curve - Multinomial Naive Bayes"</span>)</span>
<span id="cb62-16"><a href="#cb62-16" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="project-4-us-accidents-model-runs_files/figure-html/cell-45-output-1.png" class="img-fluid"></p>
</div>
</div>
</section>
<section id="multinomial-naive-bayes-roc-curve-on-validation-set" class="level4">
<h4 class="anchored" data-anchor-id="multinomial-naive-bayes-roc-curve-on-validation-set">Multinomial Naive Bayes ROC Curve on Validation set</h4>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-06-03T11:10:00.007674Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-06-03T11:10:00.006703Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-06-03T11:10:00.432261Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-06-03T11:10:00.431328Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2023-06-03T11:10:00.007639Z&quot;}" data-execution_count="324">
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">18</span>, <span class="dv">10</span>))</span>
<span id="cb63-2"><a href="#cb63-2" aria-hidden="true" tabindex="-1"></a>plt.step(fpr[<span class="st">"Multinomial Naive Bayes"</span>], tpr[<span class="st">"Multinomial Naive Bayes"</span>], where<span class="op">=</span><span class="st">"post"</span>)</span>
<span id="cb63-3"><a href="#cb63-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-4"><a href="#cb63-4" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"ROC curve - Multinomial Naive Bayes"</span>)</span>
<span id="cb63-5"><a href="#cb63-5" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">"False Positive Rate"</span>)</span>
<span id="cb63-6"><a href="#cb63-6" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">"True Positive Rate"</span>)</span>
<span id="cb63-7"><a href="#cb63-7" aria-hidden="true" tabindex="-1"></a>plt.xlim([<span class="dv">0</span>, <span class="dv">1</span>])</span>
<span id="cb63-8"><a href="#cb63-8" aria-hidden="true" tabindex="-1"></a>plt.ylim([<span class="dv">0</span>, <span class="fl">1.01</span>])</span>
<span id="cb63-9"><a href="#cb63-9" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="project-4-us-accidents-model-runs_files/figure-html/cell-46-output-1.png" class="img-fluid"></p>
</div>
</div>
</section>
</section>
<section id="bernoulli-naive-bayes" class="level3">
<h3 class="anchored" data-anchor-id="bernoulli-naive-bayes">Bernoulli Naive Bayes</h3>
<section id="running-algo-without-grid-search-cv-2" class="level4">
<h4 class="anchored" data-anchor-id="running-algo-without-grid-search-cv-2">Running algo without Grid-Search CV</h4>
<ul>
<li>There are not major hyper params to be tweaked for this algo.</li>
</ul>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-06-03T11:10:00.434412Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-06-03T11:10:00.433723Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-06-03T11:10:00.507117Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-06-03T11:10:00.506129Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2023-06-03T11:10:00.434376Z&quot;}" data-execution_count="325">
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a>bnb <span class="op">=</span> BernoulliNB()</span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a>bnb.fit(X_train_sample, y_train_sample)</span>
<span id="cb64-3"><a href="#cb64-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-4"><a href="#cb64-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Storing the model trained with best params later used for visualizations</span></span>
<span id="cb64-5"><a href="#cb64-5" aria-hidden="true" tabindex="-1"></a>models[<span class="st">"Bernoulli Naive Bayes"</span>] <span class="op">=</span> bnb</span>
<span id="cb64-6"><a href="#cb64-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-7"><a href="#cb64-7" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Train score:"</span>, bnb.score(X_train_sample, y_train_sample))</span>
<span id="cb64-8"><a href="#cb64-8" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Validation score:"</span>, bnb.score(X_val_sample, y_val_sample))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Train score: 0.611875
Validation score: 0.6035416666666666</code></pre>
</div>
</div>
</section>
<section id="bernoulli-naive-bayes-conf.-matrix-on-validation-set" class="level4">
<h4 class="anchored" data-anchor-id="bernoulli-naive-bayes-conf.-matrix-on-validation-set">Bernoulli Naive Bayes Conf. Matrix on Validation set</h4>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-06-03T11:10:00.509228Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-06-03T11:10:00.508674Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-06-03T11:10:01.118696Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-06-03T11:10:01.117759Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2023-06-03T11:10:00.509193Z&quot;}" data-execution_count="326">
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a>y_pred <span class="op">=</span> bnb.predict(X_val_sample)</span>
<span id="cb66-2"><a href="#cb66-2" aria-hidden="true" tabindex="-1"></a>confmat <span class="op">=</span> confusion_matrix(y_true<span class="op">=</span>y_val_sample, y_pred<span class="op">=</span>y_pred)</span>
<span id="cb66-3"><a href="#cb66-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-4"><a href="#cb66-4" aria-hidden="true" tabindex="-1"></a>index <span class="op">=</span> [<span class="st">"Actual Severity 1"</span>, <span class="st">"Actual Severity 2"</span>, <span class="st">"Actual Severity 3"</span>, <span class="st">"Actual Severity 4"</span>]</span>
<span id="cb66-5"><a href="#cb66-5" aria-hidden="true" tabindex="-1"></a>columns <span class="op">=</span> [<span class="st">"Predicted Severity 1"</span>, <span class="st">"Predicted Severity 2"</span>, <span class="st">"Predicted Severity 3"</span>, <span class="st">"Predicted Severity 4"</span>]</span>
<span id="cb66-6"><a href="#cb66-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-7"><a href="#cb66-7" aria-hidden="true" tabindex="-1"></a>conf_matrix <span class="op">=</span> pd.DataFrame(data<span class="op">=</span>confmat, columns<span class="op">=</span>columns, index<span class="op">=</span>index)</span>
<span id="cb66-8"><a href="#cb66-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-9"><a href="#cb66-9" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">8</span>, <span class="dv">5</span>))</span>
<span id="cb66-10"><a href="#cb66-10" aria-hidden="true" tabindex="-1"></a>sns.heatmap(conf_matrix, annot<span class="op">=</span><span class="va">True</span>, fmt<span class="op">=</span><span class="st">"d"</span>, cmap<span class="op">=</span><span class="st">"YlGnBu"</span>)</span>
<span id="cb66-11"><a href="#cb66-11" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"Confusion Matrix - Bernoulli Naive Bayes"</span>)</span>
<span id="cb66-12"><a href="#cb66-12" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="project-4-us-accidents-model-runs_files/figure-html/cell-48-output-1.png" class="img-fluid"></p>
</div>
</div>
</section>
<section id="metrics-scores-and-metric-visualizations-for-bernoulli-naive-bayes-with-best-params" class="level4">
<h4 class="anchored" data-anchor-id="metrics-scores-and-metric-visualizations-for-bernoulli-naive-bayes-with-best-params">Metrics Scores and Metric Visualizations for Bernoulli Naive Bayes with best params</h4>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-06-03T11:10:01.125275Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-06-03T11:10:01.123058Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-06-03T11:10:01.339049Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-06-03T11:10:01.338105Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2023-06-03T11:10:01.125239Z&quot;}" data-execution_count="327">
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a>y_pred <span class="op">=</span> bnb.predict(X_val_sample)</span>
<span id="cb67-2"><a href="#cb67-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-3"><a href="#cb67-3" aria-hidden="true" tabindex="-1"></a>accuracy[<span class="st">"Bernoulli Naive Bayes"</span>] <span class="op">=</span> accuracy_score(y_val_sample, y_pred)</span>
<span id="cb67-4"><a href="#cb67-4" aria-hidden="true" tabindex="-1"></a>f1[<span class="st">"Bernoulli Naive Bayes"</span>] <span class="op">=</span> f1_score(y_val_sample, y_pred, average<span class="op">=</span><span class="st">"macro"</span>)</span>
<span id="cb67-5"><a href="#cb67-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-6"><a href="#cb67-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(classification_report(y_train_sample, bnb.predict(X_train_sample)))</span>
<span id="cb67-7"><a href="#cb67-7" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(classification_report(y_val_sample, y_pred))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>              precision    recall  f1-score   support

           1       0.71      0.77      0.74      4822
           2       0.40      0.12      0.19      4734
           3       0.63      0.70      0.66      4865
           4       0.57      0.85      0.68      4779

    accuracy                           0.61     19200
   macro avg       0.58      0.61      0.57     19200
weighted avg       0.58      0.61      0.57     19200

              precision    recall  f1-score   support

           1       0.71      0.77      0.74      1193
           2       0.39      0.12      0.18      1232
           3       0.64      0.69      0.66      1206
           4       0.55      0.85      0.67      1169

    accuracy                           0.60      4800
   macro avg       0.57      0.61      0.56      4800
weighted avg       0.57      0.60      0.56      4800
</code></pre>
</div>
</div>
</section>
<section id="bernoulli-naive-bayes-precision-vs-recall-curve-on-validation-set" class="level4">
<h4 class="anchored" data-anchor-id="bernoulli-naive-bayes-precision-vs-recall-curve-on-validation-set">Bernoulli Naive Bayes Precision vs Recall Curve on Validation set</h4>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-06-03T11:10:01.345514Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-06-03T11:10:01.343301Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-06-03T11:10:01.899718Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-06-03T11:10:01.898833Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2023-06-03T11:10:01.345477Z&quot;}" data-execution_count="328">
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a>Y <span class="op">=</span> label_binarize(y_val_sample, classes<span class="op">=</span>[<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>])</span>
<span id="cb69-2"><a href="#cb69-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-3"><a href="#cb69-3" aria-hidden="true" tabindex="-1"></a>y_score <span class="op">=</span> bnb.predict_proba(X_val_sample)</span>
<span id="cb69-4"><a href="#cb69-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-5"><a href="#cb69-5" aria-hidden="true" tabindex="-1"></a>precision[<span class="st">"Bernoulli Naive Bayes"</span>], recall[<span class="st">"Bernoulli Naive Bayes"</span>], _ <span class="op">=</span> precision_recall_curve(Y.ravel(), y_score.ravel())</span>
<span id="cb69-6"><a href="#cb69-6" aria-hidden="true" tabindex="-1"></a>fpr[<span class="st">"Bernoulli Naive Bayes"</span>], tpr[<span class="st">"Bernoulli Naive Bayes"</span>], _ <span class="op">=</span> roc_curve(Y.ravel(), y_score.ravel())</span>
<span id="cb69-7"><a href="#cb69-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-8"><a href="#cb69-8" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">18</span>, <span class="dv">10</span>))</span>
<span id="cb69-9"><a href="#cb69-9" aria-hidden="true" tabindex="-1"></a>plt.step(recall[<span class="st">"Bernoulli Naive Bayes"</span>], precision[<span class="st">"Bernoulli Naive Bayes"</span>], where<span class="op">=</span><span class="st">"post"</span>)</span>
<span id="cb69-10"><a href="#cb69-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-11"><a href="#cb69-11" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">"Recall"</span>)</span>
<span id="cb69-12"><a href="#cb69-12" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">"Precision"</span>)</span>
<span id="cb69-13"><a href="#cb69-13" aria-hidden="true" tabindex="-1"></a>plt.xlim([<span class="dv">0</span>, <span class="dv">1</span>])</span>
<span id="cb69-14"><a href="#cb69-14" aria-hidden="true" tabindex="-1"></a>plt.ylim([<span class="dv">0</span>, <span class="fl">1.01</span>])</span>
<span id="cb69-15"><a href="#cb69-15" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"PR Curve - Bernoulli Naive Bayes"</span>)</span>
<span id="cb69-16"><a href="#cb69-16" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="project-4-us-accidents-model-runs_files/figure-html/cell-50-output-1.png" class="img-fluid"></p>
</div>
</div>
</section>
<section id="bernoulli-naive-bayes-roc-curve-on-validation-set" class="level4">
<h4 class="anchored" data-anchor-id="bernoulli-naive-bayes-roc-curve-on-validation-set">Bernoulli Naive Bayes ROC Curve on Validation set</h4>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-06-03T11:10:01.906480Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-06-03T11:10:01.904135Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-06-03T11:10:02.372264Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-06-03T11:10:02.371366Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2023-06-03T11:10:01.906424Z&quot;}" data-execution_count="329">
<div class="sourceCode cell-code" id="cb70"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">18</span>, <span class="dv">10</span>))</span>
<span id="cb70-2"><a href="#cb70-2" aria-hidden="true" tabindex="-1"></a>plt.step(fpr[<span class="st">"Bernoulli Naive Bayes"</span>], tpr[<span class="st">"Bernoulli Naive Bayes"</span>], where<span class="op">=</span><span class="st">"post"</span>)</span>
<span id="cb70-3"><a href="#cb70-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-4"><a href="#cb70-4" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"ROC curve - Bernoulli Naive Bayes"</span>)</span>
<span id="cb70-5"><a href="#cb70-5" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">"False Positive Rate"</span>)</span>
<span id="cb70-6"><a href="#cb70-6" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">"True Positive Rate"</span>)</span>
<span id="cb70-7"><a href="#cb70-7" aria-hidden="true" tabindex="-1"></a>plt.xlim([<span class="dv">0</span>, <span class="dv">1</span>])</span>
<span id="cb70-8"><a href="#cb70-8" aria-hidden="true" tabindex="-1"></a>plt.ylim([<span class="dv">0</span>, <span class="fl">1.01</span>])</span>
<span id="cb70-9"><a href="#cb70-9" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="project-4-us-accidents-model-runs_files/figure-html/cell-51-output-1.png" class="img-fluid"></p>
</div>
</div>
</section>
</section>
<section id="xgboost-classifier" class="level3">
<h3 class="anchored" data-anchor-id="xgboost-classifier">XGBoost Classifier</h3>
<ul>
<li>This algo requires the target labels to start from 0 so we transform the target | Original Label | Encoded Label | | ————– | ————- | | 1 | 0 | | 2 | 1 | | 3 | 2 | | 4 | 3 |</li>
</ul>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-06-03T11:10:02.374331Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-06-03T11:10:02.373962Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-06-03T11:12:13.212516Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-06-03T11:12:13.211589Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2023-06-03T11:10:02.374297Z&quot;}" data-execution_count="330">
<div class="sourceCode cell-code" id="cb71"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.preprocessing <span class="im">import</span> LabelEncoder</span>
<span id="cb71-2"><a href="#cb71-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-3"><a href="#cb71-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Create an instance of LabelEncoder</span></span>
<span id="cb71-4"><a href="#cb71-4" aria-hidden="true" tabindex="-1"></a>label_encoder <span class="op">=</span> LabelEncoder()</span>
<span id="cb71-5"><a href="#cb71-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-6"><a href="#cb71-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit and transform the target variable</span></span>
<span id="cb71-7"><a href="#cb71-7" aria-hidden="true" tabindex="-1"></a>y_train_encoded <span class="op">=</span> label_encoder.fit_transform(y_train_sample)</span>
<span id="cb71-8"><a href="#cb71-8" aria-hidden="true" tabindex="-1"></a>y_val_encoded <span class="op">=</span> label_encoder.transform(y_val_sample)</span>
<span id="cb71-9"><a href="#cb71-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-10"><a href="#cb71-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-11"><a href="#cb71-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-12"><a href="#cb71-12" aria-hidden="true" tabindex="-1"></a>parameters <span class="op">=</span> [</span>
<span id="cb71-13"><a href="#cb71-13" aria-hidden="true" tabindex="-1"></a>    {<span class="st">'learning_rate'</span>: [<span class="fl">0.1</span>, <span class="fl">0.01</span>, <span class="fl">0.05</span>],</span>
<span id="cb71-14"><a href="#cb71-14" aria-hidden="true" tabindex="-1"></a>     <span class="st">'subsample'</span>: [<span class="fl">0.6</span>,<span class="fl">0.8</span>,<span class="fl">0.9</span>],</span>
<span id="cb71-15"><a href="#cb71-15" aria-hidden="true" tabindex="-1"></a>     <span class="st">'n_estimators'</span>: [<span class="dv">16</span>,<span class="dv">64</span>,<span class="dv">128</span>]}</span>
<span id="cb71-16"><a href="#cb71-16" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb71-17"><a href="#cb71-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-18"><a href="#cb71-18" aria-hidden="true" tabindex="-1"></a>xgb <span class="op">=</span> XGBClassifier(tree_method <span class="op">=</span> <span class="st">'gpu_hist'</span>,random_state<span class="op">=</span><span class="dv">42</span>)</span>
<span id="cb71-19"><a href="#cb71-19" aria-hidden="true" tabindex="-1"></a>grid <span class="op">=</span> GridSearchCV(xgb, parameters, verbose<span class="op">=</span><span class="dv">0</span>, n_jobs<span class="op">=-</span><span class="dv">1</span>)</span>
<span id="cb71-20"><a href="#cb71-20" aria-hidden="true" tabindex="-1"></a>grid.fit(X_train_sample, y_train_encoded)</span>
<span id="cb71-21"><a href="#cb71-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-22"><a href="#cb71-22" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Best parameters scores:"</span>)</span>
<span id="cb71-23"><a href="#cb71-23" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(grid.best_params_)</span>
<span id="cb71-24"><a href="#cb71-24" aria-hidden="true" tabindex="-1"></a>best_params[<span class="st">"xgb"</span>] <span class="op">=</span> grid.best_params_</span>
<span id="cb71-25"><a href="#cb71-25" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Train score: "</span>, grid.score(X_train_sample, y_train_encoded))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>/opt/conda/lib/python3.10/site-packages/joblib/externals/loky/process_executor.py:700: UserWarning: A worker stopped while some jobs were given to the executor. This can be caused by a too short worker timeout or by a memory leak.
  warnings.warn(</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Best parameters scores:
{'learning_rate': 0.1, 'n_estimators': 128, 'subsample': 0.9}
Train score:  0.8716145833333333</code></pre>
</div>
</div>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-06-03T11:12:13.218885Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-06-03T11:12:13.216576Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-06-03T11:12:13.265957Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-06-03T11:12:13.264917Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2023-06-03T11:12:13.218836Z&quot;}" data-execution_count="331">
<div class="sourceCode cell-code" id="cb74"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a>pd.DataFrame(grid.cv_results_).sort_values(by<span class="op">=</span><span class="st">"rank_test_score"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="331">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">mean_fit_time</th>
<th data-quarto-table-cell-role="th">std_fit_time</th>
<th data-quarto-table-cell-role="th">mean_score_time</th>
<th data-quarto-table-cell-role="th">std_score_time</th>
<th data-quarto-table-cell-role="th">param_learning_rate</th>
<th data-quarto-table-cell-role="th">param_n_estimators</th>
<th data-quarto-table-cell-role="th">param_subsample</th>
<th data-quarto-table-cell-role="th">params</th>
<th data-quarto-table-cell-role="th">split0_test_score</th>
<th data-quarto-table-cell-role="th">split1_test_score</th>
<th data-quarto-table-cell-role="th">split2_test_score</th>
<th data-quarto-table-cell-role="th">split3_test_score</th>
<th data-quarto-table-cell-role="th">split4_test_score</th>
<th data-quarto-table-cell-role="th">mean_test_score</th>
<th data-quarto-table-cell-role="th">std_test_score</th>
<th data-quarto-table-cell-role="th">rank_test_score</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">8</td>
<td>3.067073</td>
<td>0.128407</td>
<td>0.077126</td>
<td>0.001278</td>
<td>0.1</td>
<td>128</td>
<td>0.9</td>
<td>{'learning_rate': 0.1, 'n_estimators': 128, 's...</td>
<td>0.800521</td>
<td>0.792708</td>
<td>0.786979</td>
<td>0.801823</td>
<td>0.793750</td>
<td>0.795156</td>
<td>0.005442</td>
<td>1</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">7</td>
<td>3.132010</td>
<td>0.157575</td>
<td>0.077569</td>
<td>0.000420</td>
<td>0.1</td>
<td>128</td>
<td>0.8</td>
<td>{'learning_rate': 0.1, 'n_estimators': 128, 's...</td>
<td>0.800521</td>
<td>0.792969</td>
<td>0.788542</td>
<td>0.797917</td>
<td>0.790885</td>
<td>0.794167</td>
<td>0.004434</td>
<td>2</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">6</td>
<td>3.214932</td>
<td>0.094857</td>
<td>0.077695</td>
<td>0.001827</td>
<td>0.1</td>
<td>128</td>
<td>0.6</td>
<td>{'learning_rate': 0.1, 'n_estimators': 128, 's...</td>
<td>0.796875</td>
<td>0.791146</td>
<td>0.788802</td>
<td>0.794792</td>
<td>0.794010</td>
<td>0.793125</td>
<td>0.002837</td>
<td>3</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">25</td>
<td>3.262971</td>
<td>0.023262</td>
<td>0.081692</td>
<td>0.006806</td>
<td>0.05</td>
<td>128</td>
<td>0.8</td>
<td>{'learning_rate': 0.05, 'n_estimators': 128, '...</td>
<td>0.796615</td>
<td>0.789844</td>
<td>0.781510</td>
<td>0.796875</td>
<td>0.788542</td>
<td>0.790677</td>
<td>0.005709</td>
<td>4</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">24</td>
<td>3.273804</td>
<td>0.056599</td>
<td>0.078601</td>
<td>0.002916</td>
<td>0.05</td>
<td>128</td>
<td>0.6</td>
<td>{'learning_rate': 0.05, 'n_estimators': 128, '...</td>
<td>0.794531</td>
<td>0.791146</td>
<td>0.779167</td>
<td>0.797396</td>
<td>0.789583</td>
<td>0.790365</td>
<td>0.006220</td>
<td>5</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">26</td>
<td>2.902239</td>
<td>0.472337</td>
<td>0.090681</td>
<td>0.035054</td>
<td>0.05</td>
<td>128</td>
<td>0.9</td>
<td>{'learning_rate': 0.05, 'n_estimators': 128, '...</td>
<td>0.793750</td>
<td>0.788021</td>
<td>0.780729</td>
<td>0.796094</td>
<td>0.789062</td>
<td>0.789531</td>
<td>0.005307</td>
<td>6</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">5</td>
<td>1.885446</td>
<td>0.033292</td>
<td>0.046460</td>
<td>0.002780</td>
<td>0.1</td>
<td>64</td>
<td>0.9</td>
<td>{'learning_rate': 0.1, 'n_estimators': 64, 'su...</td>
<td>0.792969</td>
<td>0.788802</td>
<td>0.779687</td>
<td>0.794010</td>
<td>0.789583</td>
<td>0.789010</td>
<td>0.005059</td>
<td>7</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">4</td>
<td>1.903320</td>
<td>0.040210</td>
<td>0.046029</td>
<td>0.002750</td>
<td>0.1</td>
<td>64</td>
<td>0.8</td>
<td>{'learning_rate': 0.1, 'n_estimators': 64, 'su...</td>
<td>0.791146</td>
<td>0.789323</td>
<td>0.779687</td>
<td>0.794531</td>
<td>0.786979</td>
<td>0.788333</td>
<td>0.004978</td>
<td>8</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">3</td>
<td>1.908362</td>
<td>0.046139</td>
<td>0.048469</td>
<td>0.002625</td>
<td>0.1</td>
<td>64</td>
<td>0.6</td>
<td>{'learning_rate': 0.1, 'n_estimators': 64, 'su...</td>
<td>0.790365</td>
<td>0.787760</td>
<td>0.782031</td>
<td>0.790625</td>
<td>0.788021</td>
<td>0.787760</td>
<td>0.003094</td>
<td>9</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">23</td>
<td>1.799945</td>
<td>0.035620</td>
<td>0.043470</td>
<td>0.001835</td>
<td>0.05</td>
<td>64</td>
<td>0.9</td>
<td>{'learning_rate': 0.05, 'n_estimators': 64, 's...</td>
<td>0.785677</td>
<td>0.781510</td>
<td>0.778385</td>
<td>0.792188</td>
<td>0.780208</td>
<td>0.783594</td>
<td>0.004922</td>
<td>10</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">21</td>
<td>1.614771</td>
<td>0.134312</td>
<td>0.058990</td>
<td>0.018729</td>
<td>0.05</td>
<td>64</td>
<td>0.6</td>
<td>{'learning_rate': 0.05, 'n_estimators': 64, 's...</td>
<td>0.782813</td>
<td>0.780990</td>
<td>0.777865</td>
<td>0.791667</td>
<td>0.782552</td>
<td>0.783177</td>
<td>0.004596</td>
<td>11</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">22</td>
<td>1.707692</td>
<td>0.017075</td>
<td>0.042289</td>
<td>0.001484</td>
<td>0.05</td>
<td>64</td>
<td>0.8</td>
<td>{'learning_rate': 0.05, 'n_estimators': 64, 's...</td>
<td>0.781250</td>
<td>0.782031</td>
<td>0.777344</td>
<td>0.793229</td>
<td>0.781510</td>
<td>0.783073</td>
<td>0.005345</td>
<td>12</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>0.572961</td>
<td>0.046966</td>
<td>0.019913</td>
<td>0.003506</td>
<td>0.1</td>
<td>16</td>
<td>0.9</td>
<td>{'learning_rate': 0.1, 'n_estimators': 16, 'su...</td>
<td>0.776823</td>
<td>0.772396</td>
<td>0.765625</td>
<td>0.784635</td>
<td>0.777083</td>
<td>0.775313</td>
<td>0.006240</td>
<td>13</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>0.624717</td>
<td>0.047690</td>
<td>0.025584</td>
<td>0.009838</td>
<td>0.1</td>
<td>16</td>
<td>0.8</td>
<td>{'learning_rate': 0.1, 'n_estimators': 16, 'su...</td>
<td>0.773698</td>
<td>0.771354</td>
<td>0.769531</td>
<td>0.783333</td>
<td>0.776823</td>
<td>0.774948</td>
<td>0.004851</td>
<td>14</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>1.088350</td>
<td>0.267042</td>
<td>0.020474</td>
<td>0.001141</td>
<td>0.1</td>
<td>16</td>
<td>0.6</td>
<td>{'learning_rate': 0.1, 'n_estimators': 16, 'su...</td>
<td>0.773958</td>
<td>0.771354</td>
<td>0.769792</td>
<td>0.782031</td>
<td>0.775260</td>
<td>0.774479</td>
<td>0.004234</td>
<td>15</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">15</td>
<td>3.299162</td>
<td>0.051481</td>
<td>0.086740</td>
<td>0.006313</td>
<td>0.01</td>
<td>128</td>
<td>0.6</td>
<td>{'learning_rate': 0.01, 'n_estimators': 128, '...</td>
<td>0.776042</td>
<td>0.770052</td>
<td>0.766927</td>
<td>0.783073</td>
<td>0.774219</td>
<td>0.774062</td>
<td>0.005516</td>
<td>16</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">16</td>
<td>3.348214</td>
<td>0.025955</td>
<td>0.079925</td>
<td>0.002310</td>
<td>0.01</td>
<td>128</td>
<td>0.8</td>
<td>{'learning_rate': 0.01, 'n_estimators': 128, '...</td>
<td>0.773958</td>
<td>0.770312</td>
<td>0.767448</td>
<td>0.781250</td>
<td>0.775521</td>
<td>0.773698</td>
<td>0.004711</td>
<td>17</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">17</td>
<td>3.244455</td>
<td>0.226082</td>
<td>0.081706</td>
<td>0.004990</td>
<td>0.01</td>
<td>128</td>
<td>0.9</td>
<td>{'learning_rate': 0.01, 'n_estimators': 128, '...</td>
<td>0.772135</td>
<td>0.770573</td>
<td>0.767188</td>
<td>0.779687</td>
<td>0.774740</td>
<td>0.772865</td>
<td>0.004197</td>
<td>18</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">19</td>
<td>0.321747</td>
<td>0.030242</td>
<td>0.019229</td>
<td>0.002176</td>
<td>0.05</td>
<td>16</td>
<td>0.8</td>
<td>{'learning_rate': 0.05, 'n_estimators': 16, 's...</td>
<td>0.772917</td>
<td>0.766667</td>
<td>0.769010</td>
<td>0.781250</td>
<td>0.774219</td>
<td>0.772813</td>
<td>0.005008</td>
<td>19</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">13</td>
<td>1.583413</td>
<td>0.019087</td>
<td>0.044925</td>
<td>0.000997</td>
<td>0.01</td>
<td>64</td>
<td>0.8</td>
<td>{'learning_rate': 0.01, 'n_estimators': 64, 's...</td>
<td>0.773438</td>
<td>0.767969</td>
<td>0.767448</td>
<td>0.778646</td>
<td>0.772656</td>
<td>0.772031</td>
<td>0.004090</td>
<td>20</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">18</td>
<td>0.431797</td>
<td>0.144698</td>
<td>0.019914</td>
<td>0.002237</td>
<td>0.05</td>
<td>16</td>
<td>0.6</td>
<td>{'learning_rate': 0.05, 'n_estimators': 16, 's...</td>
<td>0.772396</td>
<td>0.767188</td>
<td>0.765625</td>
<td>0.781771</td>
<td>0.771615</td>
<td>0.771719</td>
<td>0.005642</td>
<td>21</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">12</td>
<td>1.603554</td>
<td>0.050520</td>
<td>0.044817</td>
<td>0.000602</td>
<td>0.01</td>
<td>64</td>
<td>0.6</td>
<td>{'learning_rate': 0.01, 'n_estimators': 64, 's...</td>
<td>0.772135</td>
<td>0.765625</td>
<td>0.766667</td>
<td>0.782552</td>
<td>0.769792</td>
<td>0.771354</td>
<td>0.006054</td>
<td>22</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">9</td>
<td>0.425097</td>
<td>0.140382</td>
<td>0.018360</td>
<td>0.000347</td>
<td>0.01</td>
<td>16</td>
<td>0.6</td>
<td>{'learning_rate': 0.01, 'n_estimators': 16, 's...</td>
<td>0.773177</td>
<td>0.766927</td>
<td>0.767188</td>
<td>0.779687</td>
<td>0.769531</td>
<td>0.771302</td>
<td>0.004755</td>
<td>23</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">10</td>
<td>0.368848</td>
<td>0.027881</td>
<td>0.023753</td>
<td>0.012120</td>
<td>0.01</td>
<td>16</td>
<td>0.8</td>
<td>{'learning_rate': 0.01, 'n_estimators': 16, 's...</td>
<td>0.771094</td>
<td>0.769792</td>
<td>0.769010</td>
<td>0.776302</td>
<td>0.768750</td>
<td>0.770990</td>
<td>0.002779</td>
<td>24</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">11</td>
<td>0.466228</td>
<td>0.029073</td>
<td>0.022136</td>
<td>0.004022</td>
<td>0.01</td>
<td>16</td>
<td>0.9</td>
<td>{'learning_rate': 0.01, 'n_estimators': 16, 's...</td>
<td>0.767708</td>
<td>0.767708</td>
<td>0.770833</td>
<td>0.776042</td>
<td>0.771615</td>
<td>0.770781</td>
<td>0.003074</td>
<td>25</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">14</td>
<td>1.631280</td>
<td>0.042346</td>
<td>0.052837</td>
<td>0.012606</td>
<td>0.01</td>
<td>64</td>
<td>0.9</td>
<td>{'learning_rate': 0.01, 'n_estimators': 64, 's...</td>
<td>0.770052</td>
<td>0.768229</td>
<td>0.767969</td>
<td>0.776042</td>
<td>0.770573</td>
<td>0.770573</td>
<td>0.002914</td>
<td>26</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">20</td>
<td>0.407006</td>
<td>0.015373</td>
<td>0.018176</td>
<td>0.000642</td>
<td>0.05</td>
<td>16</td>
<td>0.9</td>
<td>{'learning_rate': 0.05, 'n_estimators': 16, 's...</td>
<td>0.768750</td>
<td>0.767188</td>
<td>0.766146</td>
<td>0.775521</td>
<td>0.772135</td>
<td>0.769948</td>
<td>0.003445</td>
<td>27</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<section id="running-the-best-params-xgb-model" class="level4">
<h4 class="anchored" data-anchor-id="running-the-best-params-xgb-model">Running the best params XGB Model</h4>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-06-03T11:12:13.268982Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-06-03T11:12:13.267783Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-06-03T11:12:35.303762Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-06-03T11:12:35.302802Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2023-06-03T11:12:13.268944Z&quot;}" data-execution_count="332">
<div class="sourceCode cell-code" id="cb75"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Best Param scores for XGB:"</span>)</span>
<span id="cb75-2"><a href="#cb75-2" aria-hidden="true" tabindex="-1"></a>xgb <span class="op">=</span> XGBClassifier(<span class="op">**</span>grid.best_params_,random_state<span class="op">=</span><span class="dv">42</span>)</span>
<span id="cb75-3"><a href="#cb75-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-4"><a href="#cb75-4" aria-hidden="true" tabindex="-1"></a>xgb.fit(X_train_sample, y_train_encoded)</span>
<span id="cb75-5"><a href="#cb75-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Storing the model trained with best params later used for visualizations</span></span>
<span id="cb75-6"><a href="#cb75-6" aria-hidden="true" tabindex="-1"></a>models[<span class="st">"XGB Classifier"</span>] <span class="op">=</span> xgb</span>
<span id="cb75-7"><a href="#cb75-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-8"><a href="#cb75-8" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Train Score: "</span>, xgb.score(X_train_sample, y_train_encoded))</span>
<span id="cb75-9"><a href="#cb75-9" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Validation Score: "</span>, xgb.score(X_val_sample, y_val_encoded))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Best Param scores for XGB:
Train Score:  0.8707291666666667
Validation Score:  0.795</code></pre>
</div>
</div>
</section>
<section id="xgb-conf.-matrix-on-validation-set" class="level4">
<h4 class="anchored" data-anchor-id="xgb-conf.-matrix-on-validation-set">XGB Conf. Matrix on Validation Set</h4>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-06-03T11:12:35.309739Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-06-03T11:12:35.307511Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-06-03T11:12:35.759216Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-06-03T11:12:35.758336Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2023-06-03T11:12:35.309709Z&quot;}" data-execution_count="333">
<div class="sourceCode cell-code" id="cb77"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a>y_pred <span class="op">=</span> xgb.predict(X_val_sample)</span>
<span id="cb77-2"><a href="#cb77-2" aria-hidden="true" tabindex="-1"></a>confmat <span class="op">=</span> confusion_matrix(y_true<span class="op">=</span>y_val_encoded, y_pred<span class="op">=</span>y_pred)</span>
<span id="cb77-3"><a href="#cb77-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-4"><a href="#cb77-4" aria-hidden="true" tabindex="-1"></a>index <span class="op">=</span> [<span class="st">"Actual Severity 1"</span>, <span class="st">"Actual Severity 2"</span>, <span class="st">"Actual Severity 3"</span>, <span class="st">"Actual Severity 4"</span>]</span>
<span id="cb77-5"><a href="#cb77-5" aria-hidden="true" tabindex="-1"></a>columns <span class="op">=</span> [<span class="st">"Predicted Severity 1"</span>, <span class="st">"Predicted Severity 2"</span>, <span class="st">"Predicted Severity 3"</span>, <span class="st">"Predicted Severity 4"</span>]</span>
<span id="cb77-6"><a href="#cb77-6" aria-hidden="true" tabindex="-1"></a>conf_matrix <span class="op">=</span> pd.DataFrame(data<span class="op">=</span>confmat, columns<span class="op">=</span>columns, index<span class="op">=</span>index)</span>
<span id="cb77-7"><a href="#cb77-7" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">8</span>, <span class="dv">5</span>))</span>
<span id="cb77-8"><a href="#cb77-8" aria-hidden="true" tabindex="-1"></a>sns.heatmap(conf_matrix, annot<span class="op">=</span><span class="va">True</span>, fmt<span class="op">=</span><span class="st">"d"</span>, cmap<span class="op">=</span><span class="st">"YlGnBu"</span>)</span>
<span id="cb77-9"><a href="#cb77-9" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"Confusion Matrix - XGB"</span>)</span>
<span id="cb77-10"><a href="#cb77-10" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="project-4-us-accidents-model-runs_files/figure-html/cell-55-output-1.png" class="img-fluid"></p>
</div>
</div>
</section>
<section id="metrics-scores-and-metric-visualizations-for-xgb-with-best-params" class="level4">
<h4 class="anchored" data-anchor-id="metrics-scores-and-metric-visualizations-for-xgb-with-best-params">Metrics Scores and Metric Visualizations for XGB with best params</h4>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-06-03T11:12:35.761301Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-06-03T11:12:35.760946Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-06-03T11:12:36.053651Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-06-03T11:12:36.052496Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2023-06-03T11:12:35.761267Z&quot;}" data-execution_count="334">
<div class="sourceCode cell-code" id="cb78"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a>y_pred <span class="op">=</span> xgb.predict(X_val_sample)</span>
<span id="cb78-2"><a href="#cb78-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-3"><a href="#cb78-3" aria-hidden="true" tabindex="-1"></a>accuracy[<span class="st">"XGB"</span>] <span class="op">=</span> accuracy_score(y_val_encoded, y_pred)</span>
<span id="cb78-4"><a href="#cb78-4" aria-hidden="true" tabindex="-1"></a>f1[<span class="st">"XGB"</span>] <span class="op">=</span> f1_score(y_val_encoded, y_pred, average<span class="op">=</span><span class="st">"macro"</span>)</span>
<span id="cb78-5"><a href="#cb78-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-6"><a href="#cb78-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(classification_report(y_train_encoded, xgb.predict(X_train_sample)))</span>
<span id="cb78-7"><a href="#cb78-7" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(classification_report(y_val_encoded, y_pred))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>              precision    recall  f1-score   support

           0       0.94      0.97      0.96      4822
           1       0.86      0.74      0.80      4734
           2       0.84      0.87      0.86      4865
           3       0.84      0.89      0.86      4779

    accuracy                           0.87     19200
   macro avg       0.87      0.87      0.87     19200
weighted avg       0.87      0.87      0.87     19200

              precision    recall  f1-score   support

           0       0.91      0.96      0.94      1193
           1       0.75      0.63      0.69      1232
           2       0.76      0.78      0.77      1206
           3       0.74      0.82      0.78      1169

    accuracy                           0.80      4800
   macro avg       0.79      0.80      0.79      4800
weighted avg       0.79      0.80      0.79      4800
</code></pre>
</div>
</div>
</section>
<section id="xgb-precision-vs-recall-curve-on-validation-set" class="level4">
<h4 class="anchored" data-anchor-id="xgb-precision-vs-recall-curve-on-validation-set">XGB Precision vs Recall Curve on Validation Set</h4>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-06-03T11:12:36.056110Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-06-03T11:12:36.055137Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-06-03T11:12:36.534240Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-06-03T11:12:36.533355Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2023-06-03T11:12:36.056070Z&quot;}" data-execution_count="335">
<div class="sourceCode cell-code" id="cb80"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a>Y <span class="op">=</span> label_binarize(y_val_encoded, classes<span class="op">=</span>[<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>])</span>
<span id="cb80-2"><a href="#cb80-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-3"><a href="#cb80-3" aria-hidden="true" tabindex="-1"></a>y_score <span class="op">=</span> xgb.predict_proba(X_val_sample)</span>
<span id="cb80-4"><a href="#cb80-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-5"><a href="#cb80-5" aria-hidden="true" tabindex="-1"></a>precision[<span class="st">"XGB"</span>], recall[<span class="st">"XGB"</span>], _ <span class="op">=</span> precision_recall_curve(Y.ravel(), y_score.ravel())</span>
<span id="cb80-6"><a href="#cb80-6" aria-hidden="true" tabindex="-1"></a>fpr[<span class="st">"XGB"</span>], tpr[<span class="st">"XGB"</span>], _ <span class="op">=</span> roc_curve(Y.ravel(), y_score.ravel())</span>
<span id="cb80-7"><a href="#cb80-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-8"><a href="#cb80-8" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">18</span>, <span class="dv">10</span>))</span>
<span id="cb80-9"><a href="#cb80-9" aria-hidden="true" tabindex="-1"></a>plt.step(recall[<span class="st">"XGB"</span>], precision[<span class="st">"XGB"</span>], where<span class="op">=</span><span class="st">"post"</span>)</span>
<span id="cb80-10"><a href="#cb80-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-11"><a href="#cb80-11" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">"Recall"</span>)</span>
<span id="cb80-12"><a href="#cb80-12" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">"Precision"</span>)</span>
<span id="cb80-13"><a href="#cb80-13" aria-hidden="true" tabindex="-1"></a>plt.xlim([<span class="dv">0</span>, <span class="dv">1</span>])</span>
<span id="cb80-14"><a href="#cb80-14" aria-hidden="true" tabindex="-1"></a>plt.ylim([<span class="dv">0</span>, <span class="fl">1.01</span>])</span>
<span id="cb80-15"><a href="#cb80-15" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"PR Curve - XGB"</span>)</span>
<span id="cb80-16"><a href="#cb80-16" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="project-4-us-accidents-model-runs_files/figure-html/cell-57-output-1.png" class="img-fluid"></p>
</div>
</div>
</section>
<section id="xgb-roc-curve-on-validation-set" class="level4">
<h4 class="anchored" data-anchor-id="xgb-roc-curve-on-validation-set">XGB ROC Curve on Validation Set</h4>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-06-03T11:12:36.536398Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-06-03T11:12:36.535823Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-06-03T11:12:36.940085Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-06-03T11:12:36.937768Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2023-06-03T11:12:36.536364Z&quot;}" data-execution_count="336">
<div class="sourceCode cell-code" id="cb81"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">18</span>, <span class="dv">10</span>))</span>
<span id="cb81-2"><a href="#cb81-2" aria-hidden="true" tabindex="-1"></a>plt.step(fpr[<span class="st">"XGB"</span>], tpr[<span class="st">"XGB"</span>], where<span class="op">=</span><span class="st">"post"</span>)</span>
<span id="cb81-3"><a href="#cb81-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-4"><a href="#cb81-4" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"ROC curve - XGB"</span>)</span>
<span id="cb81-5"><a href="#cb81-5" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">"False Positive Rate"</span>)</span>
<span id="cb81-6"><a href="#cb81-6" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">"True Positive Rate"</span>)</span>
<span id="cb81-7"><a href="#cb81-7" aria-hidden="true" tabindex="-1"></a>plt.xlim([<span class="dv">0</span>, <span class="dv">1</span>])</span>
<span id="cb81-8"><a href="#cb81-8" aria-hidden="true" tabindex="-1"></a>plt.ylim([<span class="dv">0</span>, <span class="fl">1.01</span>])</span>
<span id="cb81-9"><a href="#cb81-9" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="project-4-us-accidents-model-runs_files/figure-html/cell-58-output-1.png" class="img-fluid"></p>
</div>
</div>
</section>
</section>
<section id="multi-layer-perceptron" class="level3">
<h3 class="anchored" data-anchor-id="multi-layer-perceptron">Multi Layer Perceptron</h3>
<section id="multi-layer-perceptron-grid-search-cv-5---folds-run-to-find-best-params" class="level4">
<h4 class="anchored" data-anchor-id="multi-layer-perceptron-grid-search-cv-5---folds-run-to-find-best-params">Multi Layer Perceptron Grid Search CV (5 - folds) Run to find best params</h4>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-06-03T11:12:36.943543Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-06-03T11:12:36.943240Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-06-03T11:20:33.583350Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-06-03T11:20:33.581949Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2023-06-03T11:12:36.943518Z&quot;}" data-execution_count="337">
<div class="sourceCode cell-code" id="cb82"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true" tabindex="-1"></a>mlp <span class="op">=</span> MLPClassifier(random_state<span class="op">=</span><span class="dv">42</span>, verbose<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb82-2"><a href="#cb82-2" aria-hidden="true" tabindex="-1"></a>parameters <span class="op">=</span> [{<span class="st">"hidden_layer_sizes"</span>: [(<span class="dv">64</span>, <span class="dv">32</span>), (<span class="dv">32</span>, <span class="dv">64</span>, <span class="dv">32</span>)], <span class="st">"max_iter"</span>: [<span class="dv">200</span>], <span class="st">"solver"</span>: [<span class="st">"sgd"</span>, <span class="st">"adam"</span>], <span class="st">"activation"</span>: [<span class="st">"tanh"</span>, <span class="st">"relu"</span>]}]</span>
<span id="cb82-3"><a href="#cb82-3" aria-hidden="true" tabindex="-1"></a>grid <span class="op">=</span> GridSearchCV(mlp, parameters, verbose <span class="op">=</span> <span class="dv">0</span>, n_jobs<span class="op">=-</span><span class="dv">1</span>)</span>
<span id="cb82-4"><a href="#cb82-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-5"><a href="#cb82-5" aria-hidden="true" tabindex="-1"></a>grid.fit(X_train_sample, y_train_sample)</span>
<span id="cb82-6"><a href="#cb82-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-7"><a href="#cb82-7" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Best parameters scores:"</span>)</span>
<span id="cb82-8"><a href="#cb82-8" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(grid.best_params_)</span>
<span id="cb82-9"><a href="#cb82-9" aria-hidden="true" tabindex="-1"></a>best_params[<span class="st">"mlp"</span>] <span class="op">=</span> grid.best_params_</span>
<span id="cb82-10"><a href="#cb82-10" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Train score:"</span>, grid.score(X_train_sample, y_train_sample))</span>
<span id="cb82-11"><a href="#cb82-11" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Validation score:"</span>, grid.score(X_val_sample, y_val_sample))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>/opt/conda/lib/python3.10/site-packages/sklearn/neural_network/_multilayer_perceptron.py:686: ConvergenceWarning: Stochastic Optimizer: Maximum iterations (200) reached and the optimization hasn't converged yet.
  warnings.warn(
/opt/conda/lib/python3.10/site-packages/sklearn/neural_network/_multilayer_perceptron.py:686: ConvergenceWarning: Stochastic Optimizer: Maximum iterations (200) reached and the optimization hasn't converged yet.
  warnings.warn(
/opt/conda/lib/python3.10/site-packages/sklearn/neural_network/_multilayer_perceptron.py:686: ConvergenceWarning: Stochastic Optimizer: Maximum iterations (200) reached and the optimization hasn't converged yet.
  warnings.warn(
/opt/conda/lib/python3.10/site-packages/sklearn/neural_network/_multilayer_perceptron.py:686: ConvergenceWarning: Stochastic Optimizer: Maximum iterations (200) reached and the optimization hasn't converged yet.
  warnings.warn(
/opt/conda/lib/python3.10/site-packages/sklearn/neural_network/_multilayer_perceptron.py:686: ConvergenceWarning: Stochastic Optimizer: Maximum iterations (200) reached and the optimization hasn't converged yet.
  warnings.warn(
/opt/conda/lib/python3.10/site-packages/sklearn/neural_network/_multilayer_perceptron.py:686: ConvergenceWarning: Stochastic Optimizer: Maximum iterations (200) reached and the optimization hasn't converged yet.
  warnings.warn(
/opt/conda/lib/python3.10/site-packages/sklearn/neural_network/_multilayer_perceptron.py:686: ConvergenceWarning: Stochastic Optimizer: Maximum iterations (200) reached and the optimization hasn't converged yet.
  warnings.warn(
/opt/conda/lib/python3.10/site-packages/sklearn/neural_network/_multilayer_perceptron.py:686: ConvergenceWarning: Stochastic Optimizer: Maximum iterations (200) reached and the optimization hasn't converged yet.
  warnings.warn(
/opt/conda/lib/python3.10/site-packages/sklearn/neural_network/_multilayer_perceptron.py:686: ConvergenceWarning: Stochastic Optimizer: Maximum iterations (200) reached and the optimization hasn't converged yet.
  warnings.warn(
/opt/conda/lib/python3.10/site-packages/sklearn/neural_network/_multilayer_perceptron.py:686: ConvergenceWarning: Stochastic Optimizer: Maximum iterations (200) reached and the optimization hasn't converged yet.
  warnings.warn(
/opt/conda/lib/python3.10/site-packages/sklearn/neural_network/_multilayer_perceptron.py:686: ConvergenceWarning: Stochastic Optimizer: Maximum iterations (200) reached and the optimization hasn't converged yet.
  warnings.warn(
/opt/conda/lib/python3.10/site-packages/sklearn/neural_network/_multilayer_perceptron.py:686: ConvergenceWarning: Stochastic Optimizer: Maximum iterations (200) reached and the optimization hasn't converged yet.
  warnings.warn(
/opt/conda/lib/python3.10/site-packages/sklearn/neural_network/_multilayer_perceptron.py:686: ConvergenceWarning: Stochastic Optimizer: Maximum iterations (200) reached and the optimization hasn't converged yet.
  warnings.warn(
/opt/conda/lib/python3.10/site-packages/sklearn/neural_network/_multilayer_perceptron.py:686: ConvergenceWarning: Stochastic Optimizer: Maximum iterations (200) reached and the optimization hasn't converged yet.
  warnings.warn(
/opt/conda/lib/python3.10/site-packages/sklearn/neural_network/_multilayer_perceptron.py:686: ConvergenceWarning: Stochastic Optimizer: Maximum iterations (200) reached and the optimization hasn't converged yet.
  warnings.warn(
/opt/conda/lib/python3.10/site-packages/sklearn/neural_network/_multilayer_perceptron.py:686: ConvergenceWarning: Stochastic Optimizer: Maximum iterations (200) reached and the optimization hasn't converged yet.
  warnings.warn(
/opt/conda/lib/python3.10/site-packages/sklearn/neural_network/_multilayer_perceptron.py:686: ConvergenceWarning: Stochastic Optimizer: Maximum iterations (200) reached and the optimization hasn't converged yet.
  warnings.warn(
/opt/conda/lib/python3.10/site-packages/sklearn/neural_network/_multilayer_perceptron.py:686: ConvergenceWarning: Stochastic Optimizer: Maximum iterations (200) reached and the optimization hasn't converged yet.
  warnings.warn(
/opt/conda/lib/python3.10/site-packages/sklearn/neural_network/_multilayer_perceptron.py:686: ConvergenceWarning: Stochastic Optimizer: Maximum iterations (200) reached and the optimization hasn't converged yet.
  warnings.warn(
/opt/conda/lib/python3.10/site-packages/sklearn/neural_network/_multilayer_perceptron.py:686: ConvergenceWarning: Stochastic Optimizer: Maximum iterations (200) reached and the optimization hasn't converged yet.
  warnings.warn(
/opt/conda/lib/python3.10/site-packages/sklearn/neural_network/_multilayer_perceptron.py:686: ConvergenceWarning: Stochastic Optimizer: Maximum iterations (200) reached and the optimization hasn't converged yet.
  warnings.warn(
/opt/conda/lib/python3.10/site-packages/sklearn/neural_network/_multilayer_perceptron.py:686: ConvergenceWarning: Stochastic Optimizer: Maximum iterations (200) reached and the optimization hasn't converged yet.
  warnings.warn(
/opt/conda/lib/python3.10/site-packages/sklearn/neural_network/_multilayer_perceptron.py:686: ConvergenceWarning: Stochastic Optimizer: Maximum iterations (200) reached and the optimization hasn't converged yet.
  warnings.warn(
/opt/conda/lib/python3.10/site-packages/sklearn/neural_network/_multilayer_perceptron.py:686: ConvergenceWarning: Stochastic Optimizer: Maximum iterations (200) reached and the optimization hasn't converged yet.
  warnings.warn(
/opt/conda/lib/python3.10/site-packages/sklearn/neural_network/_multilayer_perceptron.py:686: ConvergenceWarning: Stochastic Optimizer: Maximum iterations (200) reached and the optimization hasn't converged yet.
  warnings.warn(
/opt/conda/lib/python3.10/site-packages/sklearn/neural_network/_multilayer_perceptron.py:686: ConvergenceWarning: Stochastic Optimizer: Maximum iterations (200) reached and the optimization hasn't converged yet.
  warnings.warn(
/opt/conda/lib/python3.10/site-packages/sklearn/neural_network/_multilayer_perceptron.py:686: ConvergenceWarning: Stochastic Optimizer: Maximum iterations (200) reached and the optimization hasn't converged yet.
  warnings.warn(
/opt/conda/lib/python3.10/site-packages/sklearn/neural_network/_multilayer_perceptron.py:686: ConvergenceWarning: Stochastic Optimizer: Maximum iterations (200) reached and the optimization hasn't converged yet.
  warnings.warn(
/opt/conda/lib/python3.10/site-packages/sklearn/neural_network/_multilayer_perceptron.py:686: ConvergenceWarning: Stochastic Optimizer: Maximum iterations (200) reached and the optimization hasn't converged yet.
  warnings.warn(
/opt/conda/lib/python3.10/site-packages/sklearn/neural_network/_multilayer_perceptron.py:686: ConvergenceWarning: Stochastic Optimizer: Maximum iterations (200) reached and the optimization hasn't converged yet.
  warnings.warn(
/opt/conda/lib/python3.10/site-packages/sklearn/neural_network/_multilayer_perceptron.py:686: ConvergenceWarning: Stochastic Optimizer: Maximum iterations (200) reached and the optimization hasn't converged yet.
  warnings.warn(
/opt/conda/lib/python3.10/site-packages/sklearn/neural_network/_multilayer_perceptron.py:686: ConvergenceWarning: Stochastic Optimizer: Maximum iterations (200) reached and the optimization hasn't converged yet.
  warnings.warn(
/opt/conda/lib/python3.10/site-packages/sklearn/neural_network/_multilayer_perceptron.py:686: ConvergenceWarning: Stochastic Optimizer: Maximum iterations (200) reached and the optimization hasn't converged yet.
  warnings.warn(
/opt/conda/lib/python3.10/site-packages/sklearn/neural_network/_multilayer_perceptron.py:686: ConvergenceWarning: Stochastic Optimizer: Maximum iterations (200) reached and the optimization hasn't converged yet.
  warnings.warn(
/opt/conda/lib/python3.10/site-packages/sklearn/neural_network/_multilayer_perceptron.py:686: ConvergenceWarning: Stochastic Optimizer: Maximum iterations (200) reached and the optimization hasn't converged yet.
  warnings.warn(
/opt/conda/lib/python3.10/site-packages/sklearn/neural_network/_multilayer_perceptron.py:686: ConvergenceWarning: Stochastic Optimizer: Maximum iterations (200) reached and the optimization hasn't converged yet.
  warnings.warn(
/opt/conda/lib/python3.10/site-packages/sklearn/neural_network/_multilayer_perceptron.py:686: ConvergenceWarning: Stochastic Optimizer: Maximum iterations (200) reached and the optimization hasn't converged yet.
  warnings.warn(
/opt/conda/lib/python3.10/site-packages/sklearn/neural_network/_multilayer_perceptron.py:686: ConvergenceWarning: Stochastic Optimizer: Maximum iterations (200) reached and the optimization hasn't converged yet.
  warnings.warn(
/opt/conda/lib/python3.10/site-packages/sklearn/neural_network/_multilayer_perceptron.py:686: ConvergenceWarning: Stochastic Optimizer: Maximum iterations (200) reached and the optimization hasn't converged yet.
  warnings.warn(
/opt/conda/lib/python3.10/site-packages/sklearn/neural_network/_multilayer_perceptron.py:686: ConvergenceWarning: Stochastic Optimizer: Maximum iterations (200) reached and the optimization hasn't converged yet.
  warnings.warn(
/opt/conda/lib/python3.10/site-packages/sklearn/neural_network/_multilayer_perceptron.py:686: ConvergenceWarning: Stochastic Optimizer: Maximum iterations (200) reached and the optimization hasn't converged yet.
  warnings.warn(</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Best parameters scores:
{'activation': 'tanh', 'hidden_layer_sizes': (64, 32), 'max_iter': 200, 'solver': 'adam'}
Train score: 0.8189583333333333
Validation score: 0.7510416666666667</code></pre>
</div>
</div>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-06-03T11:20:33.591867Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-06-03T11:20:33.587836Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-06-03T11:20:33.658401Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-06-03T11:20:33.656880Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2023-06-03T11:20:33.591807Z&quot;}" data-execution_count="338">
<div class="sourceCode cell-code" id="cb85"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb85-1"><a href="#cb85-1" aria-hidden="true" tabindex="-1"></a>pd.DataFrame(grid.cv_results_).sort_values(by<span class="op">=</span><span class="st">"rank_test_score"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="338">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">mean_fit_time</th>
<th data-quarto-table-cell-role="th">std_fit_time</th>
<th data-quarto-table-cell-role="th">mean_score_time</th>
<th data-quarto-table-cell-role="th">std_score_time</th>
<th data-quarto-table-cell-role="th">param_activation</th>
<th data-quarto-table-cell-role="th">param_hidden_layer_sizes</th>
<th data-quarto-table-cell-role="th">param_max_iter</th>
<th data-quarto-table-cell-role="th">param_solver</th>
<th data-quarto-table-cell-role="th">params</th>
<th data-quarto-table-cell-role="th">split0_test_score</th>
<th data-quarto-table-cell-role="th">split1_test_score</th>
<th data-quarto-table-cell-role="th">split2_test_score</th>
<th data-quarto-table-cell-role="th">split3_test_score</th>
<th data-quarto-table-cell-role="th">split4_test_score</th>
<th data-quarto-table-cell-role="th">mean_test_score</th>
<th data-quarto-table-cell-role="th">std_test_score</th>
<th data-quarto-table-cell-role="th">rank_test_score</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">1</td>
<td>19.106705</td>
<td>0.435495</td>
<td>0.009255</td>
<td>0.000457</td>
<td>tanh</td>
<td>(64, 32)</td>
<td>200</td>
<td>adam</td>
<td>{'activation': 'tanh', 'hidden_layer_sizes': (...</td>
<td>0.756250</td>
<td>0.752865</td>
<td>0.740885</td>
<td>0.762500</td>
<td>0.755208</td>
<td>0.753542</td>
<td>0.007085</td>
<td>1</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">6</td>
<td>22.971275</td>
<td>0.389052</td>
<td>0.008846</td>
<td>0.000471</td>
<td>relu</td>
<td>(32, 64, 32)</td>
<td>200</td>
<td>sgd</td>
<td>{'activation': 'relu', 'hidden_layer_sizes': (...</td>
<td>0.754167</td>
<td>0.746615</td>
<td>0.741146</td>
<td>0.761458</td>
<td>0.757812</td>
<td>0.752240</td>
<td>0.007409</td>
<td>2</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">3</td>
<td>23.115873</td>
<td>0.363470</td>
<td>0.010795</td>
<td>0.002369</td>
<td>tanh</td>
<td>(32, 64, 32)</td>
<td>200</td>
<td>adam</td>
<td>{'activation': 'tanh', 'hidden_layer_sizes': (...</td>
<td>0.742969</td>
<td>0.749740</td>
<td>0.746354</td>
<td>0.761458</td>
<td>0.754687</td>
<td>0.751042</td>
<td>0.006491</td>
<td>3</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2</td>
<td>20.719785</td>
<td>0.305517</td>
<td>0.009857</td>
<td>0.000625</td>
<td>tanh</td>
<td>(32, 64, 32)</td>
<td>200</td>
<td>sgd</td>
<td>{'activation': 'tanh', 'hidden_layer_sizes': (...</td>
<td>0.748958</td>
<td>0.743490</td>
<td>0.734635</td>
<td>0.752604</td>
<td>0.757812</td>
<td>0.747500</td>
<td>0.007951</td>
<td>4</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">5</td>
<td>24.164772</td>
<td>0.728618</td>
<td>0.011189</td>
<td>0.004261</td>
<td>relu</td>
<td>(64, 32)</td>
<td>200</td>
<td>adam</td>
<td>{'activation': 'relu', 'hidden_layer_sizes': (...</td>
<td>0.742708</td>
<td>0.752344</td>
<td>0.733333</td>
<td>0.754167</td>
<td>0.737760</td>
<td>0.744062</td>
<td>0.008091</td>
<td>5</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">4</td>
<td>19.729288</td>
<td>0.366591</td>
<td>0.009005</td>
<td>0.000415</td>
<td>relu</td>
<td>(64, 32)</td>
<td>200</td>
<td>sgd</td>
<td>{'activation': 'relu', 'hidden_layer_sizes': (...</td>
<td>0.744531</td>
<td>0.736198</td>
<td>0.731510</td>
<td>0.751563</td>
<td>0.747396</td>
<td>0.742240</td>
<td>0.007354</td>
<td>6</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">7</td>
<td>28.641310</td>
<td>3.188170</td>
<td>0.009927</td>
<td>0.002859</td>
<td>relu</td>
<td>(32, 64, 32)</td>
<td>200</td>
<td>adam</td>
<td>{'activation': 'relu', 'hidden_layer_sizes': (...</td>
<td>0.749740</td>
<td>0.742188</td>
<td>0.734375</td>
<td>0.745313</td>
<td>0.738542</td>
<td>0.742031</td>
<td>0.005310</td>
<td>7</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">0</td>
<td>16.518863</td>
<td>0.566479</td>
<td>0.011748</td>
<td>0.003198</td>
<td>tanh</td>
<td>(64, 32)</td>
<td>200</td>
<td>sgd</td>
<td>{'activation': 'tanh', 'hidden_layer_sizes': (...</td>
<td>0.730729</td>
<td>0.725260</td>
<td>0.714323</td>
<td>0.737760</td>
<td>0.732812</td>
<td>0.728177</td>
<td>0.008004</td>
<td>8</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
<section id="running-the-best-params-multi-layer-perceptron-model" class="level4">
<h4 class="anchored" data-anchor-id="running-the-best-params-multi-layer-perceptron-model">Running the best params Multi Layer Perceptron Model</h4>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-06-03T11:20:33.660731Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-06-03T11:20:33.660040Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-06-03T11:21:05.594949Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-06-03T11:21:05.593903Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2023-06-03T11:20:33.660693Z&quot;}" data-execution_count="339">
<div class="sourceCode cell-code" id="cb86"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb86-1"><a href="#cb86-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Best Param scores for Multi Layer Perceptron:"</span>)</span>
<span id="cb86-2"><a href="#cb86-2" aria-hidden="true" tabindex="-1"></a>mlp <span class="op">=</span> MLPClassifier(<span class="op">**</span>grid.best_params_, random_state<span class="op">=</span><span class="dv">42</span>)</span>
<span id="cb86-3"><a href="#cb86-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-4"><a href="#cb86-4" aria-hidden="true" tabindex="-1"></a>mlp.fit(X_train_sample, y_train_sample)</span>
<span id="cb86-5"><a href="#cb86-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Storing the model trained with best params later used for visualizations</span></span>
<span id="cb86-6"><a href="#cb86-6" aria-hidden="true" tabindex="-1"></a>models[<span class="st">"Multi Layer Perceptron"</span>] <span class="op">=</span> mlp</span>
<span id="cb86-7"><a href="#cb86-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-8"><a href="#cb86-8" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Train Score: "</span>, mlp.score(X_train_sample, y_train_sample))</span>
<span id="cb86-9"><a href="#cb86-9" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Validation Score: "</span>, mlp.score(X_val_sample, y_val_sample))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Best Param scores for Multi Layer Perceptron:
Train Score:  0.8189583333333333
Validation Score:  0.7510416666666667</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>/opt/conda/lib/python3.10/site-packages/sklearn/neural_network/_multilayer_perceptron.py:686: ConvergenceWarning: Stochastic Optimizer: Maximum iterations (200) reached and the optimization hasn't converged yet.
  warnings.warn(</code></pre>
</div>
</div>
</section>
<section id="multi-layer-perceptron-conf.-matrix-on-validation-set" class="level4">
<h4 class="anchored" data-anchor-id="multi-layer-perceptron-conf.-matrix-on-validation-set">Multi Layer Perceptron Conf. Matrix on Validation Set</h4>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-06-03T11:21:05.597323Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-06-03T11:21:05.596651Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-06-03T11:21:06.058248Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-06-03T11:21:06.057355Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2023-06-03T11:21:05.597288Z&quot;}" data-execution_count="340">
<div class="sourceCode cell-code" id="cb89"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb89-1"><a href="#cb89-1" aria-hidden="true" tabindex="-1"></a>y_pred <span class="op">=</span> mlp.predict(X_val_sample)</span>
<span id="cb89-2"><a href="#cb89-2" aria-hidden="true" tabindex="-1"></a>confmat <span class="op">=</span> confusion_matrix(y_true<span class="op">=</span>y_val_sample, y_pred<span class="op">=</span>y_pred)</span>
<span id="cb89-3"><a href="#cb89-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-4"><a href="#cb89-4" aria-hidden="true" tabindex="-1"></a>index <span class="op">=</span> [<span class="st">"Actual Severity 1"</span>, <span class="st">"Actual Severity 2"</span>, <span class="st">"Actual Severity 3"</span>, <span class="st">"Actual Severity 4"</span>]</span>
<span id="cb89-5"><a href="#cb89-5" aria-hidden="true" tabindex="-1"></a>columns <span class="op">=</span> [<span class="st">"Predicted Severity 1"</span>, <span class="st">"Predicted Severity 2"</span>, <span class="st">"Predicted Severity 3"</span>, <span class="st">"Predicted Severity 4"</span>]</span>
<span id="cb89-6"><a href="#cb89-6" aria-hidden="true" tabindex="-1"></a>conf_matrix <span class="op">=</span> pd.DataFrame(data<span class="op">=</span>confmat, columns<span class="op">=</span>columns, index<span class="op">=</span>index)</span>
<span id="cb89-7"><a href="#cb89-7" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">8</span>, <span class="dv">5</span>))</span>
<span id="cb89-8"><a href="#cb89-8" aria-hidden="true" tabindex="-1"></a>sns.heatmap(conf_matrix, annot<span class="op">=</span><span class="va">True</span>, fmt<span class="op">=</span><span class="st">"d"</span>, cmap<span class="op">=</span><span class="st">"YlGnBu"</span>)</span>
<span id="cb89-9"><a href="#cb89-9" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"Confusion Matrix - Multi Layer Perceptron"</span>)</span>
<span id="cb89-10"><a href="#cb89-10" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="project-4-us-accidents-model-runs_files/figure-html/cell-62-output-1.png" class="img-fluid"></p>
</div>
</div>
</section>
<section id="metrics-scores-and-metric-visualizations-for-multi-layer-perceptron-with-best-params" class="level4">
<h4 class="anchored" data-anchor-id="metrics-scores-and-metric-visualizations-for-multi-layer-perceptron-with-best-params">Metrics Scores and Metric Visualizations for Multi Layer Perceptron with best params</h4>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-06-03T11:21:06.060919Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-06-03T11:21:06.060220Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-06-03T11:21:06.191675Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-06-03T11:21:06.188228Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2023-06-03T11:21:06.060878Z&quot;}" data-execution_count="341">
<div class="sourceCode cell-code" id="cb90"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb90-1"><a href="#cb90-1" aria-hidden="true" tabindex="-1"></a>y_pred <span class="op">=</span> mlp.predict(X_val_sample)</span>
<span id="cb90-2"><a href="#cb90-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-3"><a href="#cb90-3" aria-hidden="true" tabindex="-1"></a>accuracy[<span class="st">"Multi Layer Perceptron"</span>] <span class="op">=</span> accuracy_score(y_val_sample, y_pred)</span>
<span id="cb90-4"><a href="#cb90-4" aria-hidden="true" tabindex="-1"></a>f1[<span class="st">"Multi Layer Perceptron"</span>] <span class="op">=</span> f1_score(y_val_sample, y_pred, average<span class="op">=</span><span class="st">"macro"</span>)</span>
<span id="cb90-5"><a href="#cb90-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-6"><a href="#cb90-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(classification_report(y_train_sample, mlp.predict(X_train_sample)))</span>
<span id="cb90-7"><a href="#cb90-7" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(classification_report(y_val_sample, y_pred))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>              precision    recall  f1-score   support

           1       0.91      0.97      0.94      4822
           2       0.75      0.72      0.73      4734
           3       0.80      0.79      0.80      4865
           4       0.81      0.79      0.80      4779

    accuracy                           0.82     19200
   macro avg       0.82      0.82      0.82     19200
weighted avg       0.82      0.82      0.82     19200

              precision    recall  f1-score   support

           1       0.88      0.95      0.91      1193
           2       0.66      0.62      0.64      1232
           3       0.74      0.71      0.73      1206
           4       0.71      0.72      0.72      1169

    accuracy                           0.75      4800
   macro avg       0.75      0.75      0.75      4800
weighted avg       0.75      0.75      0.75      4800
</code></pre>
</div>
</div>
</section>
<section id="multi-layer-perceptron-precision-vs-recall-curve-on-validation-set" class="level4">
<h4 class="anchored" data-anchor-id="multi-layer-perceptron-precision-vs-recall-curve-on-validation-set">Multi Layer Perceptron Precision vs Recall Curve on Validation Set</h4>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-06-03T11:21:06.193467Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-06-03T11:21:06.193083Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-06-03T11:21:06.649297Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-06-03T11:21:06.646747Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2023-06-03T11:21:06.193418Z&quot;}" data-execution_count="342">
<div class="sourceCode cell-code" id="cb92"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb92-1"><a href="#cb92-1" aria-hidden="true" tabindex="-1"></a>Y <span class="op">=</span> label_binarize(y_val_sample, classes<span class="op">=</span>[<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>])</span>
<span id="cb92-2"><a href="#cb92-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-3"><a href="#cb92-3" aria-hidden="true" tabindex="-1"></a>y_score <span class="op">=</span> mlp.predict_proba(X_val_sample)</span>
<span id="cb92-4"><a href="#cb92-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-5"><a href="#cb92-5" aria-hidden="true" tabindex="-1"></a>precision[<span class="st">"Multi Layer Perceptron"</span>], recall[<span class="st">"Multi Layer Perceptron"</span>], _ <span class="op">=</span> precision_recall_curve(Y.ravel(), y_score.ravel())</span>
<span id="cb92-6"><a href="#cb92-6" aria-hidden="true" tabindex="-1"></a>fpr[<span class="st">"Multi Layer Perceptron"</span>], tpr[<span class="st">"Multi Layer Perceptron"</span>], _ <span class="op">=</span> roc_curve(Y.ravel(), y_score.ravel())</span>
<span id="cb92-7"><a href="#cb92-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-8"><a href="#cb92-8" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">18</span>, <span class="dv">10</span>))</span>
<span id="cb92-9"><a href="#cb92-9" aria-hidden="true" tabindex="-1"></a>plt.step(recall[<span class="st">"Multi Layer Perceptron"</span>], precision[<span class="st">"Multi Layer Perceptron"</span>], where<span class="op">=</span><span class="st">"post"</span>)</span>
<span id="cb92-10"><a href="#cb92-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-11"><a href="#cb92-11" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">"Recall"</span>)</span>
<span id="cb92-12"><a href="#cb92-12" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">"Precision"</span>)</span>
<span id="cb92-13"><a href="#cb92-13" aria-hidden="true" tabindex="-1"></a>plt.xlim([<span class="dv">0</span>, <span class="dv">1</span>])</span>
<span id="cb92-14"><a href="#cb92-14" aria-hidden="true" tabindex="-1"></a>plt.ylim([<span class="dv">0</span>, <span class="fl">1.01</span>])</span>
<span id="cb92-15"><a href="#cb92-15" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"PR Curve - Multi Layer Perceptron"</span>)</span>
<span id="cb92-16"><a href="#cb92-16" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="project-4-us-accidents-model-runs_files/figure-html/cell-64-output-1.png" class="img-fluid"></p>
</div>
</div>
</section>
<section id="multi-layer-perceptron-roc-curve-on-validation-set" class="level4">
<h4 class="anchored" data-anchor-id="multi-layer-perceptron-roc-curve-on-validation-set">Multi Layer Perceptron ROC Curve on Validation Set</h4>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-06-03T11:21:06.651679Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-06-03T11:21:06.650682Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-06-03T11:21:07.069223Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-06-03T11:21:07.066784Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2023-06-03T11:21:06.651643Z&quot;}" data-execution_count="343">
<div class="sourceCode cell-code" id="cb93"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb93-1"><a href="#cb93-1" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">18</span>, <span class="dv">10</span>))</span>
<span id="cb93-2"><a href="#cb93-2" aria-hidden="true" tabindex="-1"></a>plt.step(fpr[<span class="st">"Multi Layer Perceptron"</span>], tpr[<span class="st">"Multi Layer Perceptron"</span>], where<span class="op">=</span><span class="st">"post"</span>)</span>
<span id="cb93-3"><a href="#cb93-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-4"><a href="#cb93-4" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"ROC curve - Multi Layer Perceptron"</span>)</span>
<span id="cb93-5"><a href="#cb93-5" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">"False Positive Rate"</span>)</span>
<span id="cb93-6"><a href="#cb93-6" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">"True Positive Rate"</span>)</span>
<span id="cb93-7"><a href="#cb93-7" aria-hidden="true" tabindex="-1"></a>plt.xlim([<span class="dv">0</span>, <span class="dv">1</span>])</span>
<span id="cb93-8"><a href="#cb93-8" aria-hidden="true" tabindex="-1"></a>plt.ylim([<span class="dv">0</span>, <span class="fl">1.01</span>])</span>
<span id="cb93-9"><a href="#cb93-9" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="project-4-us-accidents-model-runs_files/figure-html/cell-65-output-1.png" class="img-fluid"></p>
</div>
</div>
</section>
</section>
<section id="support-vector-machine" class="level3">
<h3 class="anchored" data-anchor-id="support-vector-machine">Support Vector Machine</h3>
<section id="grid-search-cv5-folds-run-to-find-best-params-1" class="level4">
<h4 class="anchored" data-anchor-id="grid-search-cv5-folds-run-to-find-best-params-1">Grid Search CV(5-folds) RUN to find best Params</h4>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-06-03T11:21:07.071251Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-06-03T11:21:07.070868Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-06-03T11:59:47.821513Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-06-03T11:59:47.820358Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2023-06-03T11:21:07.071217Z&quot;}" data-execution_count="344">
<div class="sourceCode cell-code" id="cb94"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb94-1"><a href="#cb94-1" aria-hidden="true" tabindex="-1"></a>parameters <span class="op">=</span> [{<span class="st">"kernel"</span>: [<span class="st">"linear"</span>, <span class="st">"rbf"</span>, <span class="st">"sigmoid"</span>], <span class="st">"C"</span>: [<span class="fl">.2</span>, <span class="fl">.5</span>, <span class="fl">.8</span>, <span class="fl">1.</span>]}, {<span class="st">"kernel"</span>: [<span class="st">"poly"</span>], <span class="st">"C"</span>: [<span class="fl">.2</span>, <span class="fl">.5</span>, <span class="fl">.8</span>, <span class="fl">1.</span>], <span class="st">"degree"</span>: [<span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>]}]</span>
<span id="cb94-2"><a href="#cb94-2" aria-hidden="true" tabindex="-1"></a>svc <span class="op">=</span> svm.SVC(verbose <span class="op">=</span> <span class="dv">0</span>, random_state <span class="op">=</span> <span class="dv">42</span>, shrinking <span class="op">=</span> <span class="va">False</span>)</span>
<span id="cb94-3"><a href="#cb94-3" aria-hidden="true" tabindex="-1"></a>grid <span class="op">=</span> GridSearchCV(svc, parameters, verbose <span class="op">=</span> <span class="dv">0</span>, n_jobs <span class="op">=</span> <span class="op">-</span><span class="dv">1</span>)</span>
<span id="cb94-4"><a href="#cb94-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-5"><a href="#cb94-5" aria-hidden="true" tabindex="-1"></a>grid.fit(X_sample_train,y_sample_train)</span>
<span id="cb94-6"><a href="#cb94-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Best parameters scores:"</span>)</span>
<span id="cb94-7"><a href="#cb94-7" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(grid.best_params_)</span>
<span id="cb94-8"><a href="#cb94-8" aria-hidden="true" tabindex="-1"></a>best_params[<span class="st">"svc"</span>] <span class="op">=</span> grid.best_params_</span>
<span id="cb94-9"><a href="#cb94-9" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Train score: "</span>, grid.score(X_sample_train, y_sample_train))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Best parameters scores:
{'C': 1.0, 'kernel': 'rbf'}
Train score:  0.7429166666666667</code></pre>
</div>
</div>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-06-03T11:59:47.823647Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-06-03T11:59:47.823270Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-06-03T11:59:47.865488Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-06-03T11:59:47.864344Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2023-06-03T11:59:47.823613Z&quot;}" data-execution_count="345">
<div class="sourceCode cell-code" id="cb96"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb96-1"><a href="#cb96-1" aria-hidden="true" tabindex="-1"></a>pd.DataFrame(grid.cv_results_).sort_values(by<span class="op">=</span><span class="st">"rank_test_score"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="345">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">mean_fit_time</th>
<th data-quarto-table-cell-role="th">std_fit_time</th>
<th data-quarto-table-cell-role="th">mean_score_time</th>
<th data-quarto-table-cell-role="th">std_score_time</th>
<th data-quarto-table-cell-role="th">param_C</th>
<th data-quarto-table-cell-role="th">param_kernel</th>
<th data-quarto-table-cell-role="th">param_degree</th>
<th data-quarto-table-cell-role="th">params</th>
<th data-quarto-table-cell-role="th">split0_test_score</th>
<th data-quarto-table-cell-role="th">split1_test_score</th>
<th data-quarto-table-cell-role="th">split2_test_score</th>
<th data-quarto-table-cell-role="th">split3_test_score</th>
<th data-quarto-table-cell-role="th">split4_test_score</th>
<th data-quarto-table-cell-role="th">mean_test_score</th>
<th data-quarto-table-cell-role="th">std_test_score</th>
<th data-quarto-table-cell-role="th">rank_test_score</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">10</td>
<td>32.260032</td>
<td>0.143948</td>
<td>8.945977</td>
<td>0.487535</td>
<td>1.0</td>
<td>rbf</td>
<td>NaN</td>
<td>{'C': 1.0, 'kernel': 'rbf'}</td>
<td>0.732500</td>
<td>0.729792</td>
<td>0.716875</td>
<td>0.716875</td>
<td>0.737708</td>
<td>0.726750</td>
<td>0.008455</td>
<td>1</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">23</td>
<td>27.574225</td>
<td>4.497365</td>
<td>3.685331</td>
<td>0.800828</td>
<td>1.0</td>
<td>poly</td>
<td>4</td>
<td>{'C': 1.0, 'degree': 4, 'kernel': 'poly'}</td>
<td>0.734375</td>
<td>0.731042</td>
<td>0.716875</td>
<td>0.716250</td>
<td>0.728125</td>
<td>0.725333</td>
<td>0.007432</td>
<td>2</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">22</td>
<td>26.673938</td>
<td>0.587722</td>
<td>4.095733</td>
<td>0.269865</td>
<td>1.0</td>
<td>poly</td>
<td>3</td>
<td>{'C': 1.0, 'degree': 3, 'kernel': 'poly'}</td>
<td>0.734583</td>
<td>0.730208</td>
<td>0.714375</td>
<td>0.715833</td>
<td>0.730625</td>
<td>0.725125</td>
<td>0.008336</td>
<td>3</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">7</td>
<td>31.650738</td>
<td>0.603531</td>
<td>8.659305</td>
<td>0.425884</td>
<td>0.8</td>
<td>rbf</td>
<td>NaN</td>
<td>{'C': 0.8, 'kernel': 'rbf'}</td>
<td>0.730625</td>
<td>0.727708</td>
<td>0.717292</td>
<td>0.715625</td>
<td>0.733542</td>
<td>0.724958</td>
<td>0.007201</td>
<td>4</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">20</td>
<td>28.384177</td>
<td>0.358249</td>
<td>4.026727</td>
<td>0.120665</td>
<td>0.8</td>
<td>poly</td>
<td>4</td>
<td>{'C': 0.8, 'degree': 4, 'kernel': 'poly'}</td>
<td>0.735000</td>
<td>0.728750</td>
<td>0.716250</td>
<td>0.716042</td>
<td>0.727083</td>
<td>0.724625</td>
<td>0.007410</td>
<td>5</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">19</td>
<td>26.849181</td>
<td>0.535798</td>
<td>3.905945</td>
<td>0.042064</td>
<td>0.8</td>
<td>poly</td>
<td>3</td>
<td>{'C': 0.8, 'degree': 3, 'kernel': 'poly'}</td>
<td>0.731875</td>
<td>0.727083</td>
<td>0.713333</td>
<td>0.715625</td>
<td>0.727708</td>
<td>0.723125</td>
<td>0.007285</td>
<td>6</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">17</td>
<td>28.644837</td>
<td>0.279786</td>
<td>4.240965</td>
<td>0.122288</td>
<td>0.5</td>
<td>poly</td>
<td>4</td>
<td>{'C': 0.5, 'degree': 4, 'kernel': 'poly'}</td>
<td>0.729375</td>
<td>0.725833</td>
<td>0.714583</td>
<td>0.711667</td>
<td>0.724792</td>
<td>0.721250</td>
<td>0.006868</td>
<td>7</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">4</td>
<td>30.592421</td>
<td>0.220757</td>
<td>8.872729</td>
<td>0.275204</td>
<td>0.5</td>
<td>rbf</td>
<td>NaN</td>
<td>{'C': 0.5, 'kernel': 'rbf'}</td>
<td>0.727083</td>
<td>0.724375</td>
<td>0.712917</td>
<td>0.711042</td>
<td>0.725417</td>
<td>0.720167</td>
<td>0.006767</td>
<td>8</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">16</td>
<td>26.924972</td>
<td>0.411861</td>
<td>4.175091</td>
<td>0.081210</td>
<td>0.5</td>
<td>poly</td>
<td>3</td>
<td>{'C': 0.5, 'degree': 3, 'kernel': 'poly'}</td>
<td>0.728125</td>
<td>0.725208</td>
<td>0.712083</td>
<td>0.710417</td>
<td>0.723542</td>
<td>0.719875</td>
<td>0.007213</td>
<td>9</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">21</td>
<td>25.660745</td>
<td>0.220622</td>
<td>3.786673</td>
<td>0.033971</td>
<td>1.0</td>
<td>poly</td>
<td>2</td>
<td>{'C': 1.0, 'degree': 2, 'kernel': 'poly'}</td>
<td>0.728333</td>
<td>0.723333</td>
<td>0.710000</td>
<td>0.710208</td>
<td>0.724583</td>
<td>0.719292</td>
<td>0.007680</td>
<td>10</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">18</td>
<td>27.656106</td>
<td>0.190797</td>
<td>4.025929</td>
<td>0.132961</td>
<td>0.8</td>
<td>poly</td>
<td>2</td>
<td>{'C': 0.8, 'degree': 2, 'kernel': 'poly'}</td>
<td>0.727083</td>
<td>0.720208</td>
<td>0.707708</td>
<td>0.708542</td>
<td>0.722708</td>
<td>0.717250</td>
<td>0.007773</td>
<td>11</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">15</td>
<td>26.182213</td>
<td>0.646138</td>
<td>4.284178</td>
<td>0.215900</td>
<td>0.5</td>
<td>poly</td>
<td>2</td>
<td>{'C': 0.5, 'degree': 2, 'kernel': 'poly'}</td>
<td>0.721875</td>
<td>0.717500</td>
<td>0.704167</td>
<td>0.701250</td>
<td>0.718333</td>
<td>0.712625</td>
<td>0.008281</td>
<td>12</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">14</td>
<td>26.844376</td>
<td>0.167522</td>
<td>4.344861</td>
<td>0.056929</td>
<td>0.2</td>
<td>poly</td>
<td>4</td>
<td>{'C': 0.2, 'degree': 4, 'kernel': 'poly'}</td>
<td>0.718125</td>
<td>0.714583</td>
<td>0.707708</td>
<td>0.701042</td>
<td>0.719792</td>
<td>0.712250</td>
<td>0.006973</td>
<td>13</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">13</td>
<td>26.483538</td>
<td>0.216705</td>
<td>4.263598</td>
<td>0.081068</td>
<td>0.2</td>
<td>poly</td>
<td>3</td>
<td>{'C': 0.2, 'degree': 3, 'kernel': 'poly'}</td>
<td>0.718750</td>
<td>0.717917</td>
<td>0.703125</td>
<td>0.700625</td>
<td>0.717917</td>
<td>0.711667</td>
<td>0.008040</td>
<td>14</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">1</td>
<td>32.616739</td>
<td>0.553255</td>
<td>9.559076</td>
<td>0.390377</td>
<td>0.2</td>
<td>rbf</td>
<td>NaN</td>
<td>{'C': 0.2, 'kernel': 'rbf'}</td>
<td>0.716042</td>
<td>0.710833</td>
<td>0.701875</td>
<td>0.697917</td>
<td>0.715833</td>
<td>0.708500</td>
<td>0.007376</td>
<td>15</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">12</td>
<td>26.256505</td>
<td>0.277525</td>
<td>4.265289</td>
<td>0.069630</td>
<td>0.2</td>
<td>poly</td>
<td>2</td>
<td>{'C': 0.2, 'degree': 2, 'kernel': 'poly'}</td>
<td>0.710208</td>
<td>0.707917</td>
<td>0.694792</td>
<td>0.690000</td>
<td>0.709792</td>
<td>0.702542</td>
<td>0.008457</td>
<td>16</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">9</td>
<td>39.759664</td>
<td>3.014081</td>
<td>4.062565</td>
<td>0.184938</td>
<td>1.0</td>
<td>linear</td>
<td>NaN</td>
<td>{'C': 1.0, 'kernel': 'linear'}</td>
<td>0.707500</td>
<td>0.703958</td>
<td>0.688542</td>
<td>0.695000</td>
<td>0.707917</td>
<td>0.700583</td>
<td>0.007605</td>
<td>17</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">6</td>
<td>37.558125</td>
<td>1.867674</td>
<td>4.326769</td>
<td>0.308217</td>
<td>0.8</td>
<td>linear</td>
<td>NaN</td>
<td>{'C': 0.8, 'kernel': 'linear'}</td>
<td>0.707500</td>
<td>0.703542</td>
<td>0.688750</td>
<td>0.695208</td>
<td>0.707292</td>
<td>0.700458</td>
<td>0.007354</td>
<td>18</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">3</td>
<td>32.760351</td>
<td>1.825576</td>
<td>4.020657</td>
<td>0.227193</td>
<td>0.5</td>
<td>linear</td>
<td>NaN</td>
<td>{'C': 0.5, 'kernel': 'linear'}</td>
<td>0.706250</td>
<td>0.701250</td>
<td>0.688333</td>
<td>0.694375</td>
<td>0.706667</td>
<td>0.699375</td>
<td>0.007083</td>
<td>19</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">0</td>
<td>27.609676</td>
<td>0.675959</td>
<td>3.929613</td>
<td>0.140739</td>
<td>0.2</td>
<td>linear</td>
<td>NaN</td>
<td>{'C': 0.2, 'kernel': 'linear'}</td>
<td>0.704792</td>
<td>0.701458</td>
<td>0.686250</td>
<td>0.693125</td>
<td>0.705000</td>
<td>0.698125</td>
<td>0.007333</td>
<td>20</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>48.653246</td>
<td>0.532096</td>
<td>9.786308</td>
<td>0.296511</td>
<td>0.2</td>
<td>sigmoid</td>
<td>NaN</td>
<td>{'C': 0.2, 'kernel': 'sigmoid'}</td>
<td>0.485625</td>
<td>0.496250</td>
<td>0.490208</td>
<td>0.499167</td>
<td>0.492500</td>
<td>0.492750</td>
<td>0.004706</td>
<td>21</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">5</td>
<td>44.946205</td>
<td>1.873551</td>
<td>9.529393</td>
<td>0.316044</td>
<td>0.5</td>
<td>sigmoid</td>
<td>NaN</td>
<td>{'C': 0.5, 'kernel': 'sigmoid'}</td>
<td>0.433125</td>
<td>0.441458</td>
<td>0.439375</td>
<td>0.453750</td>
<td>0.443958</td>
<td>0.442333</td>
<td>0.006742</td>
<td>22</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">8</td>
<td>40.732482</td>
<td>1.281626</td>
<td>8.942905</td>
<td>0.369305</td>
<td>0.8</td>
<td>sigmoid</td>
<td>NaN</td>
<td>{'C': 0.8, 'kernel': 'sigmoid'}</td>
<td>0.415000</td>
<td>0.425000</td>
<td>0.422292</td>
<td>0.451042</td>
<td>0.432292</td>
<td>0.429125</td>
<td>0.012277</td>
<td>23</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">11</td>
<td>38.995517</td>
<td>1.054987</td>
<td>8.819515</td>
<td>0.168747</td>
<td>1.0</td>
<td>sigmoid</td>
<td>NaN</td>
<td>{'C': 1.0, 'kernel': 'sigmoid'}</td>
<td>0.411042</td>
<td>0.422292</td>
<td>0.420208</td>
<td>0.452708</td>
<td>0.429375</td>
<td>0.427125</td>
<td>0.014067</td>
<td>24</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
<section id="running-the-best-params-svm-model" class="level4">
<h4 class="anchored" data-anchor-id="running-the-best-params-svm-model">Running the best params SVM model</h4>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-06-03T11:59:47.867242Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-06-03T11:59:47.866929Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-06-03T12:00:31.434758Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-06-03T12:00:31.433683Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2023-06-03T11:59:47.867212Z&quot;}" data-execution_count="346">
<div class="sourceCode cell-code" id="cb97"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb97-1"><a href="#cb97-1" aria-hidden="true" tabindex="-1"></a><span class="co">### We run the model on partial Dataset for fast training and observing the op/s.</span></span>
<span id="cb97-2"><a href="#cb97-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Best Param scores for SVM:"</span>)</span>
<span id="cb97-3"><a href="#cb97-3" aria-hidden="true" tabindex="-1"></a>svc <span class="op">=</span> svm.SVC(verbose <span class="op">=</span> <span class="dv">0</span>, random_state <span class="op">=</span> <span class="dv">42</span>, shrinking <span class="op">=</span> <span class="va">False</span>, C<span class="op">=</span><span class="dv">1</span>, kernel <span class="op">=</span> <span class="st">'rbf'</span>, degree <span class="op">=</span> <span class="dv">4</span>)</span>
<span id="cb97-4"><a href="#cb97-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb97-5"><a href="#cb97-5" aria-hidden="true" tabindex="-1"></a>svc.fit(X_train_sample, y_train_sample)</span>
<span id="cb97-6"><a href="#cb97-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Storing the model trained with best params later used for visualizations</span></span>
<span id="cb97-7"><a href="#cb97-7" aria-hidden="true" tabindex="-1"></a>models[<span class="st">"Support Vector Machine"</span>] <span class="op">=</span> svc</span>
<span id="cb97-8"><a href="#cb97-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb97-9"><a href="#cb97-9" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Train score:"</span>, svc.score(X_train_sample, y_train_sample))</span>
<span id="cb97-10"><a href="#cb97-10" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Validation score:"</span>, svc.score(X_val_sample, y_val_sample))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Best Param scores for SVM:
Train score: 0.7433333333333333
Validation score: 0.7204166666666667</code></pre>
</div>
</div>
</section>
<section id="svm-conf.-matrix-on-validation-set" class="level4">
<h4 class="anchored" data-anchor-id="svm-conf.-matrix-on-validation-set">SVM Conf. Matrix on Validation set</h4>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-06-03T12:00:31.436759Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-06-03T12:00:31.436339Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-06-03T12:00:37.229649Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-06-03T12:00:37.228448Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2023-06-03T12:00:31.436724Z&quot;}" data-execution_count="347">
<div class="sourceCode cell-code" id="cb99"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb99-1"><a href="#cb99-1" aria-hidden="true" tabindex="-1"></a>y_pred <span class="op">=</span> svc.predict(X_val_sample)</span>
<span id="cb99-2"><a href="#cb99-2" aria-hidden="true" tabindex="-1"></a>confmat <span class="op">=</span> confusion_matrix(y_true<span class="op">=</span>y_val_sample, y_pred<span class="op">=</span>y_pred)</span>
<span id="cb99-3"><a href="#cb99-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-4"><a href="#cb99-4" aria-hidden="true" tabindex="-1"></a>index <span class="op">=</span> [<span class="st">"Actual Severity 1"</span>, <span class="st">"Actual Severity 2"</span>, <span class="st">"Actual Severity 3"</span>, <span class="st">"Actual Severity 4"</span>]</span>
<span id="cb99-5"><a href="#cb99-5" aria-hidden="true" tabindex="-1"></a>columns <span class="op">=</span> [<span class="st">"Predicted Severity 1"</span>, <span class="st">"Predicted Severity 2"</span>, <span class="st">"Predicted Severity 3"</span>, <span class="st">"Predicted Severity 4"</span>]</span>
<span id="cb99-6"><a href="#cb99-6" aria-hidden="true" tabindex="-1"></a>conf_matrix <span class="op">=</span> pd.DataFrame(data<span class="op">=</span>confmat, columns<span class="op">=</span>columns, index<span class="op">=</span>index)</span>
<span id="cb99-7"><a href="#cb99-7" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">8</span>, <span class="dv">5</span>))</span>
<span id="cb99-8"><a href="#cb99-8" aria-hidden="true" tabindex="-1"></a>sns.heatmap(conf_matrix, annot<span class="op">=</span><span class="va">True</span>, fmt<span class="op">=</span><span class="st">"d"</span>, cmap<span class="op">=</span><span class="st">"YlGnBu"</span>)</span>
<span id="cb99-9"><a href="#cb99-9" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"Confusion Matrix - Support Vector Machine"</span>)</span>
<span id="cb99-10"><a href="#cb99-10" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="project-4-us-accidents-model-runs_files/figure-html/cell-69-output-1.png" class="img-fluid"></p>
</div>
</div>
</section>
<section id="metrics-scores-and-metric-visualizations-for-svm-with-best-params" class="level4">
<h4 class="anchored" data-anchor-id="metrics-scores-and-metric-visualizations-for-svm-with-best-params">Metrics Scores and Metric Visualizations for SVM with best params</h4>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-06-03T12:00:37.231303Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-06-03T12:00:37.230977Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-06-03T12:01:03.471534Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-06-03T12:01:03.470253Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2023-06-03T12:00:37.231275Z&quot;}" data-execution_count="348">
<div class="sourceCode cell-code" id="cb100"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb100-1"><a href="#cb100-1" aria-hidden="true" tabindex="-1"></a>y_pred <span class="op">=</span> svc.predict(X_val_sample)</span>
<span id="cb100-2"><a href="#cb100-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb100-3"><a href="#cb100-3" aria-hidden="true" tabindex="-1"></a>accuracy[<span class="st">"SVM"</span>] <span class="op">=</span> accuracy_score(y_val_sample, y_pred)</span>
<span id="cb100-4"><a href="#cb100-4" aria-hidden="true" tabindex="-1"></a>f1[<span class="st">"SVM"</span>] <span class="op">=</span> f1_score(y_val_sample, y_pred, average<span class="op">=</span><span class="st">"macro"</span>)</span>
<span id="cb100-5"><a href="#cb100-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb100-6"><a href="#cb100-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(classification_report(y_train_sample, svc.predict(X_train_sample)))</span>
<span id="cb100-7"><a href="#cb100-7" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(classification_report(y_val_sample, y_pred))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>              precision    recall  f1-score   support

           1       0.80      0.91      0.85      4822
           2       0.72      0.50      0.59      4734
           3       0.74      0.80      0.77      4865
           4       0.70      0.76      0.73      4779

    accuracy                           0.74     19200
   macro avg       0.74      0.74      0.73     19200
weighted avg       0.74      0.74      0.74     19200

              precision    recall  f1-score   support

           1       0.77      0.90      0.83      1193
           2       0.69      0.48      0.56      1232
           3       0.74      0.77      0.75      1206
           4       0.67      0.74      0.70      1169

    accuracy                           0.72      4800
   macro avg       0.72      0.72      0.71      4800
weighted avg       0.72      0.72      0.71      4800
</code></pre>
</div>
</div>
</section>
<section id="svm-precision-vs-recall-curve-on-validation-set" class="level4">
<h4 class="anchored" data-anchor-id="svm-precision-vs-recall-curve-on-validation-set">SVM Precision vs Recall Curve on Validation set</h4>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-06-03T12:01:03.473285Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-06-03T12:01:03.472878Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-06-03T12:01:09.239207Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-06-03T12:01:09.238328Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2023-06-03T12:01:03.473238Z&quot;}" data-execution_count="349">
<div class="sourceCode cell-code" id="cb102"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb102-1"><a href="#cb102-1" aria-hidden="true" tabindex="-1"></a>Y <span class="op">=</span> label_binarize(y_val_sample, classes<span class="op">=</span>[<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>])</span>
<span id="cb102-2"><a href="#cb102-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-3"><a href="#cb102-3" aria-hidden="true" tabindex="-1"></a>y_score <span class="op">=</span> svc.decision_function(X_val_sample)</span>
<span id="cb102-4"><a href="#cb102-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-5"><a href="#cb102-5" aria-hidden="true" tabindex="-1"></a>precision[<span class="st">"SVM"</span>], recall[<span class="st">"SVM"</span>], _ <span class="op">=</span> precision_recall_curve(Y.ravel(), y_score.ravel())</span>
<span id="cb102-6"><a href="#cb102-6" aria-hidden="true" tabindex="-1"></a>fpr[<span class="st">"SVM"</span>], tpr[<span class="st">"SVM"</span>], _ <span class="op">=</span> roc_curve(Y.ravel(), y_score.ravel())</span>
<span id="cb102-7"><a href="#cb102-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-8"><a href="#cb102-8" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">18</span>, <span class="dv">10</span>))</span>
<span id="cb102-9"><a href="#cb102-9" aria-hidden="true" tabindex="-1"></a>plt.step(recall[<span class="st">"SVM"</span>], precision[<span class="st">"SVM"</span>], where<span class="op">=</span><span class="st">"post"</span>)</span>
<span id="cb102-10"><a href="#cb102-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-11"><a href="#cb102-11" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">"Recall"</span>)</span>
<span id="cb102-12"><a href="#cb102-12" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">"Precision"</span>)</span>
<span id="cb102-13"><a href="#cb102-13" aria-hidden="true" tabindex="-1"></a>plt.xlim([<span class="dv">0</span>, <span class="dv">1</span>])</span>
<span id="cb102-14"><a href="#cb102-14" aria-hidden="true" tabindex="-1"></a>plt.ylim([<span class="dv">0</span>, <span class="fl">1.01</span>])</span>
<span id="cb102-15"><a href="#cb102-15" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"PR Curve - Support Vector Machine"</span>)</span>
<span id="cb102-16"><a href="#cb102-16" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="project-4-us-accidents-model-runs_files/figure-html/cell-71-output-1.png" class="img-fluid"></p>
</div>
</div>
</section>
<section id="svm-roc-curve-on-validation-set" class="level4">
<h4 class="anchored" data-anchor-id="svm-roc-curve-on-validation-set">SVM ROC Curve on Validation set</h4>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-06-03T12:01:09.241038Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-06-03T12:01:09.240690Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-06-03T12:01:09.650919Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-06-03T12:01:09.650037Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2023-06-03T12:01:09.241009Z&quot;}" data-execution_count="350">
<div class="sourceCode cell-code" id="cb103"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb103-1"><a href="#cb103-1" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">18</span>, <span class="dv">10</span>))</span>
<span id="cb103-2"><a href="#cb103-2" aria-hidden="true" tabindex="-1"></a>plt.step(fpr[<span class="st">"SVM"</span>], tpr[<span class="st">"SVM"</span>], where<span class="op">=</span><span class="st">"post"</span>)</span>
<span id="cb103-3"><a href="#cb103-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-4"><a href="#cb103-4" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"ROC curve - Support Vector Machine"</span>)</span>
<span id="cb103-5"><a href="#cb103-5" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">"False Positive Rate"</span>)</span>
<span id="cb103-6"><a href="#cb103-6" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">"True Positive Rate"</span>)</span>
<span id="cb103-7"><a href="#cb103-7" aria-hidden="true" tabindex="-1"></a>plt.xlim([<span class="dv">0</span>, <span class="dv">1</span>])</span>
<span id="cb103-8"><a href="#cb103-8" aria-hidden="true" tabindex="-1"></a>plt.ylim([<span class="dv">0</span>, <span class="fl">1.01</span>])</span>
<span id="cb103-9"><a href="#cb103-9" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="project-4-us-accidents-model-runs_files/figure-html/cell-72-output-1.png" class="img-fluid"></p>
</div>
</div>
</section>
</section>
</section>
<section id="result-and-comparisions-after-training-on-partial-data" class="level2">
<h2 class="anchored" data-anchor-id="result-and-comparisions-after-training-on-partial-data">Result and Comparisions after Training on Partial Data</h2>
<ul>
<li><strong>Partial data is used to train since models like SVM can’t train on the whole dataset, efficiently, until Kaggle notebook Time’s Out.</strong></li>
<li>So we use partial data to train the model and then select the best of these by comparing results on Validation data</li>
</ul>
<section id="accuracy-metric-comparision-between-models" class="level4">
<h4 class="anchored" data-anchor-id="accuracy-metric-comparision-between-models">Accuracy Metric Comparision between Models</h4>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-06-03T13:09:04.687170Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-06-03T13:09:04.686594Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-06-03T13:09:06.594180Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-06-03T13:09:06.593304Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2023-06-03T13:09:04.687130Z&quot;}" data-execution_count="377">
<div class="sourceCode cell-code" id="cb104"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb104-1"><a href="#cb104-1" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">20</span>, <span class="dv">8</span>))</span>
<span id="cb104-2"><a href="#cb104-2" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"Accuracy on Validation Set for Each Model"</span>)</span>
<span id="cb104-3"><a href="#cb104-3" aria-hidden="true" tabindex="-1"></a>sorted_accuracy <span class="op">=</span> <span class="bu">sorted</span>(accuracy.items(), key<span class="op">=</span><span class="kw">lambda</span> x: x[<span class="dv">1</span>])</span>
<span id="cb104-4"><a href="#cb104-4" aria-hidden="true" tabindex="-1"></a>sorted_labels <span class="op">=</span> [item[<span class="dv">0</span>] <span class="cf">for</span> item <span class="kw">in</span> sorted_accuracy]</span>
<span id="cb104-5"><a href="#cb104-5" aria-hidden="true" tabindex="-1"></a>sorted_values <span class="op">=</span> [item[<span class="dv">1</span>] <span class="cf">for</span> item <span class="kw">in</span> sorted_accuracy]</span>
<span id="cb104-6"><a href="#cb104-6" aria-hidden="true" tabindex="-1"></a>sns.barplot(x<span class="op">=</span>sorted_labels, y<span class="op">=</span>sorted_values)</span>
<span id="cb104-7"><a href="#cb104-7" aria-hidden="true" tabindex="-1"></a>plt.xticks(rotation<span class="op">=</span><span class="dv">90</span>)</span>
<span id="cb104-8"><a href="#cb104-8" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">"Model"</span>)</span>
<span id="cb104-9"><a href="#cb104-9" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">"Accuracy"</span>)</span>
<span id="cb104-10"><a href="#cb104-10" aria-hidden="true" tabindex="-1"></a>plt.savefig(<span class="st">"All_Models_Accuracy_Score_Plot_on_Val_Set.png"</span>,bbox_inches <span class="op">=</span> <span class="st">'tight'</span>, dpi <span class="op">=</span> <span class="dv">300</span>)</span>
<span id="cb104-11"><a href="#cb104-11" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="project-4-us-accidents-model-runs_files/figure-html/cell-73-output-1.png" class="img-fluid"></p>
</div>
</div>
</section>
<section id="f1-score-metric-comparision-between-models" class="level4">
<h4 class="anchored" data-anchor-id="f1-score-metric-comparision-between-models">F1-Score Metric Comparision between Models</h4>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-06-03T13:09:30.503105Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-06-03T13:09:30.502737Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-06-03T13:09:32.243507Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-06-03T13:09:32.242428Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2023-06-03T13:09:30.503075Z&quot;}" data-execution_count="378">
<div class="sourceCode cell-code" id="cb105"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb105-1"><a href="#cb105-1" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">20</span>, <span class="dv">8</span>))</span>
<span id="cb105-2"><a href="#cb105-2" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"F1 Score on Validation set for each model"</span>)</span>
<span id="cb105-3"><a href="#cb105-3" aria-hidden="true" tabindex="-1"></a>sorted_f1 <span class="op">=</span> <span class="bu">sorted</span>(f1.items(), key<span class="op">=</span><span class="kw">lambda</span> x: x[<span class="dv">1</span>])</span>
<span id="cb105-4"><a href="#cb105-4" aria-hidden="true" tabindex="-1"></a>sorted_labels <span class="op">=</span> [item[<span class="dv">0</span>] <span class="cf">for</span> item <span class="kw">in</span> sorted_f1]</span>
<span id="cb105-5"><a href="#cb105-5" aria-hidden="true" tabindex="-1"></a>sorted_values <span class="op">=</span> [item[<span class="dv">1</span>] <span class="cf">for</span> item <span class="kw">in</span> sorted_f1]</span>
<span id="cb105-6"><a href="#cb105-6" aria-hidden="true" tabindex="-1"></a>sns.barplot(x<span class="op">=</span>sorted_labels, y<span class="op">=</span>sorted_values)</span>
<span id="cb105-7"><a href="#cb105-7" aria-hidden="true" tabindex="-1"></a>plt.xticks(rotation<span class="op">=</span><span class="dv">90</span>)</span>
<span id="cb105-8"><a href="#cb105-8" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">"Model"</span>)</span>
<span id="cb105-9"><a href="#cb105-9" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">"F1- Score"</span>)</span>
<span id="cb105-10"><a href="#cb105-10" aria-hidden="true" tabindex="-1"></a>plt.savefig(<span class="st">"All_Models_F1_Score_Plot_on_Val_Set.png"</span>,bbox_inches <span class="op">=</span> <span class="st">'tight'</span>, dpi <span class="op">=</span> <span class="dv">300</span>)</span>
<span id="cb105-11"><a href="#cb105-11" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="project-4-us-accidents-model-runs_files/figure-html/cell-74-output-1.png" class="img-fluid"></p>
</div>
</div>
</section>
<section id="pr-curve-comparision-between-models" class="level4">
<h4 class="anchored" data-anchor-id="pr-curve-comparision-between-models">PR Curve Comparision between Models</h4>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-06-03T13:09:59.049237Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-06-03T13:09:59.048868Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-06-03T13:10:03.253243Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-06-03T13:10:03.252321Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2023-06-03T13:09:59.049205Z&quot;}" data-execution_count="379">
<div class="sourceCode cell-code" id="cb106"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb106-1"><a href="#cb106-1" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">20</span>, <span class="dv">8</span>))</span>
<span id="cb106-2"><a href="#cb106-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> key <span class="kw">in</span> f1.keys():</span>
<span id="cb106-3"><a href="#cb106-3" aria-hidden="true" tabindex="-1"></a>    plt.step(recall[key], precision[key], where<span class="op">=</span><span class="st">"post"</span>, label<span class="op">=</span>key)</span>
<span id="cb106-4"><a href="#cb106-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-5"><a href="#cb106-5" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">"Recall"</span>)</span>
<span id="cb106-6"><a href="#cb106-6" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">"Precision"</span>)</span>
<span id="cb106-7"><a href="#cb106-7" aria-hidden="true" tabindex="-1"></a>plt.xlim([<span class="dv">0</span>, <span class="dv">1</span>])</span>
<span id="cb106-8"><a href="#cb106-8" aria-hidden="true" tabindex="-1"></a>plt.ylim([<span class="dv">0</span>, <span class="fl">1.01</span>])</span>
<span id="cb106-9"><a href="#cb106-9" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"PR curve"</span>)</span>
<span id="cb106-10"><a href="#cb106-10" aria-hidden="true" tabindex="-1"></a>plt.legend()</span>
<span id="cb106-11"><a href="#cb106-11" aria-hidden="true" tabindex="-1"></a>plt.savefig(<span class="st">"All_Models_PR_Curve_plot.png"</span>,bbox_inches <span class="op">=</span> <span class="st">'tight'</span>, dpi <span class="op">=</span> <span class="dv">300</span>)</span>
<span id="cb106-12"><a href="#cb106-12" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="project-4-us-accidents-model-runs_files/figure-html/cell-75-output-1.png" class="img-fluid"></p>
</div>
</div>
</section>
<section id="roc-curve-comparision-between-models" class="level4">
<h4 class="anchored" data-anchor-id="roc-curve-comparision-between-models">ROC Curve Comparision between Models</h4>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-06-03T13:10:27.523578Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-06-03T13:10:27.523193Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-06-03T13:10:30.026186Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-06-03T13:10:30.025333Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2023-06-03T13:10:27.523548Z&quot;}" data-execution_count="380">
<div class="sourceCode cell-code" id="cb107"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb107-1"><a href="#cb107-1" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">20</span>, <span class="dv">8</span>))</span>
<span id="cb107-2"><a href="#cb107-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> key <span class="kw">in</span> f1.keys():</span>
<span id="cb107-3"><a href="#cb107-3" aria-hidden="true" tabindex="-1"></a>    plt.step(fpr[key], tpr[key], where<span class="op">=</span><span class="st">"post"</span>, label<span class="op">=</span>key)</span>
<span id="cb107-4"><a href="#cb107-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-5"><a href="#cb107-5" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">"False Positive Rate"</span>)</span>
<span id="cb107-6"><a href="#cb107-6" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">"True Positive Rate"</span>)</span>
<span id="cb107-7"><a href="#cb107-7" aria-hidden="true" tabindex="-1"></a>plt.xlim([<span class="dv">0</span>, <span class="dv">1</span>])</span>
<span id="cb107-8"><a href="#cb107-8" aria-hidden="true" tabindex="-1"></a>plt.ylim([<span class="dv">0</span>, <span class="fl">1.01</span>])</span>
<span id="cb107-9"><a href="#cb107-9" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"ROC curve"</span>)</span>
<span id="cb107-10"><a href="#cb107-10" aria-hidden="true" tabindex="-1"></a>plt.legend()</span>
<span id="cb107-11"><a href="#cb107-11" aria-hidden="true" tabindex="-1"></a>plt.savefig(<span class="st">"All_Models_ROC_Curve_plot.png"</span>,bbox_inches <span class="op">=</span> <span class="st">'tight'</span>, dpi <span class="op">=</span> <span class="dv">300</span>)</span>
<span id="cb107-12"><a href="#cb107-12" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="project-4-us-accidents-model-runs_files/figure-html/cell-76-output-1.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-06-03T12:01:18.042750Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-06-03T12:01:18.041663Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-06-03T12:01:34.730454Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-06-03T12:01:34.729363Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2023-06-03T12:01:18.042711Z&quot;}" data-execution_count="355">
<div class="sourceCode cell-code" id="cb108"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb108-1"><a href="#cb108-1" aria-hidden="true" tabindex="-1"></a>fig, axs <span class="op">=</span> plt.subplots(<span class="dv">3</span>, <span class="dv">3</span>, figsize<span class="op">=</span>(<span class="dv">18</span>, <span class="dv">12</span>))</span>
<span id="cb108-2"><a href="#cb108-2" aria-hidden="true" tabindex="-1"></a>axs <span class="op">=</span> axs.ravel()</span>
<span id="cb108-3"><a href="#cb108-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i, (name, model) <span class="kw">in</span> <span class="bu">enumerate</span>(models.items()):</span>
<span id="cb108-4"><a href="#cb108-4" aria-hidden="true" tabindex="-1"></a>    ax <span class="op">=</span> axs[i]</span>
<span id="cb108-5"><a href="#cb108-5" aria-hidden="true" tabindex="-1"></a>    y_pred <span class="op">=</span> model.predict(X_val_sample)</span>
<span id="cb108-6"><a href="#cb108-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> name <span class="op">==</span> <span class="st">"XGB Classifier"</span>:</span>
<span id="cb108-7"><a href="#cb108-7" aria-hidden="true" tabindex="-1"></a>        confmat <span class="op">=</span> confusion_matrix(y_true<span class="op">=</span>y_val_encoded, y_pred<span class="op">=</span>y_pred)</span>
<span id="cb108-8"><a href="#cb108-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb108-9"><a href="#cb108-9" aria-hidden="true" tabindex="-1"></a>        confmat <span class="op">=</span> confusion_matrix(y_true<span class="op">=</span>y_val_sample, y_pred<span class="op">=</span>y_pred)</span>
<span id="cb108-10"><a href="#cb108-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-11"><a href="#cb108-11" aria-hidden="true" tabindex="-1"></a>    index <span class="op">=</span> [<span class="st">"Actual Severity 1"</span>, <span class="st">"Actual Severity 2"</span>, <span class="st">"Actual Severity 3"</span>, <span class="st">"Actual Severity 4"</span>]</span>
<span id="cb108-12"><a href="#cb108-12" aria-hidden="true" tabindex="-1"></a>    columns <span class="op">=</span> [<span class="st">"Predicted Severity 1"</span>, <span class="st">"Predicted Severity 2"</span>, <span class="st">"Predicted Severity 3"</span>, <span class="st">"Predicted Severity 4"</span>]</span>
<span id="cb108-13"><a href="#cb108-13" aria-hidden="true" tabindex="-1"></a>    conf_matrix <span class="op">=</span> pd.DataFrame(data<span class="op">=</span>confmat, columns<span class="op">=</span>columns, index<span class="op">=</span>index)</span>
<span id="cb108-14"><a href="#cb108-14" aria-hidden="true" tabindex="-1"></a>    sns.heatmap(conf_matrix, annot<span class="op">=</span><span class="va">True</span>, fmt<span class="op">=</span><span class="st">"d"</span>, cmap<span class="op">=</span><span class="st">"YlGnBu"</span>, ax<span class="op">=</span>ax)</span>
<span id="cb108-15"><a href="#cb108-15" aria-hidden="true" tabindex="-1"></a>    ax.set_title(<span class="ss">f"Confusion Matrix - </span><span class="sc">{</span>name<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb108-16"><a href="#cb108-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-17"><a href="#cb108-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Hide the remaining subplots</span></span>
<span id="cb108-18"><a href="#cb108-18" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> j <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(models), <span class="bu">len</span>(axs)):</span>
<span id="cb108-19"><a href="#cb108-19" aria-hidden="true" tabindex="-1"></a>    axs[j].axis(<span class="st">'off'</span>)</span>
<span id="cb108-20"><a href="#cb108-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-21"><a href="#cb108-21" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb108-22"><a href="#cb108-22" aria-hidden="true" tabindex="-1"></a>plt.savefig(<span class="st">"All_Models_Conf_Matrix_Plot.png"</span>,bbox_inches <span class="op">=</span> <span class="st">'tight'</span>, dpi <span class="op">=</span> <span class="dv">300</span>)</span>
<span id="cb108-23"><a href="#cb108-23" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="project-4-us-accidents-model-runs_files/figure-html/cell-77-output-1.png" class="img-fluid"></p>
</div>
</div>
</section>
<section id="model-training-observations" class="level3">
<h3 class="anchored" data-anchor-id="model-training-observations">Model Training Observations</h3>
<ul>
<li>Every model trained at different speeds, I believe this majorly was due to different complexity of models</li>
<li>By observing the performance metrics and curves on validation data, I think the best models are XGB classifier and Random Forest Classifier</li>
<li>This can even be observed by the confusion matrices</li>
<li>We will now train Random Forest Classifier and XGB Classifier with the best params on full dataset and save the pickle files</li>
</ul>
</section>
</section>
<section id="best-model-training-on-whole-datasets" class="level2">
<h2 class="anchored" data-anchor-id="best-model-training-on-whole-datasets">Best Model Training On Whole Datasets</h2>
<section id="random-forest-classifier-1" class="level3">
<h3 class="anchored" data-anchor-id="random-forest-classifier-1">Random Forest Classifier</h3>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-06-03T12:01:34.733224Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-06-03T12:01:34.732000Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-06-03T12:05:36.301499Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-06-03T12:05:36.300587Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2023-06-03T12:01:34.733184Z&quot;}" data-execution_count="356">
<div class="sourceCode cell-code" id="cb109"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb109-1"><a href="#cb109-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Random Forest Classifier Scores After Training on Whole Dataset:"</span>)</span>
<span id="cb109-2"><a href="#cb109-2" aria-hidden="true" tabindex="-1"></a>best_rfc <span class="op">=</span> RandomForestClassifier(<span class="op">**</span>best_params[<span class="st">'rfc'</span>],random_state <span class="op">=</span> <span class="dv">42</span>)</span>
<span id="cb109-3"><a href="#cb109-3" aria-hidden="true" tabindex="-1"></a>best_rfc.fit(X_train, y_train)</span>
<span id="cb109-4"><a href="#cb109-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Train Score: "</span>, best_rfc.score(X_train, y_train))</span>
<span id="cb109-5"><a href="#cb109-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Validation Score: "</span>, best_rfc.score(X_val, y_val))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Random Forest Classifier Scores After Training on Whole Dataset:
Train Score:  0.9965762117919476
Validation Score:  0.8146111936602278</code></pre>
</div>
</div>
<section id="random-forest-classifier-conf.-matrix-on-validation-set-1" class="level4">
<h4 class="anchored" data-anchor-id="random-forest-classifier-conf.-matrix-on-validation-set-1">Random Forest Classifier Conf. Matrix on Validation Set</h4>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-06-03T12:05:36.303126Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-06-03T12:05:36.302781Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-06-03T12:05:43.627822Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-06-03T12:05:43.626928Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2023-06-03T12:05:36.303093Z&quot;}" data-execution_count="357">
<div class="sourceCode cell-code" id="cb111"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb111-1"><a href="#cb111-1" aria-hidden="true" tabindex="-1"></a>y_pred <span class="op">=</span> best_rfc.predict(X_val)</span>
<span id="cb111-2"><a href="#cb111-2" aria-hidden="true" tabindex="-1"></a>confmat <span class="op">=</span> confusion_matrix(y_true<span class="op">=</span>y_val, y_pred<span class="op">=</span>y_pred)</span>
<span id="cb111-3"><a href="#cb111-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb111-4"><a href="#cb111-4" aria-hidden="true" tabindex="-1"></a>index <span class="op">=</span> [<span class="st">"Actual Severity 1"</span>, <span class="st">"Actual Severity 2"</span>, <span class="st">"Actual Severity 3"</span>, <span class="st">"Actual Severity 4"</span>]</span>
<span id="cb111-5"><a href="#cb111-5" aria-hidden="true" tabindex="-1"></a>columns <span class="op">=</span> [<span class="st">"Predicted Severity 1"</span>, <span class="st">"Predicted Severity 2"</span>, <span class="st">"Predicted Severity 3"</span>, <span class="st">"Predicted Severity 4"</span>]</span>
<span id="cb111-6"><a href="#cb111-6" aria-hidden="true" tabindex="-1"></a>conf_matrix <span class="op">=</span> pd.DataFrame(data<span class="op">=</span>confmat, columns<span class="op">=</span>columns, index<span class="op">=</span>index)</span>
<span id="cb111-7"><a href="#cb111-7" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">8</span>, <span class="dv">5</span>))</span>
<span id="cb111-8"><a href="#cb111-8" aria-hidden="true" tabindex="-1"></a>sns.heatmap(conf_matrix, annot<span class="op">=</span><span class="va">True</span>, fmt<span class="op">=</span><span class="st">"d"</span>, cmap<span class="op">=</span><span class="st">"YlGnBu"</span>)</span>
<span id="cb111-9"><a href="#cb111-9" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"Confusion Matrix - Random Forest Best"</span>)</span>
<span id="cb111-10"><a href="#cb111-10" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="project-4-us-accidents-model-runs_files/figure-html/cell-79-output-1.png" class="img-fluid"></p>
</div>
</div>
</section>
<section id="metrics-scores-and-metric-visualizations-for-random-forest-classifier-with-best-params-1" class="level4">
<h4 class="anchored" data-anchor-id="metrics-scores-and-metric-visualizations-for-random-forest-classifier-with-best-params-1">Metrics Scores and Metric Visualizations for Random Forest Classifier with best params</h4>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-06-03T12:05:43.629538Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-06-03T12:05:43.629157Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-06-03T12:06:18.270488Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-06-03T12:06:18.269497Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2023-06-03T12:05:43.629503Z&quot;}" data-execution_count="358">
<div class="sourceCode cell-code" id="cb112"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb112-1"><a href="#cb112-1" aria-hidden="true" tabindex="-1"></a>y_pred <span class="op">=</span> best_rfc.predict(X_val)</span>
<span id="cb112-2"><a href="#cb112-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb112-3"><a href="#cb112-3" aria-hidden="true" tabindex="-1"></a>accuracy[<span class="st">"Random Forest Best"</span>] <span class="op">=</span> accuracy_score(y_val, y_pred)</span>
<span id="cb112-4"><a href="#cb112-4" aria-hidden="true" tabindex="-1"></a>f1[<span class="st">"Random Forest Best"</span>] <span class="op">=</span> f1_score(y_val, y_pred, average<span class="op">=</span><span class="st">"macro"</span>)</span>
<span id="cb112-5"><a href="#cb112-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb112-6"><a href="#cb112-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(classification_report(y_train, best_rfc.predict(X_train)))</span>
<span id="cb112-7"><a href="#cb112-7" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(classification_report(y_val, y_pred))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>              precision    recall  f1-score   support

           1       1.00      1.00      1.00     40486
           2       1.00      0.99      1.00     40372
           3       0.99      1.00      1.00     40370
           4       1.00      1.00      1.00     40289

    accuracy                           1.00    161517
   macro avg       1.00      1.00      1.00    161517
weighted avg       1.00      1.00      1.00    161517

              precision    recall  f1-score   support

           1       0.93      0.96      0.94     10079
           2       0.77      0.66      0.71     10070
           3       0.78      0.80      0.79     10087
           4       0.77      0.84      0.80     10144

    accuracy                           0.81     40380
   macro avg       0.81      0.81      0.81     40380
weighted avg       0.81      0.81      0.81     40380
</code></pre>
</div>
</div>
</section>
<section id="random-forest-classifier-precision-vs-recall-curve-on-validation-set-1" class="level4">
<h4 class="anchored" data-anchor-id="random-forest-classifier-precision-vs-recall-curve-on-validation-set-1">Random Forest Classifier Precision vs Recall Curve on Validation Set</h4>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-06-03T12:06:18.272168Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-06-03T12:06:18.271807Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-06-03T12:06:22.961281Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-06-03T12:06:22.960345Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2023-06-03T12:06:18.272127Z&quot;}" data-execution_count="359">
<div class="sourceCode cell-code" id="cb114"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb114-1"><a href="#cb114-1" aria-hidden="true" tabindex="-1"></a>Y <span class="op">=</span> label_binarize(y_val, classes<span class="op">=</span>[<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>])</span>
<span id="cb114-2"><a href="#cb114-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-3"><a href="#cb114-3" aria-hidden="true" tabindex="-1"></a>y_score <span class="op">=</span> rfc.predict_proba(X_val)</span>
<span id="cb114-4"><a href="#cb114-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-5"><a href="#cb114-5" aria-hidden="true" tabindex="-1"></a>precision[<span class="st">"Random Forest Best"</span>], recall[<span class="st">"Random Forest Best"</span>], _ <span class="op">=</span> precision_recall_curve(Y.ravel(), y_score.ravel())</span>
<span id="cb114-6"><a href="#cb114-6" aria-hidden="true" tabindex="-1"></a>fpr[<span class="st">"Random Forest Best"</span>], tpr[<span class="st">"Random Forest Best"</span>], _ <span class="op">=</span> roc_curve(Y.ravel(), y_score.ravel())</span>
<span id="cb114-7"><a href="#cb114-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-8"><a href="#cb114-8" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">18</span>, <span class="dv">10</span>))</span>
<span id="cb114-9"><a href="#cb114-9" aria-hidden="true" tabindex="-1"></a>plt.step(recall[<span class="st">"Random Forest Best"</span>], precision[<span class="st">"Random Forest Best"</span>], where<span class="op">=</span><span class="st">"post"</span>)</span>
<span id="cb114-10"><a href="#cb114-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-11"><a href="#cb114-11" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">"Recall"</span>)</span>
<span id="cb114-12"><a href="#cb114-12" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">"Precision"</span>)</span>
<span id="cb114-13"><a href="#cb114-13" aria-hidden="true" tabindex="-1"></a>plt.xlim([<span class="dv">0</span>, <span class="dv">1</span>])</span>
<span id="cb114-14"><a href="#cb114-14" aria-hidden="true" tabindex="-1"></a>plt.ylim([<span class="dv">0</span>, <span class="fl">1.01</span>])</span>
<span id="cb114-15"><a href="#cb114-15" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"PR Curve - Random Forest Best"</span>)</span>
<span id="cb114-16"><a href="#cb114-16" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="project-4-us-accidents-model-runs_files/figure-html/cell-81-output-1.png" class="img-fluid"></p>
</div>
</div>
</section>
<section id="random-forest-classifier-roc-curve-on-validation-set-1" class="level4">
<h4 class="anchored" data-anchor-id="random-forest-classifier-roc-curve-on-validation-set-1">Random Forest Classifier ROC Curve on Validation Set</h4>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-06-03T12:06:22.963182Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-06-03T12:06:22.962824Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-06-03T12:06:23.367230Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-06-03T12:06:23.366338Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2023-06-03T12:06:22.963148Z&quot;}" data-execution_count="360">
<div class="sourceCode cell-code" id="cb115"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb115-1"><a href="#cb115-1" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">18</span>, <span class="dv">10</span>))</span>
<span id="cb115-2"><a href="#cb115-2" aria-hidden="true" tabindex="-1"></a>plt.step(fpr[<span class="st">"Random Forest Best"</span>], tpr[<span class="st">"Random Forest Best"</span>], where<span class="op">=</span><span class="st">"post"</span>)</span>
<span id="cb115-3"><a href="#cb115-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-4"><a href="#cb115-4" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"ROC curve - Random Forest Best"</span>)</span>
<span id="cb115-5"><a href="#cb115-5" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">"False Positive Rate"</span>)</span>
<span id="cb115-6"><a href="#cb115-6" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">"True Positive Rate"</span>)</span>
<span id="cb115-7"><a href="#cb115-7" aria-hidden="true" tabindex="-1"></a>plt.xlim([<span class="dv">0</span>, <span class="dv">1</span>])</span>
<span id="cb115-8"><a href="#cb115-8" aria-hidden="true" tabindex="-1"></a>plt.ylim([<span class="dv">0</span>, <span class="fl">1.01</span>])</span>
<span id="cb115-9"><a href="#cb115-9" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="project-4-us-accidents-model-runs_files/figure-html/cell-82-output-1.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-06-03T12:06:23.369093Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-06-03T12:06:23.368729Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-06-03T12:06:25.204098Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-06-03T12:06:25.203118Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2023-06-03T12:06:23.369066Z&quot;}" data-execution_count="361">
<div class="sourceCode cell-code" id="cb116"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb116-1"><a href="#cb116-1" aria-hidden="true" tabindex="-1"></a>importances <span class="op">=</span> pd.DataFrame(np.zeros((X_train.shape[<span class="dv">1</span>], <span class="dv">1</span>)), columns<span class="op">=</span>[<span class="st">"importance"</span>], index<span class="op">=</span>X_train.columns)</span>
<span id="cb116-2"><a href="#cb116-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb116-3"><a href="#cb116-3" aria-hidden="true" tabindex="-1"></a>importances.iloc[:,<span class="dv">0</span>] <span class="op">=</span> best_rfc.feature_importances_</span>
<span id="cb116-4"><a href="#cb116-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb116-5"><a href="#cb116-5" aria-hidden="true" tabindex="-1"></a>importances <span class="op">=</span> importances.sort_values(by<span class="op">=</span><span class="st">"importance"</span>, ascending<span class="op">=</span><span class="va">False</span>)[:<span class="dv">30</span>]</span>
<span id="cb116-6"><a href="#cb116-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb116-7"><a href="#cb116-7" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">15</span>, <span class="dv">10</span>))</span>
<span id="cb116-8"><a href="#cb116-8" aria-hidden="true" tabindex="-1"></a>sns.barplot(x<span class="op">=</span><span class="st">"importance"</span>, y<span class="op">=</span>importances.index, data<span class="op">=</span>importances)</span>
<span id="cb116-9"><a href="#cb116-9" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="project-4-us-accidents-model-runs_files/figure-html/cell-83-output-1.png" class="img-fluid"></p>
</div>
</div>
</section>
</section>
<section id="xgboost-classifier-1" class="level3">
<h3 class="anchored" data-anchor-id="xgboost-classifier-1">XGBoost Classifier</h3>
<ul>
<li>This algo requires the target labels to start from 0 so we transform the target | Original Label | Encoded Label | | ————– | ————- | | 1 | 0 | | 2 | 1 | | 3 | 2 | | 4 | 3 |</li>
</ul>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-06-03T12:06:25.205806Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-06-03T12:06:25.205411Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-06-03T12:06:25.218770Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-06-03T12:06:25.217890Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2023-06-03T12:06:25.205770Z&quot;}" data-execution_count="362">
<div class="sourceCode cell-code" id="cb117"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb117-1"><a href="#cb117-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.preprocessing <span class="im">import</span> LabelEncoder</span>
<span id="cb117-2"><a href="#cb117-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-3"><a href="#cb117-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Create an instance of LabelEncoder</span></span>
<span id="cb117-4"><a href="#cb117-4" aria-hidden="true" tabindex="-1"></a>label_encoder <span class="op">=</span> LabelEncoder()</span>
<span id="cb117-5"><a href="#cb117-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-6"><a href="#cb117-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit and transform the target variable</span></span>
<span id="cb117-7"><a href="#cb117-7" aria-hidden="true" tabindex="-1"></a>y_train_encoded <span class="op">=</span> label_encoder.fit_transform(y_train)</span>
<span id="cb117-8"><a href="#cb117-8" aria-hidden="true" tabindex="-1"></a>y_val_encoded <span class="op">=</span> label_encoder.transform(y_val)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="running-the-best-params-xgb-model-1" class="level4">
<h4 class="anchored" data-anchor-id="running-the-best-params-xgb-model-1">Running the best params XGB Model</h4>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-06-03T12:06:25.220608Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-06-03T12:06:25.220264Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-06-03T12:09:45.232204Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-06-03T12:09:45.231276Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2023-06-03T12:06:25.220583Z&quot;}" data-execution_count="363">
<div class="sourceCode cell-code" id="cb118"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb118-1"><a href="#cb118-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"XGB Classifier Scores After Training on Whole Dataset:"</span>)</span>
<span id="cb118-2"><a href="#cb118-2" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb118-3"><a href="#cb118-3" aria-hidden="true" tabindex="-1"></a>best_xgb <span class="op">=</span> XGBClassifier(<span class="op">**</span>best_params[<span class="st">'xgb'</span>],random_state<span class="op">=</span><span class="dv">42</span>)</span>
<span id="cb118-4"><a href="#cb118-4" aria-hidden="true" tabindex="-1"></a>best_xgb.fit(X_train, y_train_encoded)</span>
<span id="cb118-5"><a href="#cb118-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Train Score: "</span>, best_xgb.score(X_train, y_train_encoded))</span>
<span id="cb118-6"><a href="#cb118-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Validation Score: "</span>, best_xgb.score(X_val, y_val_encoded))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>XGB Classifier Scores After Training on Whole Dataset:
Train Score:  0.8237894463121529
Validation Score:  0.8105002476473502</code></pre>
</div>
</div>
</section>
<section id="xgb-conf.-matrix-on-validation-set-1" class="level4">
<h4 class="anchored" data-anchor-id="xgb-conf.-matrix-on-validation-set-1">XGB Conf. Matrix on Validation Set</h4>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-06-03T12:09:45.237013Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-06-03T12:09:45.235011Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-06-03T12:09:46.076199Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-06-03T12:09:46.075313Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2023-06-03T12:09:45.236976Z&quot;}" data-execution_count="364">
<div class="sourceCode cell-code" id="cb120"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb120-1"><a href="#cb120-1" aria-hidden="true" tabindex="-1"></a>y_pred <span class="op">=</span> xgb.predict(X_val)</span>
<span id="cb120-2"><a href="#cb120-2" aria-hidden="true" tabindex="-1"></a>confmat <span class="op">=</span> confusion_matrix(y_true<span class="op">=</span>y_val_encoded, y_pred<span class="op">=</span>y_pred)</span>
<span id="cb120-3"><a href="#cb120-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb120-4"><a href="#cb120-4" aria-hidden="true" tabindex="-1"></a>index <span class="op">=</span> [<span class="st">"Actual Severity 1"</span>, <span class="st">"Actual Severity 2"</span>, <span class="st">"Actual Severity 3"</span>, <span class="st">"Actual Severity 4"</span>]</span>
<span id="cb120-5"><a href="#cb120-5" aria-hidden="true" tabindex="-1"></a>columns <span class="op">=</span> [<span class="st">"Predicted Severity 1"</span>, <span class="st">"Predicted Severity 2"</span>, <span class="st">"Predicted Severity 3"</span>, <span class="st">"Predicted Severity 4"</span>]</span>
<span id="cb120-6"><a href="#cb120-6" aria-hidden="true" tabindex="-1"></a>conf_matrix <span class="op">=</span> pd.DataFrame(data<span class="op">=</span>confmat, columns<span class="op">=</span>columns, index<span class="op">=</span>index)</span>
<span id="cb120-7"><a href="#cb120-7" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">8</span>, <span class="dv">5</span>))</span>
<span id="cb120-8"><a href="#cb120-8" aria-hidden="true" tabindex="-1"></a>sns.heatmap(conf_matrix, annot<span class="op">=</span><span class="va">True</span>, fmt<span class="op">=</span><span class="st">"d"</span>, cmap<span class="op">=</span><span class="st">"YlGnBu"</span>)</span>
<span id="cb120-9"><a href="#cb120-9" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"Confusion Matrix - XGB Best"</span>)</span>
<span id="cb120-10"><a href="#cb120-10" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="project-4-us-accidents-model-runs_files/figure-html/cell-86-output-1.png" class="img-fluid"></p>
</div>
</div>
</section>
<section id="metrics-scores-and-metric-visualizations-for-xgb-with-best-params-1" class="level4">
<h4 class="anchored" data-anchor-id="metrics-scores-and-metric-visualizations-for-xgb-with-best-params-1">Metrics Scores and Metric Visualizations for XGB with best params</h4>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-06-03T12:09:46.078035Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-06-03T12:09:46.077683Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-06-03T12:09:48.280399Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-06-03T12:09:48.279486Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2023-06-03T12:09:46.078006Z&quot;}" data-execution_count="365">
<div class="sourceCode cell-code" id="cb121"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb121-1"><a href="#cb121-1" aria-hidden="true" tabindex="-1"></a>y_pred <span class="op">=</span> xgb.predict(X_val)</span>
<span id="cb121-2"><a href="#cb121-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-3"><a href="#cb121-3" aria-hidden="true" tabindex="-1"></a>accuracy[<span class="st">"XGB_best"</span>] <span class="op">=</span> accuracy_score(y_val_encoded, y_pred)</span>
<span id="cb121-4"><a href="#cb121-4" aria-hidden="true" tabindex="-1"></a>f1[<span class="st">"XGB_best"</span>] <span class="op">=</span> f1_score(y_val_encoded, y_pred, average<span class="op">=</span><span class="st">"macro"</span>)</span>
<span id="cb121-5"><a href="#cb121-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-6"><a href="#cb121-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(classification_report(y_train_encoded, best_xgb.predict(X_train)))</span>
<span id="cb121-7"><a href="#cb121-7" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(classification_report(y_val_encoded, y_pred))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>              precision    recall  f1-score   support

           0       0.93      0.96      0.95     40486
           1       0.79      0.68      0.73     40372
           2       0.79      0.82      0.81     40370
           3       0.78      0.83      0.81     40289

    accuracy                           0.82    161517
   macro avg       0.82      0.82      0.82    161517
weighted avg       0.82      0.82      0.82    161517

              precision    recall  f1-score   support

           0       0.92      0.97      0.95     10079
           1       0.80      0.68      0.74     10070
           2       0.80      0.83      0.81     10087
           3       0.80      0.85      0.82     10144

    accuracy                           0.83     40380
   macro avg       0.83      0.83      0.83     40380
weighted avg       0.83      0.83      0.83     40380
</code></pre>
</div>
</div>
</section>
<section id="xgb-precision-vs-recall-curve-on-validation-set-1" class="level4">
<h4 class="anchored" data-anchor-id="xgb-precision-vs-recall-curve-on-validation-set-1">XGB Precision vs Recall Curve on Validation Set</h4>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-06-03T12:09:48.292001Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-06-03T12:09:48.291712Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-06-03T12:09:49.148710Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-06-03T12:09:49.147795Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2023-06-03T12:09:48.291977Z&quot;}" data-execution_count="367">
<div class="sourceCode cell-code" id="cb123"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb123-1"><a href="#cb123-1" aria-hidden="true" tabindex="-1"></a>Y <span class="op">=</span> label_binarize(y_val_encoded, classes<span class="op">=</span>[<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>])</span>
<span id="cb123-2"><a href="#cb123-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb123-3"><a href="#cb123-3" aria-hidden="true" tabindex="-1"></a>y_score <span class="op">=</span> best_xgb.predict_proba(X_val)</span>
<span id="cb123-4"><a href="#cb123-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb123-5"><a href="#cb123-5" aria-hidden="true" tabindex="-1"></a>precision[<span class="st">"XGB_best"</span>], recall[<span class="st">"XGB_best"</span>], _ <span class="op">=</span> precision_recall_curve(Y.ravel(), y_score.ravel())</span>
<span id="cb123-6"><a href="#cb123-6" aria-hidden="true" tabindex="-1"></a>fpr[<span class="st">"XGB_best"</span>], tpr[<span class="st">"XGB_best"</span>], _ <span class="op">=</span> roc_curve(Y.ravel(), y_score.ravel())</span>
<span id="cb123-7"><a href="#cb123-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb123-8"><a href="#cb123-8" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">18</span>, <span class="dv">10</span>))</span>
<span id="cb123-9"><a href="#cb123-9" aria-hidden="true" tabindex="-1"></a>plt.step(recall[<span class="st">"XGB_best"</span>], precision[<span class="st">"XGB_best"</span>], where<span class="op">=</span><span class="st">"post"</span>)</span>
<span id="cb123-10"><a href="#cb123-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb123-11"><a href="#cb123-11" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">"Recall"</span>)</span>
<span id="cb123-12"><a href="#cb123-12" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">"Precision"</span>)</span>
<span id="cb123-13"><a href="#cb123-13" aria-hidden="true" tabindex="-1"></a>plt.xlim([<span class="dv">0</span>, <span class="dv">1</span>])</span>
<span id="cb123-14"><a href="#cb123-14" aria-hidden="true" tabindex="-1"></a>plt.ylim([<span class="dv">0</span>, <span class="fl">1.01</span>])</span>
<span id="cb123-15"><a href="#cb123-15" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"PR Curve - XGB_best"</span>)</span>
<span id="cb123-16"><a href="#cb123-16" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="project-4-us-accidents-model-runs_files/figure-html/cell-88-output-1.png" class="img-fluid"></p>
</div>
</div>
</section>
<section id="xgb-roc-curve-on-validation-set-1" class="level4">
<h4 class="anchored" data-anchor-id="xgb-roc-curve-on-validation-set-1">XGB ROC Curve on Validation Set</h4>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-06-03T12:09:49.150689Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-06-03T12:09:49.150225Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-06-03T12:09:49.561019Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-06-03T12:09:49.560102Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2023-06-03T12:09:49.150643Z&quot;}" data-execution_count="368">
<div class="sourceCode cell-code" id="cb124"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb124-1"><a href="#cb124-1" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">18</span>, <span class="dv">10</span>))</span>
<span id="cb124-2"><a href="#cb124-2" aria-hidden="true" tabindex="-1"></a>plt.step(fpr[<span class="st">"XGB_best"</span>], tpr[<span class="st">"XGB_best"</span>], where<span class="op">=</span><span class="st">"post"</span>)</span>
<span id="cb124-3"><a href="#cb124-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb124-4"><a href="#cb124-4" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"ROC curve - XGB_best"</span>)</span>
<span id="cb124-5"><a href="#cb124-5" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">"False Positive Rate"</span>)</span>
<span id="cb124-6"><a href="#cb124-6" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">"True Positive Rate"</span>)</span>
<span id="cb124-7"><a href="#cb124-7" aria-hidden="true" tabindex="-1"></a>plt.xlim([<span class="dv">0</span>, <span class="dv">1</span>])</span>
<span id="cb124-8"><a href="#cb124-8" aria-hidden="true" tabindex="-1"></a>plt.ylim([<span class="dv">0</span>, <span class="fl">1.01</span>])</span>
<span id="cb124-9"><a href="#cb124-9" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="project-4-us-accidents-model-runs_files/figure-html/cell-89-output-1.png" class="img-fluid"></p>
</div>
</div>
</section>
</section>
<section id="comparing-results-between-xgb-n-random-forest-regressor-after-training-on-whole-dataset" class="level3">
<h3 class="anchored" data-anchor-id="comparing-results-between-xgb-n-random-forest-regressor-after-training-on-whole-dataset">Comparing Results between XGB n Random Forest Regressor after training on whole dataset</h3>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-06-03T13:07:13.648001Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-06-03T13:07:13.647632Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-06-03T13:07:15.399793Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-06-03T13:07:15.398917Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2023-06-03T13:07:13.647972Z&quot;}" data-execution_count="374">
<div class="sourceCode cell-code" id="cb125"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb125-1"><a href="#cb125-1" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">20</span>, <span class="dv">8</span>))</span>
<span id="cb125-2"><a href="#cb125-2" aria-hidden="true" tabindex="-1"></a>keys <span class="op">=</span> [<span class="st">"XGB_best"</span>,<span class="st">"Random Forest Best"</span>]</span>
<span id="cb125-3"><a href="#cb125-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> key <span class="kw">in</span> keys:</span>
<span id="cb125-4"><a href="#cb125-4" aria-hidden="true" tabindex="-1"></a>    plt.step(fpr[key], tpr[key], where<span class="op">=</span><span class="st">"post"</span>, label<span class="op">=</span>key)</span>
<span id="cb125-5"><a href="#cb125-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb125-6"><a href="#cb125-6" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">"False Positive Rate"</span>)</span>
<span id="cb125-7"><a href="#cb125-7" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">"True Positive Rate"</span>)</span>
<span id="cb125-8"><a href="#cb125-8" aria-hidden="true" tabindex="-1"></a>plt.xlim([<span class="dv">0</span>, <span class="dv">1</span>])</span>
<span id="cb125-9"><a href="#cb125-9" aria-hidden="true" tabindex="-1"></a>plt.ylim([<span class="dv">0</span>, <span class="fl">1.01</span>])</span>
<span id="cb125-10"><a href="#cb125-10" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"ROC curve"</span>)</span>
<span id="cb125-11"><a href="#cb125-11" aria-hidden="true" tabindex="-1"></a>plt.legend()</span>
<span id="cb125-12"><a href="#cb125-12" aria-hidden="true" tabindex="-1"></a>plt.savefig(<span class="st">"Best_Model_Comparision_ROC_Curve_plot.png"</span>,bbox_inches <span class="op">=</span> <span class="st">'tight'</span>, dpi <span class="op">=</span> <span class="dv">300</span>)</span>
<span id="cb125-13"><a href="#cb125-13" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="project-4-us-accidents-model-runs_files/figure-html/cell-90-output-1.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-06-03T13:07:16.419542Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-06-03T13:07:16.418532Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-06-03T13:07:18.597621Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-06-03T13:07:18.596359Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2023-06-03T13:07:16.419496Z&quot;}" data-execution_count="375">
<div class="sourceCode cell-code" id="cb126"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb126-1"><a href="#cb126-1" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">20</span>, <span class="dv">8</span>))</span>
<span id="cb126-2"><a href="#cb126-2" aria-hidden="true" tabindex="-1"></a>keys <span class="op">=</span> [<span class="st">"XGB_best"</span>,<span class="st">"Random Forest Best"</span>]</span>
<span id="cb126-3"><a href="#cb126-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> key <span class="kw">in</span> keys:</span>
<span id="cb126-4"><a href="#cb126-4" aria-hidden="true" tabindex="-1"></a>    plt.step(recall[key], precision[key], where<span class="op">=</span><span class="st">"post"</span>, label<span class="op">=</span>key)</span>
<span id="cb126-5"><a href="#cb126-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb126-6"><a href="#cb126-6" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">"Recall"</span>)</span>
<span id="cb126-7"><a href="#cb126-7" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">"Precision"</span>)</span>
<span id="cb126-8"><a href="#cb126-8" aria-hidden="true" tabindex="-1"></a>plt.xlim([<span class="dv">0</span>, <span class="dv">1</span>])</span>
<span id="cb126-9"><a href="#cb126-9" aria-hidden="true" tabindex="-1"></a>plt.ylim([<span class="dv">0</span>, <span class="fl">1.01</span>])</span>
<span id="cb126-10"><a href="#cb126-10" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"PR curve"</span>)</span>
<span id="cb126-11"><a href="#cb126-11" aria-hidden="true" tabindex="-1"></a>plt.legend()</span>
<span id="cb126-12"><a href="#cb126-12" aria-hidden="true" tabindex="-1"></a>plt.savefig(<span class="st">"Best_Model_Comparision_PR_Curve_plot.png"</span>,bbox_inches <span class="op">=</span> <span class="st">'tight'</span>, dpi <span class="op">=</span> <span class="dv">300</span>)</span>
<span id="cb126-13"><a href="#cb126-13" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="project-4-us-accidents-model-runs_files/figure-html/cell-91-output-1.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-06-03T13:07:20.883868Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-06-03T13:07:20.883502Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-06-03T13:07:31.396837Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-06-03T13:07:31.395779Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2023-06-03T13:07:20.883837Z&quot;}" data-execution_count="376">
<div class="sourceCode cell-code" id="cb127"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb127-1"><a href="#cb127-1" aria-hidden="true" tabindex="-1"></a>fig, axs <span class="op">=</span> plt.subplots(<span class="dv">1</span>, <span class="dv">2</span>, figsize<span class="op">=</span>(<span class="dv">18</span>, <span class="dv">12</span>))</span>
<span id="cb127-2"><a href="#cb127-2" aria-hidden="true" tabindex="-1"></a>best_models <span class="op">=</span> {<span class="st">"XGB_best"</span>: best_xgb, <span class="st">"Random Forest Best"</span>: best_rfc}</span>
<span id="cb127-3"><a href="#cb127-3" aria-hidden="true" tabindex="-1"></a>axs <span class="op">=</span> axs.ravel()</span>
<span id="cb127-4"><a href="#cb127-4" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i, (name, model) <span class="kw">in</span> <span class="bu">enumerate</span>(best_models.items()):</span>
<span id="cb127-5"><a href="#cb127-5" aria-hidden="true" tabindex="-1"></a>    ax <span class="op">=</span> axs[i]</span>
<span id="cb127-6"><a href="#cb127-6" aria-hidden="true" tabindex="-1"></a>    y_pred <span class="op">=</span> model.predict(X_val)</span>
<span id="cb127-7"><a href="#cb127-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> name <span class="op">==</span> <span class="st">"XGB_best"</span>:</span>
<span id="cb127-8"><a href="#cb127-8" aria-hidden="true" tabindex="-1"></a>        confmat <span class="op">=</span> confusion_matrix(y_true<span class="op">=</span>y_val_encoded, y_pred<span class="op">=</span>y_pred)</span>
<span id="cb127-9"><a href="#cb127-9" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb127-10"><a href="#cb127-10" aria-hidden="true" tabindex="-1"></a>        confmat <span class="op">=</span> confusion_matrix(y_true<span class="op">=</span>y_val, y_pred<span class="op">=</span>y_pred)</span>
<span id="cb127-11"><a href="#cb127-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb127-12"><a href="#cb127-12" aria-hidden="true" tabindex="-1"></a>    index <span class="op">=</span> [<span class="st">"Actual Severity 1"</span>, <span class="st">"Actual Severity 2"</span>, <span class="st">"Actual Severity 3"</span>, <span class="st">"Actual Severity 4"</span>]</span>
<span id="cb127-13"><a href="#cb127-13" aria-hidden="true" tabindex="-1"></a>    columns <span class="op">=</span> [<span class="st">"Predicted Severity 1"</span>, <span class="st">"Predicted Severity 2"</span>, <span class="st">"Predicted Severity 3"</span>, <span class="st">"Predicted Severity 4"</span>]</span>
<span id="cb127-14"><a href="#cb127-14" aria-hidden="true" tabindex="-1"></a>    conf_matrix <span class="op">=</span> pd.DataFrame(data<span class="op">=</span>confmat, columns<span class="op">=</span>columns, index<span class="op">=</span>index)</span>
<span id="cb127-15"><a href="#cb127-15" aria-hidden="true" tabindex="-1"></a>    sns.heatmap(conf_matrix, annot<span class="op">=</span><span class="va">True</span>, fmt<span class="op">=</span><span class="st">"d"</span>, cmap<span class="op">=</span><span class="st">"YlGnBu"</span>, ax<span class="op">=</span>ax)</span>
<span id="cb127-16"><a href="#cb127-16" aria-hidden="true" tabindex="-1"></a>    ax.set_title(<span class="ss">f"Confusion Matrix - </span><span class="sc">{</span>name<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb127-17"><a href="#cb127-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb127-18"><a href="#cb127-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Hide the remaining subplots</span></span>
<span id="cb127-19"><a href="#cb127-19" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> j <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(models), <span class="bu">len</span>(axs)):</span>
<span id="cb127-20"><a href="#cb127-20" aria-hidden="true" tabindex="-1"></a>    axs[j].axis(<span class="st">'off'</span>)</span>
<span id="cb127-21"><a href="#cb127-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb127-22"><a href="#cb127-22" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb127-23"><a href="#cb127-23" aria-hidden="true" tabindex="-1"></a>plt.savefig(<span class="st">"Best Models Conf_Matrix_Plot.png"</span>,bbox_inches <span class="op">=</span> <span class="st">'tight'</span>, dpi <span class="op">=</span> <span class="dv">300</span>)</span>
<span id="cb127-24"><a href="#cb127-24" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="project-4-us-accidents-model-runs_files/figure-html/cell-92-output-1.png" class="img-fluid"></p>
</div>
</div>
</section>
</section>
<section id="conclusion-of-model-training" class="level2">
<h2 class="anchored" data-anchor-id="conclusion-of-model-training">Conclusion of Model Training</h2>
<ul>
<li><p>Random Forest classifier performs the best on US-Accidents Severity Level Predictions</p></li>
<li><p>Overall every model performs well on Severity Levels 1,3,4 on Validation sets, however the accuracy and recall decreases on Severity Level 2</p>
<ul>
<li>The reasons for this can mainly be while balancing the data the sample that we chose for 2 Severity is not a good representative</li>
<li>This is where one can retrain the models by choosing various random samples, or try including more data of Level 2 Severity and then retrain the models</li>
</ul></li>
<li><p>Further every model can be trained using cuml GPU implementations on whole dataset, and then do more dense comparisions between models to select the best one</p></li>
<li><p>Thank you for reading the work 😊</p></li>
</ul>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  let localAlternateSentinel = 'alternate';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<script src="https://giscus.app/client.js" data-repo="Yuvraj-Dhepe/DataBlog_V1" data-repo-id="R_kgDOJMncgA" data-category="Announcements" data-category-id="DIC_kwDOJMncgM4CVqbZ" data-mapping="pathname" data-reactions-enabled="1" data-emit-metadata="0" data-input-position="top" data-theme="light_protanopia" data-lang="en" crossorigin="anonymous" async="">
</script>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">This page is built with ❤️ and <a href="https://quarto.org">Quarto</a></div>   
    <div class="nav-footer-center">
      &nbsp;
    </div>
    <div class="nav-footer-right">
      <ul class="footer-items list-unstyled">
    <li class="nav-item compact">
    <a class="nav-link" href="https://www.linkedin.com/in/yuvraj-shivaji-dhepe-22974919a/">
      <i class="bi bi-linkedin" role="img" aria-label="My LinkedIn">
</i> 
    </a>
  </li>  
    <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/Yuvraj-Dhepe">
      <i class="bi bi-github" role="img" aria-label="My Github">
</i> 
    </a>
  </li>  
    <li class="nav-item compact">
    <a class="nav-link" href="https://medium.com/@yuvrajdhepe">
      <i class="bi bi-medium" role="img" aria-label="My Medium">
</i> 
    </a>
  </li>  
</ul>
    </div>
  </div>
</footer>



</body></html>